<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chenjinsongcjs.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":false},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Technological learning">
<meta property="og:url" content="https://chenjinsongcjs.github.io/index.html">
<meta property="og:site_name" content="Technological learning">
<meta property="og:locale">
<meta property="article:author" content="cjsstart">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://chenjinsongcjs.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh'
  };
</script>

  <title>Technological learning</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Navigationsleiste an/ausschalten">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Technological learning</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Startseite</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archiv<span class="badge">4</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Schlagwörter<span class="badge">2</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Kategorien<span class="badge">0</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Suche
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Suche..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://chenjinsongcjs.github.io/2022/08/28/JUC%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cjsstart">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technological learning">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/28/JUC%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/" class="post-title-link" itemprop="url">JUC基础部分</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              

              <time title="Erstellt: 2022-08-28 19:25:15 / Geändert am: 19:25:29" itemprop="dateCreated datePublished" datetime="2022-08-28T19:25:15+08:00">2022-08-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JUC基础部分"><a href="#JUC基础部分" class="headerlink" title="JUC基础部分"></a>JUC基础部分</h1><h2 id="1、什么是JUC"><a href="#1、什么是JUC" class="headerlink" title="1、什么是JUC"></a>1、什么是JUC</h2><ul>
<li><p>JUC指java类库中的三个包</p>
<ul>
<li><p>java.util.concurrent</p>
</li>
<li><p>java.util.concurrent.atomic</p>
</li>
<li><p>java.util.concurrent.locks</p>
</li>
</ul>
</li>
</ul>
<h2 id="2、线程和进程"><a href="#2、线程和进程" class="headerlink" title="2、线程和进程"></a>2、线程和进程</h2><ul>
<li><p>线程：程序执行和调度的基本单位，线程隶属于进程。</p>
</li>
<li><p>进程：资源分配的单位，一个进程可以有一个和多个线程。</p>
</li>
<li><p>java程序的线程与操作系统的线程一一映射，java创建线程使用的是本地方法。private native void start0();</p>
</li>
<li><p>并发和并行</p>
<ul>
<li><p>并发：CPU在同一时间段内执行多个任务。</p>
</li>
<li><p>并行：CPU在同一时间刻内执行多个任务。</p>
</li>
</ul>
</li>
<li><p>线程的几个状态</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">State</span> &#123;</span><br><span class="line">        NEW,</span><br><span class="line">        RUNNABLE,</span><br><span class="line">        BLOCKED,</span><br><span class="line">        WAITING,</span><br><span class="line">        TIMED_WAITING,</span><br><span class="line">        TERMINATED;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>wait和sleep的区别</p>
<ul>
<li><p>来自不同的类</p>
<ul>
<li><p>wait–&gt;Object</p>
</li>
<li><p>sleep–&gt;Thread</p>
</li>
</ul>
</li>
<li><p>关于锁的释放</p>
<ul>
<li><p>wait会释放锁</p>
</li>
<li><p>sleep不会释放锁</p>
</li>
</ul>
</li>
<li><p>使用范围</p>
<ul>
<li><p>wait只能在同步代码块中使用</p>
</li>
<li><p>sleep可以在任何地方使用</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="3、Lock锁"><a href="#3、Lock锁" class="headerlink" title="3、Lock锁"></a>3、Lock锁</h2><ul>
<li>传统的synchronized</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="type">Ticket</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ticket</span>(); </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span> ; i++)&#123;</span><br><span class="line">                t.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span> ; i++)&#123;</span><br><span class="line">                t.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span> ; i++)&#123;</span><br><span class="line">                t.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ticket</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(num &gt; <span class="number">0</span>)</span><br><span class="line">            System.out.println(<span class="string">&quot;&quot;</span>+Thread.currentThread().getName()+<span class="string">&quot;--&gt;&quot;</span>+num+<span class="string">&quot;--&gt;&quot;</span>+(num--));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Lock接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Lock</span> &#123;</span><br><span class="line">  <span class="comment">//加锁</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//可中断锁</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">    <span class="comment">//尝试获得锁</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">    <span class="comment">//解锁</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//创建Condition对象</span></span><br><span class="line">    Condition <span class="title function_">newCondition</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ticket</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    <span class="comment">//lock对象</span></span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//上锁</span></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (num &gt; <span class="number">0</span>)</span><br><span class="line">                System.out.println(<span class="string">&quot;&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;--&gt;&quot;</span> + num + <span class="string">&quot;--&gt;&quot;</span> + (num--));</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//解锁</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">//无参构造默认锁为非公平锁</span></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync = <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">//通过有参构造器可以选择公平锁和非公平锁  </span></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">(<span class="type">boolean</span> fair)</span> &#123;</span><br><span class="line">        sync = fair ? <span class="keyword">new</span> <span class="title class_">FairSync</span>() : <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622638828892-c8d8b564-ad70-42ae-aa09-657c5ec4e7a4.png#align=left&display=inline&height=100&margin=[object%20Object]&name=image.png&originHeight=199&originWidth=1453&size=24487&status=done&style=none&width=726.5" alt="image.png" title="image.png"></p>
<ul>
<li><p>Synchronized和Lock的区别</p>
<ul>
<li><p>Synchronized是java的关键字，Lock是java类</p>
</li>
<li><p>Synchronized无法判断锁的状态，Lock可以判断锁的状态</p>
</li>
<li><p>Synchronized可以自动释放锁，Lock必须手动释放锁，不然会导致死锁</p>
</li>
<li><p>Synchronized只能是非公平锁，Lock可以设置为公平锁和非公平锁</p>
</li>
<li><p>Synchronized适合锁少量的代码，Lock适合锁大量的同步代码</p>
</li>
</ul>
</li>
</ul>
<h2 id="4、生产者和消费者问题"><a href="#4、生产者和消费者问题" class="headerlink" title="4、生产者和消费者问题"></a>4、生产者和消费者问题</h2><ul>
<li>Synchronized版</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;生产者-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.incrment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;生产者&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;消费者-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.decrment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;消费者&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">incrment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span>(num != <span class="number">0</span>)&#123;<span class="comment">//使用while避免虚假唤醒</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;wait...&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.wait();<span class="comment">//当有产品的时候等待</span></span><br><span class="line">        &#125;</span><br><span class="line">        num++;<span class="comment">//没有产品就生产</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;生产产品数量：&quot;</span>+num);</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();<span class="comment">//唤醒消费者</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">decrment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span>(num == <span class="number">0</span>)&#123;<span class="comment">//没有产品就等待</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;wait...&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;消费产品数量：&quot;</span>+num);</span><br><span class="line">        num--;<span class="comment">//消费产品</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();<span class="comment">//唤醒生产者</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>JUC版的生产者消费者问题</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;生产者A-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.incrment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;生产者&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;消费者A-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.decrment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;消费者&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;生产者B-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.incrment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;生产者&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;消费者B-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.decrment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;消费者&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//锁住当前对象</span></span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incrment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>( num != <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot; wait...&quot;</span>);</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            num++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; num--&gt;&quot;</span>+num);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(num == <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot; wait...&quot;</span>);</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            num--;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; num--&gt;&quot;</span>+num);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Condition 精准唤醒</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;生产者A-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.printA();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;生产者&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;消费者A-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.printB();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;消费者&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                Thread.currentThread().setName(<span class="string">&quot;生产者B-&quot;</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    product.printC();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;生产者&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">//精准唤醒指定线程</span></span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition1</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition2</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition3</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>( num != <span class="number">1</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot; wait...&quot;</span>);</span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            num = <span class="number">2</span>;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; num--&gt;&quot;</span>+num);</span><br><span class="line">            condition2.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(num != <span class="number">2</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot; wait...&quot;</span>);</span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            num = <span class="number">3</span>;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; num--&gt;&quot;</span>+num);</span><br><span class="line">            condition3.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(num != <span class="number">3</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot; wait...&quot;</span>);</span><br><span class="line">                condition3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            num = <span class="number">1</span>;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; num--&gt;&quot;</span>+num);</span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5、8锁现象"><a href="#5、8锁现象" class="headerlink" title="5、8锁现象"></a>5、8锁现象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.synchronized 锁定当前方法的调用者，谁先拿到锁谁执行</span></span><br><span class="line"><span class="comment">//2.普通方法不受锁的影响，就算锁被其他线程持有，当前线程还能执行普通方法</span></span><br><span class="line"><span class="comment">//3.非静态方法，两个对象，两个调用者，就有两把锁线程互不影响</span></span><br><span class="line"><span class="comment">//4.两个静态方法，只有一个对象，静态方法锁定当前Class对象(只有一个)，谁先获得锁谁执行</span></span><br><span class="line"><span class="comment">//5.两个静态方法，两个对象，静态方法锁定当前Class对象(只有一个)，谁先获得锁谁执行</span></span><br><span class="line"><span class="comment">//6.一个静态同步方法，一个普通同步方法，一个是Class锁，一个是对象锁，是两把不同的锁，互不影响</span></span><br><span class="line"></span><br><span class="line">主要是看锁的是谁，谁有锁</span><br></pre></td></tr></table></figure>

<h2 id="6、集合类不安全"><a href="#6、集合类不安全" class="headerlink" title="6、集合类不安全"></a>6、集合类不安全</h2><ul>
<li><p>ConcurrentModificationException  线程不安全可能导致的异常</p>
</li>
<li><p>List不安全</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解决方法：</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//集合不安全解决方法</span></span><br><span class="line">        <span class="comment">//使用线程安全的Vector类</span></span><br><span class="line">        <span class="comment">//1.使用Collections工具类</span></span><br><span class="line">        Collections.synchronizedList(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        <span class="comment">//使用CopyOnWriteArrayList</span></span><br><span class="line">        CopyOnWriteArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//底层添加操作</span></span><br><span class="line"><span class="comment">//        public boolean add(E e) &#123;</span></span><br><span class="line"><span class="comment">//            final ReentrantLock lock = this.lock;</span></span><br><span class="line"><span class="comment">//            lock.lock();</span></span><br><span class="line"><span class="comment">//            try &#123;</span></span><br><span class="line"><span class="comment">//                Object[] elements = getArray();</span></span><br><span class="line"><span class="comment">//                int len = elements.length;</span></span><br><span class="line"><span class="comment">//                Object[] newElements = Arrays.copyOf(elements, len + 1);</span></span><br><span class="line"><span class="comment">//                newElements[len] = e;</span></span><br><span class="line"><span class="comment">//                setArray(newElements);</span></span><br><span class="line"><span class="comment">//                return true;</span></span><br><span class="line"><span class="comment">//            &#125; finally &#123;</span></span><br><span class="line"><span class="comment">//                lock.unlock();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        arrayList.add(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>set不安全</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//set不安全</span></span><br><span class="line">        <span class="comment">//1。使用Collections工具类</span></span><br><span class="line">        Collections.synchronizedSet(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;());</span><br><span class="line">        <span class="comment">//2.使用CopyOnWriteArraySet</span></span><br><span class="line">        CopyOnWriteArraySet&lt;String&gt; arraySet = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;();</span><br><span class="line">      <span class="comment">//底层添加操作</span></span><br><span class="line">       <span class="comment">/* private boolean addIfAbsent(E e, Object[] snapshot) &#123;</span></span><br><span class="line"><span class="comment">            final ReentrantLock lock = this.lock;</span></span><br><span class="line"><span class="comment">            lock.lock();</span></span><br><span class="line"><span class="comment">            try &#123;</span></span><br><span class="line"><span class="comment">                Object[] current = getArray();</span></span><br><span class="line"><span class="comment">                int len = current.length;</span></span><br><span class="line"><span class="comment">                if (snapshot != current) &#123;</span></span><br><span class="line"><span class="comment">                    // Optimize for lost race to another addXXX operation</span></span><br><span class="line"><span class="comment">                    int common = Math.min(snapshot.length, len);</span></span><br><span class="line"><span class="comment">                    for (int i = 0; i &lt; common; i++)</span></span><br><span class="line"><span class="comment">                        if (current[i] != snapshot[i] &amp;&amp; eq(e, current[i]))</span></span><br><span class="line"><span class="comment">                            return false;</span></span><br><span class="line"><span class="comment">                    if (indexOf(e, current, common, len) &gt;= 0)</span></span><br><span class="line"><span class="comment">                        return false;</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                Object[] newElements = Arrays.copyOf(current, len + 1);</span></span><br><span class="line"><span class="comment">                newElements[len] = e;</span></span><br><span class="line"><span class="comment">                setArray(newElements);</span></span><br><span class="line"><span class="comment">                return true;</span></span><br><span class="line"><span class="comment">            &#125; finally &#123;</span></span><br><span class="line"><span class="comment">                lock.unlock();</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        arraySet.add(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//HashSet底层是一个HashMap</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HashSet</span><span class="params">()</span> &#123;</span><br><span class="line">        map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//添加操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> map.put(e, PRESENT)==<span class="literal">null</span>;<span class="comment">//PRESENT是一个常量 private static final Object PRESENT = new Object();</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>map不安全</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ConcurrentHashMap&lt;String, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;k&quot;</span>,<span class="string">&quot;v&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//put的底层实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(K key, V value, <span class="type">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="literal">null</span> || value == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> spread(key.hashCode());</span><br><span class="line">        <span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; f; <span class="type">int</span> n, i, fh;</span><br><span class="line">            <span class="keyword">if</span> (tab == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">                tab = initTable();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (casTabAt(tab, i, <span class="literal">null</span>,</span><br><span class="line">                             <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="literal">null</span>)))</span><br><span class="line">                    <span class="keyword">break</span>;                   <span class="comment">// no lock when adding to empty bin</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">                tab = helpTransfer(tab, f);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">V</span> <span class="variable">oldVal</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            binCount = <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                                K ek;</span><br><span class="line">                                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                                    ((ek = e.key) == key ||</span><br><span class="line">                                     (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                    oldVal = e.val;</span><br><span class="line">                                    <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                        e.val = value;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                Node&lt;K,V&gt; pred = e;</span><br><span class="line">                                <span class="keyword">if</span> ((e = e.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    pred.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key,</span><br><span class="line">                                                              value, <span class="literal">null</span>);</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                            Node&lt;K,V&gt; p;</span><br><span class="line">                            binCount = <span class="number">2</span>;</span><br><span class="line">                            <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                                           value)) != <span class="literal">null</span>) &#123;</span><br><span class="line">                                oldVal = p.val;</span><br><span class="line">                                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                    p.val = value;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                        treeifyBin(tab, i);</span><br><span class="line">                    <span class="keyword">if</span> (oldVal != <span class="literal">null</span>)</span><br><span class="line">                        <span class="keyword">return</span> oldVal;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="7、Callable"><a href="#7、Callable" class="headerlink" title="7、Callable"></a>7、Callable</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//callable与Runnable的不同</span></span><br><span class="line"><span class="comment">//1.Callable的call方法有返回值和能抛出异常</span></span><br><span class="line"><span class="comment">//2.Runnable的run方法没有返回值，不能抛出异常</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Callable</span>&lt;V&gt; &#123;</span><br><span class="line">    V <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">ThreadCall</span>());</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask).start();<span class="comment">//FutureTask的结果会被缓存，效率较高</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> futureTask.get();<span class="comment">//阻塞式 获取call的返回值，一般放在最后</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadCall</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8、常用辅助类"><a href="#8、常用辅助类" class="headerlink" title="8、常用辅助类"></a>8、常用辅助类</h2><h3 id="8-1-CountDownLatch"><a href="#8-1-CountDownLatch" class="headerlink" title="8.1 CountDownLatch"></a>8.1 CountDownLatch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//保证线程的一组操作完成之后其他线程才能执行 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//设置初始值，在初始值被减为0之前所有的其他线程处于等待状态，</span></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;--&gt;&quot;</span>+ temp);</span><br><span class="line">                countDownLatch.countDown();<span class="comment">//每调用一次初始值减一</span></span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        countDownLatch.await();<span class="comment">//等待初始值减为0，初始值减为0，放行后面的操作</span></span><br><span class="line">        System.out.println(<span class="string">&quot;其他线程可以继续执行了。。。。&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-CyclicBarrier"><a href="#8-2-CyclicBarrier" class="headerlink" title="8.2 CyclicBarrier"></a>8.2 CyclicBarrier</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//循环直到屏障点，才执行其他线程 </span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">CyclicBarrier</span><span class="params">(<span class="type">int</span> parties, Runnable barrierAction)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">CyclicBarrier</span><span class="params">(<span class="type">int</span> parties)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">cyclicBarrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">7</span>,()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;到达屏障点&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot; 执行&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cyclicBarrier.await();<span class="comment">//等待直到到达屏障点</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Semaphore</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//信号量主要用于限流使用， 多个共享资源互斥使用，控制线程数量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//信号量，表示只能有3个线程运行，其他线程要等待，直到有线程释放</span></span><br><span class="line">        <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();<span class="comment">//获取执行位置，如果执行位置已满，其他线程处于等待状态</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; git location&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; go out&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();<span class="comment">//释放执行位置，其他线程可以抢占执行位置</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="9、读写锁"><a href="#9、读写锁" class="headerlink" title="9、读写锁"></a>9、读写锁</h2><ul>
<li>ReadWriteLock：保证读的时候可以多线程读，写的时候只有一个线程在写</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读锁：共享锁，可以允许多个线程读</span></span><br><span class="line"><span class="comment">//写锁：独占锁，只允许一个线程写</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">CacheLock</span> <span class="variable">cacheLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CacheLock</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                cacheLock.write(<span class="string">&quot;&quot;</span>+temp,<span class="string">&quot;&quot;</span>+temp);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                System.out.println(cacheLock.read(<span class="string">&quot;&quot;</span> + temp));</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CacheLock</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">ReadWriteLock</span> <span class="variable">readWriteLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">read</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        readWriteLock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot; 开始读.......&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot; 读结束.......&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readWriteLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String key,String value)</span>&#123;</span><br><span class="line">        readWriteLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot; 写开始.....&quot;</span>);</span><br><span class="line">            map.put(key,value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot; 写结束.....&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readWriteLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10、阻塞队列"><a href="#10、阻塞队列" class="headerlink" title="10、阻塞队列"></a>10、阻塞队列</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622652435166-601da532-c9e6-4e16-bf6b-8395c4309f89.png#align=left&display=inline&height=563&margin=[object%20Object]&name=image.png&originHeight=1126&originWidth=1527&size=281527&status=done&style=none&width=763.5" alt="image.png" title="image.png"></p>
<ul>
<li><p>当写入的时候，如果队列满了，就会进入阻塞状态</p>
</li>
<li><p>当出队的时候，当队列空了，就会进入阻塞状态</p>
</li>
<li><p>一般在线程池或者多线程并发处理时使用</p>
</li>
<li><p>阻塞队列添加和删除的四组API</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622652700578-7c59c297-5060-440b-940e-17832df2103d.png#align=left\&amp;display=inline\&amp;height=170\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=340\&amp;originWidth=1479\&amp;size=71328\&amp;status=done\&amp;style=none\&amp;width=739.5&gt; &quot;image.png&quot;)
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有返回值，会抛出异常 </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayBlockingQueue&lt;String&gt; arrayBlockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        System.out.println(arrayBlockingQueue.add(<span class="string">&quot;1&quot;</span>));</span><br><span class="line">        System.out.println(arrayBlockingQueue.add(<span class="string">&quot;2&quot;</span>));</span><br><span class="line">        System.out.println(arrayBlockingQueue.add(<span class="string">&quot;3&quot;</span>));</span><br><span class="line"><span class="comment">//        System.out.println(arrayBlockingQueue.add(&quot;4&quot;));</span></span><br><span class="line">        System.out.println(arrayBlockingQueue.remove());</span><br><span class="line">        System.out.println(arrayBlockingQueue.remove());</span><br><span class="line">        System.out.println(arrayBlockingQueue.remove());</span><br><span class="line"><span class="comment">//        System.out.println(arrayBlockingQueue.remove());</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//有返回值不会抛出异常</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      ArrayBlockingQueue&lt;Integer&gt; arrayBlockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        System.out.println(arrayBlockingQueue.offer(<span class="number">1</span>));</span><br><span class="line">        System.out.println(arrayBlockingQueue.offer(<span class="number">2</span>));</span><br><span class="line">        System.out.println(arrayBlockingQueue.offer(<span class="number">3</span>));</span><br><span class="line">        System.out.println(arrayBlockingQueue.offer(<span class="number">4</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;==========================&quot;</span>);</span><br><span class="line">        System.out.println(arrayBlockingQueue.poll());</span><br><span class="line">        System.out.println(arrayBlockingQueue.poll());</span><br><span class="line">        System.out.println(arrayBlockingQueue.poll());</span><br><span class="line">        System.out.println(arrayBlockingQueue.poll());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//超过容量或者容量为空会一直阻塞</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">      ArrayBlockingQueue&lt;Integer&gt; arrayBlockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">       arrayBlockingQueue.put(<span class="number">1</span>);</span><br><span class="line">       arrayBlockingQueue.put(<span class="number">2</span>);</span><br><span class="line">       arrayBlockingQueue.put(<span class="number">3</span>);</span><br><span class="line"><span class="comment">//       arrayBlockingQueue.put(4);</span></span><br><span class="line">        System.out.println(arrayBlockingQueue.take());</span><br><span class="line">        System.out.println(arrayBlockingQueue.take());</span><br><span class="line">        System.out.println(arrayBlockingQueue.take());</span><br><span class="line">        System.out.println(arrayBlockingQueue.take());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//带有参数的offer和poll在超过指定时间之后会停止</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">      ArrayBlockingQueue&lt;Integer&gt; arrayBlockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">      arrayBlockingQueue.offer(<span class="number">1</span>);</span><br><span class="line">      arrayBlockingQueue.offer(<span class="number">1</span>);</span><br><span class="line">      arrayBlockingQueue.offer(<span class="number">1</span>);</span><br><span class="line">      arrayBlockingQueue.offer(<span class="number">1</span>,<span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">        System.out.println(arrayBlockingQueue.poll());</span><br><span class="line">        System.out.println(arrayBlockingQueue.poll());</span><br><span class="line">        System.out.println(arrayBlockingQueue.poll());</span><br><span class="line">        System.out.println(arrayBlockingQueue.poll(<span class="number">3</span>,TimeUnit.SECONDS));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>SynchronousQueue 同步队列</p>
<ul>
<li>同步队列没有容量，只能存储一个元素，元素进去之后，必须取出才能存放下一个元素。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        SynchronousQueue&lt;String&gt; strings = <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;();</span><br><span class="line">        strings.put(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="comment">//        System.out.println(strings.take());</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="11、线程池"><a href="#11、线程池" class="headerlink" title="11、线程池"></a>11、线程池</h2><ul>
<li><p>线程池掌握三大方法、七大参数、四大拒绝策略</p>
</li>
<li><p>池化技术：提前将资源准备好放入池中，需要的时候从池中取出，用完之后放回池中。</p>
</li>
<li><p>线程池的好处：</p>
<ul>
<li><p>降低资源的消耗</p>
</li>
<li><p>提高响应速度</p>
</li>
<li><p>方便管理</p>
</li>
<li><p>可以实现线程复用，可以控制最大并发数，管理线程。</p>
</li>
</ul>
</li>
<li><p>线程池三大方法</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//线程池中只有一个线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span></span><br><span class="line">            (<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                    <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//线程池中可以有指定个数线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                      <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//线程池中初始没有线程，最大线程数为Integer.MAX_VALUE</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                      <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        ExecutorService pool = Executors.newSingleThreadExecutor();</span></span><br><span class="line"><span class="comment">//        ExecutorService pool = Executors.newFixedThreadPool(3);</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;<span class="number">10</span> ; i++) &#123;</span><br><span class="line">                <span class="comment">//执行线程 void execute(Runnable command);</span></span><br><span class="line">                pool.execute(()-&gt;&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//使用完线程池之后关闭线程池。</span></span><br><span class="line">            pool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622656599295-95087164-4218-4699-9896-6358e2670c10.png#align=left&display=inline&height=234&margin=[object%20Object]&name=image.png&originHeight=468&originWidth=1454&size=343567&status=done&style=none&width=727" alt="image.png" title="image.png"></p>
<ul>
<li>七大参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,//核心线程数</span></span><br><span class="line"><span class="params">                              <span class="type">int</span> maximumPoolSize,//最大线程数</span></span><br><span class="line"><span class="params">                              <span class="type">long</span> keepAliveTime,//线程存活时间</span></span><br><span class="line"><span class="params">                              TimeUnit unit,//存活时间单位</span></span><br><span class="line"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,//阻塞队列</span></span><br><span class="line"><span class="params">                              ThreadFactory threadFactory,//线程工厂，一般不动</span></span><br><span class="line"><span class="params">                              RejectedExecutionHandler handler//当线程池不能提供服务时的拒绝策略</span></span><br><span class="line"><span class="params">                              )</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">            keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">        <span class="keyword">if</span> (workQueue == <span class="literal">null</span> || threadFactory == <span class="literal">null</span> || handler == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">        <span class="built_in">this</span>.acc = System.getSecurityManager() == <span class="literal">null</span> ?</span><br><span class="line">                <span class="literal">null</span> :</span><br><span class="line">                AccessController.getContext();</span><br><span class="line">        <span class="built_in">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">        <span class="built_in">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">        <span class="built_in">this</span>.workQueue = workQueue;</span><br><span class="line">        <span class="built_in">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">        <span class="built_in">this</span>.threadFactory = threadFactory;</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622657094810-4bac9ea4-82dd-4413-8f0a-8ff9152930a1.png#align=left&display=inline&height=421&margin=[object%20Object]&name=image.png&originHeight=841&originWidth=1428&size=129181&status=done&style=none&width=714" alt="image.png" title="image.png"></p>
<ul>
<li><p>当阻塞队列和核心线程数满的时候会触发最大线程工作</p>
</li>
<li><p>当阻塞队列和最大线程数满的时候会触发拒绝策略</p>
</li>
<li><p>四种拒绝策略</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当线程池不能提供服务时，由当前线程处理  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CallerRunsPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">CallerRunsPolicy</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) &#123;</span><br><span class="line">                r.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//当线程池不能提供服务时，抛出异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AbortPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">AbortPolicy</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RejectedExecutionException</span>(<span class="string">&quot;Task &quot;</span> + r.toString() +</span><br><span class="line">                                                 <span class="string">&quot; rejected from &quot;</span> +</span><br><span class="line">                                                 e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//当线程池不能提供服务时，拒绝处理不抛出异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DiscardPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">DiscardPolicy</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//当线程池不能提供服务时,尝试着和最先进入的线程竞争，不会抛出异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DiscardOldestPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">DiscardOldestPolicy</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) &#123;</span><br><span class="line">                e.getQueue().poll();</span><br><span class="line">                e.execute(r);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>线程池的最大大小如何设置</p>
<ul>
<li><p>CPU密集型</p>
</li>
<li><p>IO密集型</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、CPU 密集型，几核，就是几，可以保持CPu的效率最高！</span></span><br><span class="line"><span class="comment">// 2、IO 密集型 &gt; 判断你程序中十分耗IO的线程，</span></span><br></pre></td></tr></table></figure>

<h2 id="12、四大函数式接口"><a href="#12、四大函数式接口" class="headerlink" title="12、四大函数式接口"></a>12、四大函数式接口</h2><ul>
<li>只含有一个抽象方法的接口，称为函数式接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Function</span>&lt;T, R&gt; &#123;</span><br><span class="line">    R <span class="title function_">apply</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Predicate</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Consumer</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Supplier</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">get</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Function&lt;String,String &gt; function = (str)-&gt;&#123;<span class="keyword">return</span> str;&#125;;</span><br><span class="line">        Predicate&lt;String&gt; predicate = (str)-&gt;&#123;<span class="keyword">return</span> <span class="literal">true</span>;&#125;;</span><br><span class="line">        Consumer&lt;String&gt; consumer = (str)-&gt;&#123;</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;;</span><br><span class="line">        Supplier&lt;String&gt; stringSupplier = ()-&gt;&#123;<span class="keyword">return</span> <span class="string">&quot;1024&quot;</span>;&#125;;</span><br><span class="line">        System.out.println(function.apply(<span class="string">&quot;123&quot;</span>));</span><br><span class="line">        System.out.println(predicate.test(<span class="string">&quot;1024&quot;</span>));</span><br><span class="line">        consumer.accept(<span class="string">&quot;1024&quot;</span>);</span><br><span class="line">        System.out.println(stringSupplier.get());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Lambda表达式</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622726813167-f8e355b0-0bcf-4581-a73d-fdfae1dd6610.png#align=left\&amp;display=inline\&amp;height=476\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=952\&amp;originWidth=1983\&amp;size=241070\&amp;status=done\&amp;style=none\&amp;width=991.5&gt; &quot;image.png&quot;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622726858475-eb642586-4f90-4392-af44-4d1cfc282f76.png#align=left\&amp;display=inline\&amp;height=497\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=994\&amp;originWidth=2028\&amp;size=204388\&amp;status=done\&amp;style=none\&amp;width=1014&gt; &quot;image.png&quot;)
</code></pre>
</li>
<li><p>方法引用</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622727376309-cd55ba0f-8858-4bca-98cf-7c52b40681ae.png#align=left\&amp;display=inline\&amp;height=107\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=213\&amp;originWidth=420\&amp;size=31284\&amp;status=done\&amp;style=none\&amp;width=210&gt; &quot;image.png&quot;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622727800868-ef4d105b-487a-46f6-9167-346fad879bdf.png#align=left\&amp;display=inline\&amp;height=506\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=1011\&amp;originWidth=1744\&amp;size=124067\&amp;status=done\&amp;style=none\&amp;width=872&gt; &quot;image.png&quot;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622727919340-872b758a-d851-492e-9e32-099c977a11f0.png#align=left\&amp;display=inline\&amp;height=470\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=940\&amp;originWidth=2067\&amp;size=180452\&amp;status=done\&amp;style=none\&amp;width=1033.5&gt; &quot;image.png&quot;)
</code></pre>
</li>
<li><p>构造器引用</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622728234167-61652309-19d0-4372-8dca-0d48076291fa.png#align=left\&amp;display=inline\&amp;height=434\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=867\&amp;originWidth=2134\&amp;size=263401\&amp;status=done\&amp;style=none\&amp;width=1067&gt; &quot;image.png&quot;)
</code></pre>
</li>
</ul>
<h2 id="13、Stream-API"><a href="#13、Stream-API" class="headerlink" title="13、Stream API"></a>13、Stream API</h2><ul>
<li><p>Stream自己不会存储元素</p>
</li>
<li><p>Stream不会改变源对象，相反Steam会返回一个持有结果的新的Stream对象</p>
</li>
<li><p>Stream是延迟操作的，当需要结果时它才执行</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622729013893-b30caf71-8af5-4fc4-8cb3-5499a67011b6.png#align=left\&amp;display=inline\&amp;height=555\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=1110\&amp;originWidth=2086\&amp;size=282380\&amp;status=done\&amp;style=none\&amp;width=1043&gt; &quot;image.png&quot;)
</code></pre>
<ul>
<li>创建Stream流的方式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.Collection接口中提供了两个创建Stream流的方法</span></span><br><span class="line"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title function_">stream</span><span class="params">()</span> &#123;&#125; <span class="comment">//创建串行流</span></span><br><span class="line"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title function_">parallelStream</span><span class="params">()</span> &#123;&#125;<span class="comment">//创建并行流</span></span><br><span class="line"><span class="comment">//2.通过数组创建Stream流,使用Arrays工具中的静态方法创建流，可以接受任意类型的数组</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Stream&lt;T&gt; <span class="title function_">stream</span><span class="params">(T[] array)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title function_">stream</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> LongStream <span class="title function_">stream</span><span class="params">(<span class="type">long</span>[] array)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> DoubleStream <span class="title function_">stream</span><span class="params">(<span class="type">double</span>[] array)</span>&#123;&#125;</span><br><span class="line"><span class="comment">//3.通过Stream的静态方法of创建流，可以接受任意参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">of</span><span class="params">(T... values)</span> &#123;&#125;</span><br><span class="line"><span class="comment">//4.创建无限流,Stream的静态方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">iterate</span><span class="params">(<span class="keyword">final</span> T seed, <span class="keyword">final</span> UnaryOperator&lt;T&gt; f)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">generate</span><span class="params">(Supplier&lt;T&gt; s)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream&lt;Integer&gt; iterate = Stream.iterate(<span class="number">0</span>, x -&gt; x + <span class="number">2</span>);</span><br><span class="line">        iterate.limit(<span class="number">10</span>).forEach(System.out::println);</span><br><span class="line">        Stream&lt;Double&gt; generate = Stream.generate(Math::random);</span><br><span class="line">        generate.limit(<span class="number">10</span>).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Stream的中间操作</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622730253605-c875b9eb-9cd0-4dd1-83fa-33f646084fd3.png#align=left\&amp;display=inline\&amp;height=344\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=687\&amp;originWidth=2090\&amp;size=221667\&amp;status=done\&amp;style=none\&amp;width=1045&gt; &quot;image.png&quot;)
</code></pre>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622730273698-b571e86b-c675-4ff5-9001-f46418898953.png#align=left\&amp;display=inline\&amp;height=505\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=1010\&amp;originWidth=2112\&amp;size=357264\&amp;status=done\&amp;style=none\&amp;width=1056&gt; &quot;image.png&quot;)

![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622730288223-6f78cd27-77f2-4a24-9558-bf013d41e4cb.png#align=left\&amp;display=inline\&amp;height=357\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=713\&amp;originWidth=1915\&amp;size=112415\&amp;status=done\&amp;style=none\&amp;width=957.5&gt; &quot;image.png&quot;)
</code></pre>
</li>
<li><p>Stream流的终止操作</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622731160354-f8d87931-40b9-4c07-aff8-3dc3b43d466e.png#align=left\&amp;display=inline\&amp;height=363\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=726\&amp;originWidth=2005\&amp;size=179115\&amp;status=done\&amp;style=none\&amp;width=1002.5&gt; &quot;image.png&quot;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622731407270-d582198e-0b06-463a-8720-9e3dd62d5182.png#align=left\&amp;display=inline\&amp;height=356\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=711\&amp;originWidth=2029\&amp;size=201205\&amp;status=done\&amp;style=none\&amp;width=1014.5&gt; &quot;image.png&quot;)
</code></pre>
<!---->

<pre><code>![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622731462652-635a0d40-d3a5-45df-bfe3-577e8106318a.png#align=left\&amp;display=inline\&amp;height=425\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=849\&amp;originWidth=2012\&amp;size=191012\&amp;status=done\&amp;style=none\&amp;width=1006&gt; &quot;image.png&quot;)

![image.png](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1622731505796-b0c71d43-2216-4e2b-a651-a0c9e01e8eab.png#align=left\&amp;display=inline\&amp;height=442\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=883\&amp;originWidth=2086\&amp;size=216900\&amp;status=done\&amp;style=none\&amp;width=1043&gt; &quot;image.png&quot;)
</code></pre>
</li>
</ul>
<h2 id="14、ForkJoin"><a href="#14、ForkJoin" class="headerlink" title="14、ForkJoin"></a>14、ForkJoin</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622731862143-d2959205-49de-42b1-9008-8c207c9085cd.png#align=left&display=inline&height=580&margin=[object%20Object]&name=image.png&originHeight=1160&originWidth=1296&size=244712&status=done&style=none&width=648" alt="image.png" title="image.png"></p>
<ul>
<li>ForkJoin的工作特点：工作窃取，，维持的是双端队列</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622731923773-379ae761-72a3-42c1-831f-6baa79f7e128.png#align=left&display=inline&height=588&margin=[object%20Object]&name=image.png&originHeight=1176&originWidth=792&size=104474&status=done&style=none&width=396" alt="image.png" title="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622732273291-0c3e6de2-d24a-45b3-9b52-12562426a341.png#align=left&display=inline&height=223&margin=[object%20Object]&name=image.png&originHeight=446&originWidth=1091&size=121697&status=done&style=none&width=545.5" alt="image.png" title="image.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> collectionsource;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinTask;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.RecursiveTask;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span>  <span class="keyword">extends</span> <span class="title class_">RecursiveTask</span>&lt;Long&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> start ;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> end;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo</span><span class="params">(<span class="type">long</span> start,<span class="type">long</span> end)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">10000L</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Long <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((end-start) &lt; temp)&#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">Long</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt;= end; i++) &#123;</span><br><span class="line">                sum += i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">middle</span> <span class="operator">=</span> (start+end)/<span class="number">2</span>;</span><br><span class="line">            <span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>(start, middle);</span><br><span class="line">            demo.fork();<span class="comment">//拆分任务</span></span><br><span class="line">            <span class="type">Demo</span> <span class="variable">demo1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>(middle + <span class="number">1</span>, end);</span><br><span class="line">            demo1.fork();<span class="comment">//拆分任务</span></span><br><span class="line">            <span class="keyword">return</span> demo.join()+demo1.join();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">forkJoinPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>();</span><br><span class="line">        <span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>(<span class="number">0L</span>, <span class="number">100000000L</span>);</span><br><span class="line">        ForkJoinTask&lt;Long&gt; submit = forkJoinPool.submit(demo);</span><br><span class="line">        System.out.println(submit.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="15、异步回调"><a href="#15、异步回调" class="headerlink" title="15、异步回调"></a>15、异步回调</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> collectionsource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="comment">//没有返回值的异步回调</span></span><br><span class="line">        <span class="comment">//        CompletableFuture&lt;Void&gt; runAsync = CompletableFuture.runAsync(() -&gt; &#123;</span></span><br><span class="line"><span class="comment">//            try &#123;</span></span><br><span class="line"><span class="comment">//                TimeUnit.SECONDS.sleep(3);</span></span><br><span class="line"><span class="comment">//            &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">//                e.printStackTrace();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            System.out.println(Thread.currentThread().getName() + &quot;--&gt; runAsync&quot;);</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;===========&quot;);</span></span><br><span class="line"><span class="comment">//        runAsync.get();</span></span><br><span class="line">        <span class="comment">//有返回值的异步回调</span></span><br><span class="line">        CompletableFuture&lt;Integer&gt; supplyAsync = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;--&gt; supplyAsync&quot;</span>);</span><br><span class="line"><span class="comment">//            int i = 10 / 0;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(supplyAsync.whenComplete((t, u) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;t--&gt;&quot;</span> + t);<span class="comment">//正常的返回结果</span></span><br><span class="line">            System.out.println(<span class="string">&quot;u--&gt;&quot;</span> + u);<span class="comment">//返回错误信息</span></span><br><span class="line">        &#125;).exceptionally(e -&gt; &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;<span class="comment">//返回错误信息</span></span><br><span class="line">        &#125; ).get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="16、JMM"><a href="#16、JMM" class="headerlink" title="16、JMM"></a>16、JMM</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622734291117-8c88091d-7670-489a-94f3-44feaf802088.png#align=left&display=inline&height=336&margin=[object%20Object]&name=image.png&originHeight=671&originWidth=1067&size=59115&status=done&style=none&width=533.5" alt="image.png" title="image.png"></p>
<ul>
<li><p>volatile java提供的一种轻量级同步机制</p>
<ul>
<li><p>保证可见性</p>
</li>
<li><p>不保证原子性</p>
</li>
<li><p>禁止指令重排、使用内存屏障</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">内存交互操作有8种，虚拟机实现必须保证每一个操作都是原子的，不可在分的（对于double和long类型的变量来说，load、store、read和write操作在某些平台上允许例外）</span><br><span class="line">lock （锁定）：作用于主内存的变量，把一个变量标识为线程独占状态</span><br><span class="line">unlock （解锁）：作用于主内存的变量，它把一个处于锁定状态的变量释放出来，释放后的变量才可以被其他线程锁定</span><br><span class="line">read （读取）：作用于主内存变量，它把一个变量的值从主内存传输到线程的工作内存中，以便随后的load动作使用</span><br><span class="line">load （载入）：作用于工作内存的变量，它把read操作从主存中变量放入工作内存中</span><br><span class="line">use （使用）：作用于工作内存中的变量，它把工作内存中的变量传输给执行引擎，每当虚拟机遇到一个需要使用到变量的值，就会使用到这个指令</span><br><span class="line">assign （赋值）：作用于工作内存中的变量，它把一个从执行引擎中接受到的值放入工作内存的变量副本中</span><br><span class="line">store （存储）：作用于主内存中的变量，它把一个从工作内存中一个变量的值传送到主内存中，</span><br><span class="line">以便后续的write使用write （写入）：作用于主内存中的变量，它把store操作从工作内存中得到的变量的值放入主内存的变量中</span><br><span class="line">JMM对这八种指令的使用，制定了如下规则：</span><br><span class="line">不允许read和load、store和write操作之一单独出现。即使用了read必须load，使用了store必须write</span><br><span class="line">不允许线程丢弃他最近的assign操作，即工作变量的数据改变了之后，必须告知主存</span><br><span class="line">不允许一个线程将没有assign的数据从工作内存同步回主内存</span><br><span class="line">一个新的变量必须在主内存中诞生，不允许工作内存直接使用一个未被初始化的变量。就是怼变量</span><br><span class="line">实施use、store操作之前，必须经过assign和load操作</span><br><span class="line">一个变量同一时间只有一个线程能对其进行lock。多次lock后，必须执行相同次数的unlock才能解锁</span><br><span class="line">如果对一个变量进行lock操作，会清空所有工作内存中此变量的值，在执行引擎使用这个变量前，</span><br><span class="line">必须重新load或assign操作初始化变量的值</span><br><span class="line">如果一个变量没有被lock，就不能对其进行unlock操作。也不能unlock一个被其他线程锁住的变量</span><br><span class="line">对一个变量进行unlock操作之前，必须把此变量同步回主内存</span><br></pre></td></tr></table></figure>

<h2 id="17、单例模式"><a href="#17、单例模式" class="headerlink" title="17、单例模式"></a>17、单例模式</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//饿汉式单例模式、可能会导致资源的浪费，类一加载就创建对象，但是对象可能不会马上用到</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span>&#123;</span><br><span class="line">    <span class="comment">//构造器私有化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Demo</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Demo</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Demo <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//DCL 懒汉式 单例模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span>&#123;</span><br><span class="line">    <span class="comment">//构造器私有化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Demo</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span>  Demo INSTANCE ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Demo <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(INSTANCE == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Demo.class)&#123;</span><br><span class="line">                <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>)</span><br><span class="line">                    INSTANCE = <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//静态内部类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Holder</span><span class="params">()</span>&#123;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Holder <span class="title function_">getInstace</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> InnerClass.HOLDER;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InnerClass</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Holder</span> <span class="variable">HOLDER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Holder</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingle</span> &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line">    <span class="keyword">public</span> EnumSingle <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="18、CAS"><a href="#18、CAS" class="headerlink" title="18、CAS"></a>18、CAS</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">integer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//比较并交换，如果当前值满足期望值，就更新。</span></span><br><span class="line">        System.out.println(integer.compareAndSet(<span class="number">10</span>, <span class="number">20</span>));</span><br><span class="line">        System.out.println(integer.get());</span><br><span class="line">    &#125;</span><br><span class="line">CAS ： 比较当前工作内存中的值和主内存中的值，如果这个值是期望的，那么则执行操作！如果不是就</span><br><span class="line">一直循环！</span><br><span class="line">缺点：</span><br><span class="line"><span class="number">1</span>、 循环会耗时</span><br><span class="line"><span class="number">2</span>、一次性只能保证一个共享变量的原子性</span><br><span class="line"><span class="number">3</span>、ABA问题</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ABA问题</p>
<ul>
<li>一个线程连续更改了主内存中的共享变量多次，又变为了原来的值，但是其他线程并不知道它的修改操作，并且这个值又是其他线程的期望值。</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1622736464812-0b73e441-c119-49a4-bd5a-3003568aa74b.png#align=left&display=inline&height=320&margin=[object%20Object]&name=image.png&originHeight=640&originWidth=1138&size=91037&status=done&style=none&width=569" alt="image.png" title="image.png"></p>
<h2 id="19、原子引用解决ABA问题"><a href="#19、原子引用解决ABA问题" class="headerlink" title="19、原子引用解决ABA问题"></a>19、原子引用解决ABA问题</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> collectionsource;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicStampedReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        AtomicStampedReference&lt;Integer&gt; stampedReference = <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>&lt;&gt;(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;--&gt;版本号：&quot;</span>+stampedReference.getStamp());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            stampedReference.compareAndSet(<span class="number">1</span>,<span class="number">2</span>,stampedReference.getStamp(),stampedReference.getStamp()+<span class="number">1</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;--&gt;版本号：&quot;</span>+stampedReference.getStamp());</span><br><span class="line">            stampedReference.compareAndSet(<span class="number">2</span>,<span class="number">1</span>,stampedReference.getStamp(),stampedReference.getStamp()+<span class="number">1</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;--&gt;版本号：&quot;</span>+stampedReference.getStamp());</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> stampedReference.getStamp();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;--&gt;版本号：&quot;</span>+stamp);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">10</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//版本号不同，修改失败，类似于乐观锁</span></span><br><span class="line">            System.out.println(stampedReference.compareAndSet(<span class="number">1</span>, <span class="number">666</span>, stamp, stamp + <span class="number">1</span>));</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;--&gt;版本号：&quot;</span>+stampedReference.getStamp());</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="20、各种锁"><a href="#20、各种锁" class="headerlink" title="20、各种锁"></a>20、各种锁</h2><ul>
<li><p>公平锁与非公平锁</p>
</li>
<li><p>可重入锁</p>
</li>
<li><p>自旋锁</p>
</li>
<li><p>死锁</p>
</li>
<li><p>……….</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://chenjinsongcjs.github.io/2022/08/28/MyBatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cjsstart">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technological learning">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/28/MyBatis/" class="post-title-link" itemprop="url">MyBatis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              

              <time title="Erstellt: 2022-08-28 19:23:04 / Geändert am: 19:23:26" itemprop="dateCreated datePublished" datetime="2022-08-28T19:23:04+08:00">2022-08-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><h1 id="一、MyBatis简介"><a href="#一、MyBatis简介" class="headerlink" title="一、MyBatis简介"></a>一、MyBatis简介</h1><ul>
<li><p>MyBatis是支持定制化SQL，存储过程以及高级映射的持久层框架</p>
</li>
<li><p>MyBatis避免了几乎所有的JDBC代码和手动设置参数以及获取结果集</p>
</li>
<li><p>MyBatis可使用简单的XML或注解用于配置和原始映射，将接口和java 的POJO映射成数据库中的记录</p>
</li>
</ul>
<h2 id="1、为什么要用MyBatis"><a href="#1、为什么要用MyBatis" class="headerlink" title="1、为什么要用MyBatis"></a>1、为什么要用MyBatis</h2><ul>
<li><p>MyBatis是一个半自动化的持久层框架</p>
</li>
<li><p>JDBC</p>
<ul>
<li><p>SQL加载java代码后，耦合度高导致编码内伤</p>
</li>
<li><p>维护不易且实际开发需求中sql有变化，频繁修改情况多见</p>
</li>
</ul>
</li>
<li><p>Hibernate和JPA</p>
<ul>
<li><p>长难复杂SQL、对于Hibernate而言处理也不容易</p>
</li>
<li><p>内部自动生产的SQL，不容易做特殊优化</p>
</li>
<li><p>基于全面映射的自动框架，大量的POJO进行部分映射时比较困难。导致数据库性能下降。</p>
</li>
</ul>
</li>
<li><p>对开发人员而言，核心sql还是需要自己优化</p>
</li>
<li><p>SQL和java编码分开，功能边界清晰，一个专注业务、一个专注数据。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html" title="MyBatis官网">MyBatis官网</a></p>
</li>
</ul>
<h1 id="二、MyBatis-HelloWorld"><a href="#二、MyBatis-HelloWorld" class="headerlink" title="二、MyBatis-HelloWorld"></a>二、MyBatis-HelloWorld</h1><h2 id="1、建立数据库与Java对象之间的关系-ORM"><a href="#1、建立数据库与Java对象之间的关系-ORM" class="headerlink" title="1、建立数据库与Java对象之间的关系(ORM)"></a>1、建立数据库与Java对象之间的关系(ORM)</h2><h2 id="2、创建MyBatis的配置文件"><a href="#2、创建MyBatis的配置文件" class="headerlink" title="2、创建MyBatis的配置文件"></a>2、创建MyBatis的配置文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定sql映射文件的地址--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3、创建MyBatis的SQL映射文件"><a href="#3、创建MyBatis的SQL映射文件" class="headerlink" title="3、创建MyBatis的SQL映射文件"></a>3、创建MyBatis的SQL映射文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4、测试"><a href="#4、测试" class="headerlink" title="4、测试"></a>4、测试</h2><h3 id="4-1、根据全局配置文件，利用SqlSessionFactoryBuilder创建SqlSessionFactory"><a href="#4-1、根据全局配置文件，利用SqlSessionFactoryBuilder创建SqlSessionFactory" class="headerlink" title="4.1、根据全局配置文件，利用SqlSessionFactoryBuilder创建SqlSessionFactory"></a>4.1、根据全局配置文件，利用SqlSessionFactoryBuilder创建SqlSessionFactory</h3><h3 id="4-2、使用SqlSessionFactory获取SqlSession对象。一个SqlSession对象代表和数据库的一次会话。"><a href="#4-2、使用SqlSessionFactory获取SqlSession对象。一个SqlSession对象代表和数据库的一次会话。" class="headerlink" title="4.2、使用SqlSessionFactory获取SqlSession对象。一个SqlSession对象代表和数据库的一次会话。"></a>4.2、使用SqlSessionFactory获取SqlSession对象。一个SqlSession对象代表和数据库的一次会话。</h3><h3 id="4-3、使用SqlSession根据方法id进行操作"><a href="#4-3、使用SqlSession根据方法id进行操作" class="headerlink" title="4.3、使用SqlSession根据方法id进行操作"></a>4.3、使用SqlSession根据方法id进行操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> openSession.selectOne(</span><br><span class="line">          <span class="string">&quot;com.atguigu.mybatis.EmployeeMapper.selectEmp&quot;</span>, <span class="number">1</span>);</span><br><span class="line">  System.out.println(employee);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      openSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4、接口式编程"><a href="#4-4、接口式编程" class="headerlink" title="4.4、接口式编程"></a>4.4、接口式编程</h3><ul>
<li><p>创建Dao接口</p>
</li>
<li><p>修改mapper文件</p>
</li>
<li><p>测试</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、获取sqlSessionFactory对象</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line">    <span class="comment">// 2、获取sqlSession对象</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 3、获取接口的实现类对象</span></span><br><span class="line">      <span class="comment">//会为接口自动的创建一个代理对象，代理对象去执行增删改查方法</span></span><br><span class="line">      <span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">      <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">      System.out.println(mapper.getClass());</span><br><span class="line">      System.out.println(employee);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      openSession.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>注：</strong></p>
<ul>
<li><p>SqlSession是线程不安全的，因此不能共享。</p>
</li>
<li><p>SQLSession每次用完都需要关闭。</p>
</li>
<li><p>SqlSession可以直接调用方法的id进行数据库操 作，但是我们一般还是推荐使用SqlSession获取 到Dao接口的代理类，执行代理对象的方法，可 以更安全的进行类型检查操作</p>
</li>
</ul>
</li>
</ul>
<h1 id="三、MyBatis-全局配置文件"><a href="#三、MyBatis-全局配置文件" class="headerlink" title="三、MyBatis-全局配置文件"></a>三、MyBatis-全局配置文件</h1><ul>
<li><p>MyBatis全局配置文件包含了影响MyBatis甚深的设置（settings）和属性（properties）信息。(MyBatis配置文件书写顺序要严格按照下面的顺序)</p>
</li>
<li><p>configuration（配置）</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#properties" title="properties（属性）">properties（属性）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#settings" title="settings（设置）">settings（设置）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeAliases" title="typeAliases（类型别名）">typeAliases（类型别名）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers" title="typeHandlers（类型处理器）">typeHandlers（类型处理器）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory" title="objectFactory（对象工厂）">objectFactory（对象工厂）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#plugins" title="plugins（插件）">plugins（插件）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#environments" title="environments（环境配置）">environments（环境配置）</a></p>
<ul>
<li><p>environment（环境变量）</p>
<ul>
<li><p>transactionManager（事务管理器）</p>
</li>
<li><p>dataSource（数据源）</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#databaseIdProvider" title="databaseIdProvider（数据库厂商标识）">databaseIdProvider（数据库厂商标识）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#mappers" title="mappers（映射器）">mappers（映射器）</a></p>
</li>
</ul>
</li>
</ul>
<h2 id="1、properties属性"><a href="#1、properties属性" class="headerlink" title="1、properties属性"></a>1、properties属性</h2><ul>
<li><p>读取外部配置文件</p>
</li>
<li><p>这些属性可以在外部进行配置，并可以进行动态替换，你既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/config.properties&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dev_user&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;F2Fa3!33TYyg&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果一个属性在不只一个地方进行了配置，那么，MyBatis 将按照下面的顺序来加载：</p>
<ul>
<li><p>首先读取在 properties 元素体内指定的属性。</p>
</li>
<li><p>然后根据 properties 元素中的 resource 属性读取类路径下属性文件，或根据 url 属性指定的路径读取属性文件，并覆盖之前读取过的同名属性。</p>
</li>
<li><p>最后读取作为方法参数传递的属性，并覆盖之前读取过的同名属性。</p>
</li>
</ul>
<p><strong>通过方法参数传递的属性具有最高优先级，resource&#x2F;url 属性中指定的配置文件次之，最低优先级的则是 properties 元素中指定的属性。</strong></p>
<h2 id="2、设置（settings）"><a href="#2、设置（settings）" class="headerlink" title="2、设置（settings）"></a>2、设置（settings）</h2><ul>
<li><p>这是MyBatis中极为重要的调整设置，他们会改变MyBatis的运行时行为。</p>
</li>
<li><p>配置的默认值</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;multipleResultSetsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useColumnLabel&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useGeneratedKeys&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PARTIAL&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingUnknownColumnBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;WARNING&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultExecutorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SIMPLE&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultStatementTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultFetchSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;safeRowBoundsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;localCacheScope&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SESSION&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTypeForNull&quot;</span> <span class="attr">value</span>=<span class="string">&quot;OTHER&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadTriggerMethods&quot;</span> <span class="attr">value</span>=<span class="string">&quot;equals,clone,hashCode,toString&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>设置名</strong></th>
<th><strong>描述</strong></th>
<th><strong>有效值</strong></th>
<th><strong>默认值</strong></th>
</tr>
</thead>
<tbody><tr>
<td>cacheEnabled</td>
<td>全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>lazyLoadingEnabled</td>
<td>延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 fetchType 属性来覆盖该项的开关状态。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>aggressiveLazyLoading</td>
<td>开启时，任一方法的调用都会加载该对象的所有延迟加载属性。 否则，每个延迟加载属性会按需加载（参考 lazyLoadTriggerMethods)。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>multipleResultSetsEnabled</td>
<td>是否允许单个语句返回多结果集（需要数据库驱动支持）。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>useColumnLabel</td>
<td>使用列标签代替列名。实际表现依赖于数据库驱动，具体可参考数据库驱动的相关文档，或通过对比测试来观察。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>useGeneratedKeys</td>
<td>允许 JDBC 支持自动生成主键，需要数据库驱动支持。如果设置为 true，将强制使用自动生成主键。尽管一些数据库驱动不支持此特性，但仍可正常工作（如 Derby）。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>autoMappingBehavior</td>
<td>指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套）。</td>
<td>NONE, PARTIAL, FULL</td>
<td>PARTIAL</td>
</tr>
<tr>
<td>autoMappingUnknownColumnBehavior</td>
<td>指定发现自动映射目标未知列（或未知属性类型）的行为。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>- NONE: 不做任何反应</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>- WARNING: 输出警告日志（’org.apache.ibatis.session.AutoMappingUnknownColumnBehavior’ 的日志等级必须设置为 WARN）</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>- FAILING: 映射失败 (抛出 SqlSessionException)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>NONE, WARNING, FAILING</td>
<td>NONE</td>
<td></td>
<td></td>
</tr>
<tr>
<td>defaultExecutorType</td>
<td>配置默认的执行器。SIMPLE 就是普通的执行器；REUSE 执行器会重用预处理语句（PreparedStatement）； BATCH 执行器不仅重用语句还会执行批量更新。</td>
<td>SIMPLE REUSE BATCH</td>
<td>SIMPLE</td>
</tr>
<tr>
<td>defaultStatementTimeout</td>
<td>设置超时时间，它决定数据库驱动等待数据库响应的秒数。</td>
<td>任意正整数</td>
<td>未设置 (null)</td>
</tr>
<tr>
<td>defaultFetchSize</td>
<td>为驱动的结果集获取数量（fetchSize）设置一个建议值。此参数只可以在查询设置中被覆盖。</td>
<td>任意正整数</td>
<td>未设置 (null)</td>
</tr>
<tr>
<td>defaultResultSetType</td>
<td>指定语句默认的滚动策略。（新增于 3.5.2）</td>
<td>FORWARD_ONLY</td>
<td>SCROLL_SENSITIVE</td>
</tr>
<tr>
<td>safeRowBoundsEnabled</td>
<td>是否允许在嵌套语句中使用分页（RowBounds）。如果允许使用则设置为 false。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>safeResultHandlerEnabled</td>
<td>是否允许在嵌套语句中使用结果处理器（ResultHandler）。如果允许使用则设置为 false。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>mapUnderscoreToCamelCase</td>
<td>是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>localCacheScope</td>
<td>MyBatis 利用本地缓存机制（Local Cache）防止循环引用和加速重复的嵌套查询。 默认值为 SESSION，会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地缓存将仅用于执行语句，对相同 SqlSession 的不同查询将不会进行缓存。</td>
<td>SESSION</td>
<td>STATEMENT</td>
</tr>
<tr>
<td>jdbcTypeForNull</td>
<td>当没有为参数指定特定的 JDBC 类型时，空值的默认 JDBC 类型。 某些数据库驱动需要指定列的 JDBC 类型，多数情况直接用一般类型即可，比如 NULL、VARCHAR 或 OTHER。</td>
<td>JdbcType 常量，常用值：NULL、VARCHAR 或 OTHER。</td>
<td>OTHER</td>
</tr>
<tr>
<td>lazyLoadTriggerMethods</td>
<td>指定对象的哪些方法触发一次延迟加载。</td>
<td>用逗号分隔的方法列表。</td>
<td>equals,clone,hashCode,toString</td>
</tr>
<tr>
<td>defaultScriptingLanguage</td>
<td>指定动态 SQL 生成使用的默认脚本语言。</td>
<td>一个类型别名或全限定类名。</td>
<td>org.apache.ibatis.scripting.xmltags.XMLLanguageDriver</td>
</tr>
<tr>
<td>defaultEnumTypeHandler</td>
<td>指定 Enum 使用的默认 TypeHandler 。（新增于 3.4.5）</td>
<td>一个类型别名或全限定类名。</td>
<td>org.apache.ibatis.type.EnumTypeHandler</td>
</tr>
<tr>
<td>callSettersOnNulls</td>
<td>指定当结果集中值为 null 的时候是否调用映射对象的 setter（map 对象时为 put）方法，这在依赖于 Map.keySet() 或 null 值进行初始化时比较有用。注意基本类型（int、boolean 等）是不能设置成 null 的。</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>returnInstanceForEmptyRow</td>
<td>当返回行的所有列都是空时，MyBatis默认返回 null。 当开启这个设置时，MyBatis会返回一个空实例。 请注意，它也适用于嵌套的结果集（如集合或关联）。（新增于 3.4.2）</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>logPrefix</td>
<td>指定 MyBatis 增加到日志名称的前缀。</td>
<td>任何字符串</td>
<td>未设置</td>
</tr>
<tr>
<td>logImpl</td>
<td>指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td>
<td>SLF4J</td>
<td>LOG4J</td>
</tr>
<tr>
<td>proxyFactory</td>
<td>指定 Mybatis 创建可延迟加载对象所用到的代理工具。</td>
<td>CGLIB</td>
<td>JAVASSIST</td>
</tr>
<tr>
<td>vfsImpl</td>
<td>指定 VFS 的实现</td>
<td>自定义 VFS 的实现的类全限定名，以逗号分隔。</td>
<td>未设置</td>
</tr>
<tr>
<td>useActualParamName</td>
<td>允许使用方法签名中的名称作为语句参数名称。 为了使用该特性，你的项目必须采用 Java 8 编译，并且加上 -parameters 选项。（新增于 3.4.1）</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>configurationFactory</td>
<td>指定一个提供 Configuration 实例的类。 这个被返回的 Configuration 实例用来加载被反序列化对象的延迟加载属性值。 这个类必须包含一个签名为static Configuration getConfiguration() 的方法。（新增于 3.2.3）</td>
<td>一个类型别名或完全限定类名。</td>
<td>未设置</td>
</tr>
<tr>
<td>shrinkWhitespacesInSql</td>
<td>从SQL中删除多余的空格字符。请注意，这也会影响SQL中的文字字符串。 (新增于 3.5.5)</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>defaultSqlProviderType</td>
<td>Specifies an sql provider class that holds provider method (Since 3.5.6). This class apply to the type(or value) attribute on sql provider annotation(e.g. @SelectProvider), when these attribute was omitted.</td>
<td>A type alias or fully qualified class name</td>
<td>Not set</td>
</tr>
</tbody></table>
<h2 id="3、typeAliases别名处理器"><a href="#3、typeAliases别名处理器" class="headerlink" title="3、typeAliases别名处理器"></a>3、typeAliases别名处理器</h2><ul>
<li>类型别名是为 Java 类型设置一个短的名字，可以方便我们 引用某个类。  （别名不区分大小写）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Author&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Blog&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Comment&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Comment&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Post&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Post&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Section&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Section&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Tag&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Tag&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>类很多的情况下，可以批量设置别名这个包下的每一个类 创建一个默认的别名，就是简单类名小写。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>也可以使用@Alias注解为其指定一个别名  (当别名冲突的时候)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>下面是一些为常见的 Java 类型内建的类型别名 <strong>。它们都是不区分大小写的，注意，为了应对原始类型的命名重复，采取了特殊的命名风格。</strong></li>
</ul>
<table>
<thead>
<tr>
<th><strong>别名</strong></th>
<th><strong>映射的类型</strong></th>
</tr>
</thead>
<tbody><tr>
<td>_byte</td>
<td>byte</td>
</tr>
<tr>
<td>_long</td>
<td>long</td>
</tr>
<tr>
<td>_short</td>
<td>short</td>
</tr>
<tr>
<td>_int</td>
<td>int</td>
</tr>
<tr>
<td>_integer</td>
<td>int</td>
</tr>
<tr>
<td>_double</td>
<td>double</td>
</tr>
<tr>
<td>_float</td>
<td>float</td>
</tr>
<tr>
<td>_boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>string</td>
<td>String</td>
</tr>
<tr>
<td>byte</td>
<td>Byte</td>
</tr>
<tr>
<td>long</td>
<td>Long</td>
</tr>
<tr>
<td>short</td>
<td>Short</td>
</tr>
<tr>
<td>int</td>
<td>Integer</td>
</tr>
<tr>
<td>integer</td>
<td>Integer</td>
</tr>
<tr>
<td>double</td>
<td>Double</td>
</tr>
<tr>
<td>float</td>
<td>Float</td>
</tr>
<tr>
<td>boolean</td>
<td>Boolean</td>
</tr>
<tr>
<td>date</td>
<td>Date</td>
</tr>
<tr>
<td>decimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>bigdecimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>object</td>
<td>Object</td>
</tr>
<tr>
<td>map</td>
<td>Map</td>
</tr>
<tr>
<td>hashmap</td>
<td>HashMap</td>
</tr>
<tr>
<td>list</td>
<td>List</td>
</tr>
<tr>
<td>arraylist</td>
<td>ArrayList</td>
</tr>
<tr>
<td>collection</td>
<td>Collection</td>
</tr>
<tr>
<td>iterator</td>
<td>Iterator</td>
</tr>
</tbody></table>
<h2 id="4、typeHandlers类型处理器"><a href="#4、typeHandlers类型处理器" class="headerlink" title="4、typeHandlers类型处理器"></a>4、typeHandlers类型处理器</h2><ul>
<li><p>MyBatis 在设置预处理语句（PreparedStatement）中的参数或从结果集中取出一个值时， 都会用类型处理器将获取到的值以合适的方式转换成 Java 类型。下表描述了一些默认的类型处理器。</p>
</li>
<li><p><strong>提示</strong> 从 3.4.5 开始，MyBatis 默认支持 JSR-310（日期和时间 API） 。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>类型处理器</strong></th>
<th><strong>Java 类型</strong></th>
<th><strong>JDBC 类型</strong></th>
</tr>
</thead>
<tbody><tr>
<td>BooleanTypeHandler</td>
<td>java.lang.Boolean, boolean</td>
<td>数据库兼容的 BOOLEAN</td>
</tr>
<tr>
<td>ByteTypeHandler</td>
<td>java.lang.Byte, byte</td>
<td>数据库兼容的 NUMERIC 或 BYTE</td>
</tr>
<tr>
<td>ShortTypeHandler</td>
<td>java.lang.Short, short</td>
<td>数据库兼容的 NUMERIC 或 SMALLINT</td>
</tr>
<tr>
<td>IntegerTypeHandler</td>
<td>java.lang.Integer, int</td>
<td>数据库兼容的 NUMERIC 或 INTEGER</td>
</tr>
<tr>
<td>LongTypeHandler</td>
<td>java.lang.Long, long</td>
<td>数据库兼容的 NUMERIC 或 BIGINT</td>
</tr>
<tr>
<td>FloatTypeHandler</td>
<td>java.lang.Float, float</td>
<td>数据库兼容的 NUMERIC 或 FLOAT</td>
</tr>
<tr>
<td>DoubleTypeHandler</td>
<td>java.lang.Double, double</td>
<td>数据库兼容的 NUMERIC 或 DOUBLE</td>
</tr>
<tr>
<td>BigDecimalTypeHandler</td>
<td>java.math.BigDecimal</td>
<td>数据库兼容的 NUMERIC 或 DECIMAL</td>
</tr>
<tr>
<td>StringTypeHandler</td>
<td>java.lang.String</td>
<td>CHAR, VARCHAR</td>
</tr>
<tr>
<td>ClobReaderTypeHandler</td>
<td>java.io.Reader</td>
<td>-</td>
</tr>
<tr>
<td>ClobTypeHandler</td>
<td>java.lang.String</td>
<td>CLOB, LONGVARCHAR</td>
</tr>
<tr>
<td>NStringTypeHandler</td>
<td>java.lang.String</td>
<td>NVARCHAR, NCHAR</td>
</tr>
<tr>
<td>NClobTypeHandler</td>
<td>java.lang.String</td>
<td>NCLOB</td>
</tr>
<tr>
<td>BlobInputStreamTypeHandler</td>
<td>java.io.InputStream</td>
<td>-</td>
</tr>
<tr>
<td>ByteArrayTypeHandler</td>
<td>byte[]</td>
<td>数据库兼容的字节流类型</td>
</tr>
<tr>
<td>BlobTypeHandler</td>
<td>byte[]</td>
<td>BLOB, LONGVARBINARY</td>
</tr>
<tr>
<td>DateTypeHandler</td>
<td>java.util.Date</td>
<td>TIMESTAMP</td>
</tr>
<tr>
<td>DateOnlyTypeHandler</td>
<td>java.util.Date</td>
<td>DATE</td>
</tr>
<tr>
<td>TimeOnlyTypeHandler</td>
<td>java.util.Date</td>
<td>TIME</td>
</tr>
<tr>
<td>SqlTimestampTypeHandler</td>
<td>java.sql.Timestamp</td>
<td>TIMESTAMP</td>
</tr>
<tr>
<td>SqlDateTypeHandler</td>
<td>java.sql.Date</td>
<td>DATE</td>
</tr>
<tr>
<td>SqlTimeTypeHandler</td>
<td>java.sql.Time</td>
<td>TIME</td>
</tr>
<tr>
<td>ObjectTypeHandler</td>
<td>Any</td>
<td>OTHER 或未指定类型</td>
</tr>
<tr>
<td>EnumTypeHandler</td>
<td>Enumeration Type</td>
<td>VARCHAR 或任何兼容的字符串类型，用来存储枚举的名称（而不是索引序数值）</td>
</tr>
<tr>
<td>EnumOrdinalTypeHandler</td>
<td>Enumeration Type</td>
<td>任何兼容的 NUMERIC 或 DOUBLE 类型，用来存储枚举的序数值（而不是名称）。</td>
</tr>
<tr>
<td>SqlxmlTypeHandler</td>
<td>java.lang.String</td>
<td>SQLXML</td>
</tr>
<tr>
<td>InstantTypeHandler</td>
<td>java.time.Instant</td>
<td>TIMESTAMP</td>
</tr>
<tr>
<td>LocalDateTimeTypeHandler</td>
<td>java.time.LocalDateTime</td>
<td>TIMESTAMP</td>
</tr>
<tr>
<td>LocalDateTypeHandler</td>
<td>java.time.LocalDate</td>
<td>DATE</td>
</tr>
<tr>
<td>LocalTimeTypeHandler</td>
<td>java.time.LocalTime</td>
<td>TIME</td>
</tr>
<tr>
<td>OffsetDateTimeTypeHandler</td>
<td>java.time.OffsetDateTime</td>
<td>TIMESTAMP</td>
</tr>
<tr>
<td>OffsetTimeTypeHandler</td>
<td>java.time.OffsetTime</td>
<td>TIME</td>
</tr>
<tr>
<td>ZonedDateTimeTypeHandler</td>
<td>java.time.ZonedDateTime</td>
<td>TIMESTAMP</td>
</tr>
<tr>
<td>YearTypeHandler</td>
<td>java.time.Year</td>
<td>INTEGER</td>
</tr>
<tr>
<td>MonthTypeHandler</td>
<td>java.time.Month</td>
<td>INTEGER</td>
</tr>
<tr>
<td>YearMonthTypeHandler</td>
<td>java.time.YearMonth</td>
<td>VARCHAR 或 LONGVARCHAR</td>
</tr>
<tr>
<td>JapaneseDateTypeHandler</td>
<td>java.time.chrono.JapaneseDate</td>
<td>DATE</td>
</tr>
</tbody></table>
<ul>
<li><p>时间类型的处理</p>
<ul>
<li><p>日期和时间的处理，JDK1.8以前一直是个头疼的 问题。我们通常使用JSR310规范领导者Stephen Colebourne创建的Joda-Time来操作。1.8已经实 现全部的JSR310规范了。</p>
</li>
<li><p>日期时间处理上，我们可以使用MyBatis基于 JSR310（Date and Time API）编写的各种日期 时间类型处理器。 •</p>
</li>
<li><p>MyBatis3.4以前的版本需要我们手动注册这些处 理器，以后的版本都是自动注册的</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630243682302-8ac8c2fd-02ee-4713-8b47-6acae31cfaca.png#clientId=u1c3513af-db7b-4\&amp;from=paste\&amp;height=233\&amp;id=u63447d2f\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=466\&amp;originWidth=1029\&amp;originalType=binary\&amp;ratio=1\&amp;size=283182\&amp;status=done\&amp;style=none\&amp;taskId=u45d07b9c-f071-4379-a506-b18abfe719e\&amp;width=514.5&gt;)
</code></pre>
</li>
<li><p>自定义类型处理器</p>
<ul>
<li>你可以重写已有的类型处理器或创建你自己的类型处理器来处理不支持的或非标准的类型。 具体做法为：实现 org.apache.ibatis.type.TypeHandler 接口， 或继承一个很便利的类 org.apache.ibatis.type.BaseTypeHandler， 并且可以（可选地）将它映射到一个 JDBC 类型。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MappedJdbcTypes(JdbcType.VARCHAR)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleTypeHandler</span> <span class="keyword">extends</span> <span class="title class_">BaseTypeHandler</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="type">int</span> i, String parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    ps.setString(i, parameter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> rs.getString(columnName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getNullableResult</span><span class="params">(ResultSet rs, <span class="type">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> rs.getString(columnIndex);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getNullableResult</span><span class="params">(CallableStatement cs, <span class="type">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> cs.getString(columnIndex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mybatis-config.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.mybatis.example.ExampleTypeHandler&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5、plugins插件"><a href="#5、plugins插件" class="headerlink" title="5、plugins插件"></a>5、plugins插件</h2><ul>
<li><p>插件是MyBatis提供的一个非常强大的机制，我们 可以通过插件来修改MyBatis的一些核心行为。插 件通过动态代理机制，可以介入四大对象的任何 一个方法的执行。后面会有专门的章节我们来介 绍mybatis运行原理以及插件</p>
</li>
<li><p>MyBatis 允许你在映射语句执行过程中的某一点进行拦截调用。默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：</p>
<ul>
<li><p>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</p>
</li>
<li><p>ParameterHandler (getParameterObject, setParameters)</p>
</li>
<li><p>ResultSetHandler (handleResultSets, handleOutputParameters)</p>
</li>
<li><p>StatementHandler (prepare, parameterize, batch, update, query)</p>
</li>
</ul>
</li>
</ul>
<h2 id="6、environments环境"><a href="#6、environments环境" class="headerlink" title="6、environments环境"></a>6、environments环境</h2><ul>
<li><p>MyBatis可以配置多种环境，比如开发、测试和生产环境需要有不同的配置。</p>
</li>
<li><p>每种环境使用一个environment标签进行配置并指定唯一标识</p>
</li>
<li><p>可以通过environments标签中的default属性指定一个环境标识来快速切换环境。</p>
</li>
</ul>
<h2 id="7、environment指定具体环境"><a href="#7、environment指定具体环境" class="headerlink" title="7、environment指定具体环境"></a>7、environment指定具体环境</h2><ul>
<li><p>id：指定当前环境的唯一标识</p>
</li>
<li><p>transactionManager和dataSource是必须有的</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;...&quot;</span> <span class="attr">value</span>=<span class="string">&quot;...&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>transactionManager</p>
<ul>
<li><p>type ： JDBC或者MANAGED或者自定义</p>
<ul>
<li><p><strong>JDBC</strong>： 使用了 JDBC 的提交和回滚设置，依赖于从数 据源得到的连接来管理事务范围。 JdbcTransactionFactory</p>
</li>
<li><p>** MANAGED**：不提交或回滚一个连接、让容器来管理 事务的整个生命周期（比如 JEE 应用服务器的上下 文）ManagedTransactionFactory</p>
</li>
<li><p><strong>自定义</strong>： 实现TransactionFactory接口，type&#x3D;全类名&#x2F; 别名</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>dataSource</p>
<ul>
<li><p>type：UNPOOLED或者POOLED或者JNDI或者自定义</p>
<ul>
<li><p>UNPOOLED：不使用连接池， UnpooledDataSourceFactory</p>
</li>
<li><p>POOLED：使用连接池， PooledDataSourceFactory</p>
</li>
<li><p>JNDI： 在EJB 或应用服务器这类容器中查找指定的数 据源</p>
</li>
<li><p>自定义：实现DataSourceFactory接口，定义数据源的 获取方式。</p>
</li>
</ul>
</li>
<li><p>**实际开发中我们使用Spring管理数据源，并进行 事务控制的配置来覆盖上述配置 **</p>
</li>
</ul>
</li>
</ul>
<h2 id="8、databaseidProvider环境"><a href="#8、databaseidProvider环境" class="headerlink" title="8、databaseidProvider环境"></a>8、databaseidProvider环境</h2><ul>
<li>MyBatis可以根据不同的数据库厂商执行不同的语句</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;SQL Server&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlserver&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;DB2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;db2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Oracle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>Type： DB_VENDOR</p>
<ul>
<li>使用MyBatis提供的VendorDatabaseIdProvider解析数据库 厂商标识。也可以实现DatabaseIdProvider接口来自定义。</li>
</ul>
</li>
<li><p>Property-name：数据库厂商标识</p>
</li>
<li><p>Property-value：为标识起一个别名，方便SQL语句使用 databaseId属性引用</p>
</li>
<li><p>DB_VENDOR</p>
<ul>
<li>会通过 DatabaseMetaData#getDatabaseProductName() 返回的字符 串进行设置。由于通常情况下这个字符串都非常长而且相同产品的不 同版本会返回不同的值，所以最好通过设置属性别名来使其变短</li>
</ul>
</li>
<li><p><strong>MyBatis匹配规则如下：</strong></p>
<ul>
<li><p>如果没有配置databaseIdProvider标签，那么databaseId&#x3D;null</p>
</li>
<li><p>如果配置了databaseIdProvider标签，使用标签配置的name去匹 配数据库信息，匹配上设置databaseId&#x3D;配置指定的值，否则依旧为 null</p>
</li>
<li><p>如果databaseId不为null，他只会找到配置databaseId的sql语句</p>
</li>
<li><p>MyBatis 会加载不带 databaseId 属性和带有匹配当前数据库 databaseId 属性的所有语句。如果同时找到带有 databaseId 和不带 databaseId 的相同语句，则后者会被舍弃</p>
</li>
</ul>
</li>
</ul>
<h2 id="9、mapper映射文件"><a href="#9、mapper映射文件" class="headerlink" title="9、mapper映射文件"></a>9、mapper映射文件</h2><ul>
<li><p>mapper逐个注册SQL映射文件</p>
</li>
<li><p>或者使用批量注册：</p>
<ul>
<li>这种方式要求SQL映射文件名必须和接口名相同并且在同一目录下</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.PostMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="四、MyBatis映射文件"><a href="#四、MyBatis映射文件" class="headerlink" title="四、MyBatis映射文件"></a>四、MyBatis映射文件</h1><ul>
<li><p>映射文件指导着MyBatis如何进行数据库增删改查。有着非常重要的意义</p>
</li>
<li><p>映射文件中有很少的顶级元素（按照应该被声明的顺序列出）</p>
<ul>
<li><p>cache-命名空间的二级缓存配置</p>
</li>
<li><p>cache-ref其他命名空间缓存配置的引用</p>
</li>
<li><p>resultMap-自定义结果集映射</p>
</li>
<li><p>sql-抽取可重用语句块</p>
</li>
<li><p>insert-映射插入语句</p>
</li>
<li><p>update-映射更新语句</p>
</li>
<li><p>delete-映射删除语句</p>
</li>
<li><p>select-映射查询语句</p>
</li>
</ul>
</li>
</ul>
<h2 id="1、insert、update、delete元素"><a href="#1、insert、update、delete元素" class="headerlink" title="1、insert、update、delete元素"></a>1、insert、update、delete元素</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span></span><br><span class="line">  id<span class="operator">=</span>&quot;insertAuthor&quot;</span><br><span class="line">  parameterType<span class="operator">=</span>&quot;domain.blog.Author&quot;</span><br><span class="line">  flushCache<span class="operator">=</span>&quot;true&quot;</span><br><span class="line">  statementType<span class="operator">=</span>&quot;PREPARED&quot;</span><br><span class="line">  keyProperty<span class="operator">=</span>&quot;&quot;</span><br><span class="line">  keyColumn<span class="operator">=</span>&quot;&quot;</span><br><span class="line">  useGeneratedKeys<span class="operator">=</span>&quot;&quot;</span><br><span class="line">  timeout<span class="operator">=</span>&quot;20&quot;<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">update</span></span><br><span class="line">  id<span class="operator">=</span>&quot;updateAuthor&quot;</span><br><span class="line">  parameterType<span class="operator">=</span>&quot;domain.blog.Author&quot;</span><br><span class="line">  flushCache<span class="operator">=</span>&quot;true&quot;</span><br><span class="line">  statementType<span class="operator">=</span>&quot;PREPARED&quot;</span><br><span class="line">  timeout<span class="operator">=</span>&quot;20&quot;<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">delete</span></span><br><span class="line">  id<span class="operator">=</span>&quot;deleteAuthor&quot;</span><br><span class="line">  parameterType<span class="operator">=</span>&quot;domain.blog.Author&quot;</span><br><span class="line">  flushCache<span class="operator">=</span>&quot;true&quot;</span><br><span class="line">  statementType<span class="operator">=</span>&quot;PREPARED&quot;</span><br><span class="line">  timeout<span class="operator">=</span>&quot;20&quot;<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>在命名空间中唯一的标识符，可以被用来引用这条语句。</td>
</tr>
<tr>
<td>parameterType</td>
<td>将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>flushCache</td>
<td>将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：（对 insert、update 和 delete 语句）true。</td>
</tr>
<tr>
<td>timeout</td>
<td>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td>
</tr>
<tr>
<td>statementType</td>
<td>可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td>
</tr>
<tr>
<td>useGeneratedKeys</td>
<td>（仅适用于 insert 和 update）这会令 MyBatis 使用 JDBC 的 getGeneratedKeys 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server 这样的关系型数据库管理系统的自动递增字段），默认值：false。</td>
</tr>
<tr>
<td>keyProperty</td>
<td>（仅适用于 insert 和 update）指定能够唯一识别对象的属性，MyBatis 会使用 getGeneratedKeys 的返回值或 insert 语句的 selectKey 子元素设置它的值，默认值：未设置（unset）。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td>keyColumn</td>
<td>（仅适用于 insert 和 update）设置生成键值在表中的列名，在某些数据库（像 PostgreSQL）中，当主键列不是表中的第一列的时候，是必须设置的。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td>databaseId</td>
<td>如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</td>
</tr>
</tbody></table>
<h2 id="2、主键生成方式"><a href="#2、主键生成方式" class="headerlink" title="2、主键生成方式"></a>2、主键生成方式</h2><ul>
<li>若数据库支持自动生成主键的字段，如：MySQL，SQL server，就可以设置：<strong>useGenerateKeys&#x3D;”true”</strong>,然后<strong>keyProperty</strong>设置到目标属性。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertAuthor&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">  insert into Author (username,password,email,bio)</span><br><span class="line">  values (#&#123;username&#125;,#&#123;password&#125;,#&#123;email&#125;,#&#123;bio&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>而对于不支持自增型主键的数据库（例如 Oracle），**则可以使用 selectKey 子元素： selectKey 元素将会首先运行，id 会被设置，然 后插入语句会被调用  **</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertAuthor&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">    select CAST(RANDOM()*1000000 as INTEGER) a from SYSIBM.SYSDUMMY1</span><br><span class="line">  <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">  insert into Author</span><br><span class="line">    (id, username, password, email,bio, favourite_section)</span><br><span class="line">  values</span><br><span class="line">    (#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;email&#125;, #&#123;bio&#125;, #&#123;favouriteSection,jdbcType=VARCHAR&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>selectKey 元素的属性</li>
</ul>
<table>
<thead>
<tr>
<th>keyProperty</th>
<th>selectKey 语句结果应该被设置到的目标属性。如果生成列不止一个，可以用逗号分隔多个属性名称。</th>
</tr>
</thead>
<tbody><tr>
<td>keyColumn</td>
<td>返回结果集中生成列属性的列名。如果生成列不止一个，可以用逗号分隔多个属性名称。</td>
</tr>
<tr>
<td>resultType</td>
<td>结果的类型。通常 MyBatis 可以推断出来，但是为了更加准确，写上也不会有什么问题。MyBatis 允许将任何简单类型用作主键的类型，包括字符串。如果生成列不止一个，则可以使用包含期望属性的 Object 或 Map。</td>
</tr>
<tr>
<td>order</td>
<td>可以设置为 BEFORE 或 AFTER。如果设置为 BEFORE，那么它首先会生成主键，设置 keyProperty 再执行插入语句。如果设置为 AFTER，那么先执行插入语句，然后是 selectKey 中的语句 - 这和 Oracle 数据库的行为相似，在插入语句内部可能有嵌入索引调用。</td>
</tr>
<tr>
<td>statementType</td>
<td>和前面一样，MyBatis 支持 STATEMENT，PREPARED 和 CALLABLE 类型的映射语句，分别代表 Statement, PreparedStatement 和 CallableStatement 类型。</td>
</tr>
</tbody></table>
<h2 id="3、参数传递"><a href="#3、参数传递" class="headerlink" title="3、参数传递"></a>3、参数传递</h2><ul>
<li><p>单个参数</p>
<ul>
<li>可以接收基本数据类型，对象类型(直接使用属性)，集合类型（list、array、collection别名）的值，这种情况MyBatis可以直接使用这个参数，不需要经过任何处理。</li>
</ul>
</li>
<li><p>多个参数</p>
<ul>
<li><p>任意多个参数，都会被MyBatis重新包装成一个Map传入。</p>
</li>
<li><p>Map的key是param1、param2、0 、1。值就是参数的值</p>
</li>
</ul>
</li>
<li><p>命名参数</p>
<ul>
<li>为参数使用@Param注解起一个名字，MyBatis就会将这些参数封装进map，key就是我们指定的名字。</li>
</ul>
</li>
<li><p>POJO</p>
<ul>
<li>当这些参数属于我们业务POJO时，我们直接传递POJO</li>
</ul>
</li>
<li><p>Map</p>
<ul>
<li>我们也可以将多个参数直接封装为Map，指定好key的名称就行。</li>
</ul>
</li>
</ul>
<h2 id="4、参数处理"><a href="#4、参数处理" class="headerlink" title="4、参数处理"></a>4、参数处理</h2><ul>
<li>参数也可以支付ing一个特殊的数据类型</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#&#123;property,javaType=int,jdbcType=NUMERIC&#125;</span><br><span class="line">对于数值类型，还可以设置 numericScale 指定小数点后保留的位数。</span><br><span class="line">#&#123;height,javaType=double,jdbcType=NUMERIC,numericScale=2&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>javaType通常可以从参数对象中确定</p>
</li>
<li><p>如果null被当做值来传递，对所有可能为空的列，jdbcType需要被设置</p>
<ul>
<li>也可以全局设置jdbcForNull&#x3D;other（mysql）&#x2F; null(orcal)</li>
</ul>
</li>
<li><p>对于数值类型还可以设置小数点后保留的位数</p>
</li>
<li><p>mode属性允许指定IN&#x2F;OUT或者INOUT参数，如果参数为OUT或INOUT，参数对象属性的真实值就会被改变，就像在获取输出参数时所期望的那样。</p>
</li>
<li><p><strong>参数位置支持的属性</strong></p>
<ul>
<li>javaType、jdbcType、mode、numericScale、 resultMap、typeHandler、jdbcTypeName、<del>expression</del></li>
</ul>
</li>
<li><p>实际上通常被设置的是：可能为空的列名指定jdbcType</p>
</li>
<li><p>#{key}:获取参数的值，预编译到SQL中。安全</p>
</li>
<li><p>${key}:获取参数的值，拼接到SQL中，有SQL注入安全问题。一般用在原生的SQL语句的拼装中 如： ORDER BY ${name}，或者分库分表的字段拼接</p>
</li>
</ul>
<h2 id="5、返回值处理"><a href="#5、返回值处理" class="headerlink" title="5、返回值处理"></a>5、返回值处理</h2><ul>
<li><p>基本类型或对象类型可以使用ResultrType指定，或者不用指定TypeHandler自动处理</p>
</li>
<li><p>返回集合，ResultType指定为集合中的对象类型，MyBatis自定封装为集合</p>
</li>
<li><p>返回Map：</p>
<ul>
<li><p>对于只有一条记录返回，key为字段名，value为字段的值</p>
</li>
<li><p>对于有多个记录返回，可以使用@MapKey在方法上，自己指定返回的Map的key和value类型，MyBatis自动帮我们封装。</p>
</li>
</ul>
</li>
</ul>
<h2 id="6、select元素"><a href="#6、select元素" class="headerlink" title="6、select元素"></a>6、select元素</h2><ul>
<li><p>select元素来定义查询操作。</p>
</li>
<li><p>id：唯一标识，用来引用这条语句，需要和接口 的方法名相同。</p>
</li>
<li><p>parameterType：参数类型，可以不传，MyBatis会根据TypeHandler自动判断</p>
</li>
<li><p>resultType：返回值类型。别名或者全类名，如果返回的是集合，定义集合中元素的类型。不能和resultMap同时使用。</p>
</li>
<li><p>Select 元素的属性</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>在命名空间中唯一的标识符，可以被用来引用这条语句。</th>
</tr>
</thead>
<tbody><tr>
<td>parameterType</td>
<td>将会传入这条语句的参数的类全限定名或别名。这个属性是可选的，因为 MyBatis 可以通过类型处理器（TypeHandler）推断出具体传入语句的参数，默认值为未设置（unset）。</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>resultType</td>
<td>期望从这条语句中返回结果的类全限定名或别名。 注意，如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型。 resultType 和 resultMap 之间只能同时使用一个。</td>
</tr>
<tr>
<td>resultMap</td>
<td>对外部 resultMap 的命名引用。结果映射是 MyBatis 最强大的特性，如果你对其理解透彻，许多复杂的映射问题都能迎刃而解。 resultType 和 resultMap 之间只能同时使用一个。</td>
</tr>
<tr>
<td>flushCache</td>
<td>将其设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：false。</td>
</tr>
<tr>
<td>useCache</td>
<td>将其设置为 true 后，将会导致本条语句的结果被二级缓存缓存起来，默认值：对 select 元素为 true。</td>
</tr>
<tr>
<td>timeout</td>
<td>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td>
</tr>
<tr>
<td>fetchSize</td>
<td>这是一个给驱动的建议值，尝试让驱动程序每次批量返回的结果行数等于这个设置值。 默认值为未设置（unset）（依赖驱动）。</td>
</tr>
<tr>
<td>statementType</td>
<td>可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td>
</tr>
<tr>
<td>resultSetType</td>
<td>FORWARD_ONLY，SCROLL_SENSITIVE, SCROLL_INSENSITIVE 或 DEFAULT（等价于 unset） 中的一个，默认值为 unset （依赖数据库驱动）。</td>
</tr>
<tr>
<td>databaseId</td>
<td>如果配置了数据库厂商标识（databaseIdProvider），MyBatis 会加载所有不带 databaseId 或匹配当前 databaseId 的语句；如果带和不带的语句都有，则不带的会被忽略。</td>
</tr>
<tr>
<td>resultOrdered</td>
<td>这个设置仅针对嵌套结果 select 语句：如果为 true，将会假设包含了嵌套结果集或是分组，当返回一个主结果行时，就不会产生对前面结果集的引用。 这就使得在获取嵌套结果集的时候不至于内存不够用。默认值：false。</td>
</tr>
<tr>
<td>resultSets</td>
<td>这个设置仅适用于多结果集的情况。它将列出语句执行后返回的结果集并赋予每个结果集一个名称，多个名称之间以逗号分隔。</td>
</tr>
</tbody></table>
<h2 id="7、自动映射"><a href="#7、自动映射" class="headerlink" title="7、自动映射"></a>7、自动映射</h2><ul>
<li><p>全局setting设置</p>
<ul>
<li><p>autoMappingBehavior默认是PARTIAL，开启自动映射的功能，唯一的要求是列名和javaBean属性名一致。</p>
</li>
<li><p>如果autoMappingBehavior设置为null则会取消自动映射</p>
</li>
<li><p>数据库字段命名规范，POJO属性符合驼峰命名法，如A_COLUM→aColum，我们可以开启驼峰命名规则映射功能， <strong>mapUnderscoreToCamelCase&#x3D;true。</strong></p>
</li>
</ul>
</li>
<li><p><strong>自定义resultMap，实现高级结果集映射</strong></p>
</li>
</ul>
<h2 id="8、resultMap"><a href="#8、resultMap" class="headerlink" title="8、resultMap"></a>8、resultMap</h2><ul>
<li><p>constructor  - 类在实例化时，用来注入结果到构造方法中</p>
<ul>
<li><p>idArg;ID参数：标记结果作为ID可以帮助整体提高效能</p>
</li>
<li><p>arg-注入到构造方法的一个普通结果</p>
</li>
</ul>
</li>
<li><p>id-一个ID结果；标记结果为Id可以帮助提高整体效能</p>
</li>
<li><p>result-注入到字段或JavaBean属性的普通结果</p>
</li>
<li><p>association-一个复杂的类型关联；许多结果将包成这种类型</p>
<ul>
<li>嵌入结果映射-结果映射自身的关联，或者参考一个</li>
</ul>
</li>
<li><p>collection-复杂类型的集合</p>
<ul>
<li>嵌入结果映射</li>
</ul>
</li>
<li><p>discriminator-使用结果集的值来决定使用哪一个结果集映射</p>
<ul>
<li>case-基于某些值的结果映射</li>
</ul>
</li>
</ul>
<h3 id="8-1、id和result"><a href="#8-1、id和result" class="headerlink" title="8.1、id和result"></a>8.1、id和result</h3><ul>
<li>id 和 result 映射一个单独列的值到简单数据类型 (字符串,整型,双精度浮点数,日期等)的属性或字段。</li>
</ul>
<table>
<thead>
<tr>
<th>property</th>
<th>映射到列结果的字段或属性。如果 JavaBean 有这个名字的属性（property），会先使用该属性。否则 MyBatis 将会寻找给定名称的字段（field）。 无论是哪一种情形，你都可以使用常见的点式分隔形式进行复杂属性导航。 比如，你可以这样映射一些简单的东西：“username”，或者映射到一些复杂的东西上：“address.street.number”。</th>
</tr>
</thead>
<tbody><tr>
<td>column</td>
<td>数据库中的列名，或者是列的别名。一般情况下，这和传递给 resultSet.getString(columnName) 方法的参数一样。</td>
</tr>
<tr>
<td>javaType</td>
<td>一个 Java 类的全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</td>
</tr>
<tr>
<td>jdbcType</td>
<td>JDBC 类型，所支持的 JDBC 类型参见这个表格之后的“支持的 JDBC 类型”。 只需要在可能执行插入、更新和删除的且允许空值的列上指定 JDBC 类型。这是 JDBC 的要求而非 MyBatis 的要求。如果你直接面向 JDBC 编程，你需要对可以为空值的列指定这个类型。</td>
</tr>
<tr>
<td>typeHandler</td>
<td>我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的全限定名，或者是类型别名。</td>
</tr>
</tbody></table>
<h3 id="8-2、association"><a href="#8-2、association" class="headerlink" title="8.2、association"></a>8.2、association</h3><ul>
<li><p>复杂对象映射</p>
</li>
<li><p>POJO中的属性可能是一个对象</p>
</li>
<li><p>我们可以是会用联合查询，并以级联属性的方式封装对象。</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630374639227-2de15eb5-3922-403a-8783-c46d801180ec.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=100\&amp;id=u3e7f3167\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=200\&amp;originWidth=835\&amp;originalType=binary\&amp;ratio=1\&amp;size=99869\&amp;status=done\&amp;style=none\&amp;taskId=u32d57353-261a-428a-993b-32f02bc0198\&amp;width=417.5&gt;)
</code></pre>
<ul>
<li><p>使用association标签定义对象的封装规则</p>
</li>
<li><p><strong>association-嵌套结果集</strong></p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630374791981-76bfa01a-0c36-4859-a6b5-5945df70ec98.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=129\&amp;id=ub80126a3\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=258\&amp;originWidth=1020\&amp;originalType=binary\&amp;ratio=1\&amp;size=131333\&amp;status=done\&amp;style=none\&amp;taskId=uc953a7d0-46a2-49da-8dee-475df95a7ce\&amp;width=510&gt;)
</code></pre>
</li>
<li><p><strong>association-分段查询</strong></p>
<ul>
<li><p><strong>select：调用目标方法查询当前属性的值</strong></p>
</li>
<li><p><strong>column：将指定列的值传入目标方法中</strong></p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630374897968-d439e337-86ff-4912-9f78-c0b1d13bd053.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=127\&amp;id=u1da68f7a\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=254\&amp;originWidth=873\&amp;originalType=binary\&amp;ratio=1\&amp;size=110834\&amp;status=done\&amp;style=none\&amp;taskId=uafcb43c5-624d-4dcd-bf39-c7ad1ec68fd\&amp;width=436.5&gt;)
</code></pre>
</li>
<li><p>association -分段查询和延迟加载</p>
<ul>
<li><p>开启延迟加载和属性按需加载</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630375068274-00c65998-002b-40c0-b6f6-ef49bfa86dbc.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=62\&amp;id=uec72b4e9\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=124\&amp;originWidth=929\&amp;originalType=binary\&amp;ratio=1\&amp;size=54809\&amp;status=done\&amp;style=none\&amp;taskId=u3fb2d251-1a36-41be-92fe-601eb38a3eb\&amp;width=464.5&gt;)
</code></pre>
</li>
</ul>
<h2 id="9、collection-集合类型和嵌套结果集"><a href="#9、collection-集合类型和嵌套结果集" class="headerlink" title="9、collection-集合类型和嵌套结果集"></a>9、collection-集合类型和嵌套结果集</h2><ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630375231066-9f6fb57b-e459-44ff-a900-ef9585b0a55b.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=135\&amp;id=u33989e29\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=269\&amp;originWidth=888\&amp;originalType=binary\&amp;ratio=1\&amp;size=101790\&amp;status=done\&amp;style=none\&amp;taskId=u80506772-5679-4748-bd72-aeae1ebb13d\&amp;width=444&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630375240627-9e273e36-8c62-411e-a38c-f34017c6ec62.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=177\&amp;id=u6086bc5d\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=354\&amp;originWidth=1043\&amp;originalType=binary\&amp;ratio=1\&amp;size=176489\&amp;status=done\&amp;style=none\&amp;taskId=udf5b5bca-7f7d-4b35-9336-bcfe12828b7\&amp;width=521.5&gt;)
</code></pre>
<ul>
<li><p><strong>collection-分步查询和延迟加载</strong></p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630375291508-b7cec8c6-a3f1-4128-8027-f49e0dd5b717.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=126\&amp;id=uc4842ae2\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=251\&amp;originWidth=1009\&amp;originalType=binary\&amp;ratio=1\&amp;size=118047\&amp;status=done\&amp;style=none\&amp;taskId=u8e049c5f-19e5-4b40-bcd1-eaccd9f4bed\&amp;width=504.5&gt;)
</code></pre>
</li>
</ul>
<h2 id="10、多列封装map传递"><a href="#10、多列封装map传递" class="headerlink" title="10、多列封装map传递"></a>10、多列封装map传递</h2><ul>
<li><p>分步查询的时候通过column指定，将对应的列的数据传递过去，我们有时需要传递多列数据。</p>
</li>
<li><p>使用{key1&#x3D;column1，key2&#x3D;column2.。。。}的形式</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630375448430-98179473-d556-46ab-bb2c-51b346f69577.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=128\&amp;id=u45db682d\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=256\&amp;originWidth=1008\&amp;originalType=binary\&amp;ratio=1\&amp;size=110475\&amp;status=done\&amp;style=none\&amp;taskId=u186e6d52-2dce-46c5-ba70-a501892f074\&amp;width=504&gt;)
</code></pre>
</li>
<li><p><strong>association或者collection标签的fetchType&#x3D;eager&#x2F;lazy可以覆盖全局的延迟加载策略，指定立即加载（eager）或者延迟加载（lazy）</strong></p>
</li>
</ul>
<h1 id="五、MyBatis-动态SQL"><a href="#五、MyBatis-动态SQL" class="headerlink" title="五、MyBatis-动态SQL"></a>五、MyBatis-动态SQL</h1><ul>
<li><p>动态SQL是MyBatis强大特性之一。极大的简化我们拼装SQL的操作</p>
</li>
<li><p>动态 SQL 元素和使用 JSTL 或其他类似基于 XML 的文本处 理器相似。</p>
</li>
<li><p>MyBatis采用功能强大的基于OGNL的表达式来简化操作。</p>
<ul>
<li><p>if</p>
</li>
<li><p>choose(when,otherwise)</p>
</li>
<li><p>trim(where,set)</p>
</li>
<li><p>foreach</p>
</li>
</ul>
</li>
</ul>
<h3 id="5-1、if"><a href="#5-1、if" class="headerlink" title="5.1、if"></a>5.1、if</h3><ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630375952229-4baad119-9955-4d54-b1a9-605635118de6.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=188\&amp;id=ubacb7a57\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=376\&amp;originWidth=1111\&amp;originalType=binary\&amp;ratio=1\&amp;size=132952\&amp;status=done\&amp;style=none\&amp;taskId=u27245a51-8e72-45a8-bf1a-ec39c2db5b2\&amp;width=555.5&gt;)
</code></pre>
<ul>
<li><p>当id为null的时候拼装SQL会出错</p>
<ul>
<li><p>可以在where之后添加 1&#x3D;1 ，是的where和and之间永远有条件</p>
</li>
<li><p>使用where标签，适合and写在条件签名的情况</p>
</li>
<li><p>and写在条件的后面，可以使用trim标签覆盖调最后的a多余的and</p>
</li>
</ul>
</li>
</ul>
<h3 id="5-2、choose（when，otherwise）"><a href="#5-2、choose（when，otherwise）" class="headerlink" title="5.2、choose（when，otherwise）"></a>5.2、choose（when，otherwise）</h3><ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630376198976-4db472d7-55a1-4ef9-ab74-7bd0354e3bac.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=250\&amp;id=ufd4e8faf\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=500\&amp;originWidth=1185\&amp;originalType=binary\&amp;ratio=1\&amp;size=136834\&amp;status=done\&amp;style=none\&amp;taskId=u18077bef-2f3e-4804-a88b-82c32328b5d\&amp;width=592.5&gt;)
</code></pre>
<ul>
<li>相当于switch-case多选以的情况</li>
</ul>
<h3 id="5-3、trim（where，set）"><a href="#5-3、trim（where，set）" class="headerlink" title="5.3、trim（where，set）"></a>5.3、trim（where，set）</h3><ul>
<li><p>where</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630376331539-d6d88149-8f10-4549-a1ca-1814c1fc85bc.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=215\&amp;id=u52ad775b\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=430\&amp;originWidth=1090\&amp;originalType=binary\&amp;ratio=1\&amp;size=138265\&amp;status=done\&amp;style=none\&amp;taskId=u7d7febf7-f6d2-4da7-9837-68edae46f83\&amp;width=545&gt;)
</code></pre>
<ul>
<li>第一个条件不用and</li>
</ul>
</li>
<li><p>set</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630376458866-d4034e20-0829-4252-9028-0b80715e3916.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=235\&amp;id=u1eda9d06\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=469\&amp;originWidth=1124\&amp;originalType=binary\&amp;ratio=1\&amp;size=138366\&amp;status=done\&amp;style=none\&amp;taskId=u6aac1cf0-8bf1-4647-b73a-0d6e0e3f891\&amp;width=562&gt;)
</code></pre>
</li>
<li><p>trim</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630376527290-6d5f6e07-599c-447e-be68-6d51f8aea425.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=223\&amp;id=u331a4905\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=446\&amp;originWidth=1089\&amp;originalType=binary\&amp;ratio=1\&amp;size=153704\&amp;status=done\&amp;style=none\&amp;taskId=u9244a7b1-b4bd-4b2f-b753-9504f3bbb2e\&amp;width=544.5&gt;)
</code></pre>
</li>
</ul>
<h3 id="5-4、foreach"><a href="#5-4、foreach" class="headerlink" title="5.4、foreach"></a>5.4、foreach</h3><ul>
<li><p>动态 SQL 的另外一个常用的必要操作是需要对一个集合 进行遍历，通常是在构建 IN 条件语句的时候。</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630376647146-a4e7c82f-3aac-42b1-88b1-05e7a71f9210.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=114\&amp;id=uc8776671\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=228\&amp;originWidth=1026\&amp;originalType=binary\&amp;ratio=1\&amp;size=84291\&amp;status=done\&amp;style=none\&amp;taskId=u728ef78a-bab6-422a-b04e-d828adfc7b3\&amp;width=513&gt;)
</code></pre>
<ul>
<li><p>当迭代列表、集合等可迭代对象或者数组时</p>
<ul>
<li>index是当前迭代的次数，item的值是本次迭代获取的元素</li>
</ul>
</li>
<li><p>当使用字典（或者Map。Entry对象的集合）时</p>
<ul>
<li>index是键，item是值</li>
</ul>
</li>
</ul>
<h3 id="5-5、bind"><a href="#5-5、bind" class="headerlink" title="5.5、bind"></a>5.5、bind</h3><ul>
<li><p>bind元素可以从OGNL表达式中创建一个变量并将其绑定到上下文。比如</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630376933124-af7459e8-054b-40d9-9152-0419250842c3.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=77\&amp;id=u0fe01393\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=154\&amp;originWidth=1177\&amp;originalType=binary\&amp;ratio=1\&amp;size=85785\&amp;status=done\&amp;style=none\&amp;taskId=ub8a0451e-55b1-4b76-8311-a16da045029\&amp;width=588.5&gt;)
</code></pre>
<h3 id="5-6、增删改查标签中两个常用的内置参数（-parameter和-databaseId）"><a href="#5-6、增删改查标签中两个常用的内置参数（-parameter和-databaseId）" class="headerlink" title="5.6、增删改查标签中两个常用的内置参数（_parameter和_databaseId）"></a>5.6、增删改查标签中两个常用的内置参数（_parameter和_databaseId）</h3><ul>
<li><p>_parameter:代表传入参数的整体</p>
<ul>
<li>可以通过这个内置参数获取传入的参数</li>
</ul>
</li>
<li><p>_databaseId:代表数据库厂商唯一标识</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630377205501-e5bad4bf-a0db-4a2a-b326-ac81458686d7.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=120\&amp;id=ucef8aa12\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=239\&amp;originWidth=1142\&amp;originalType=binary\&amp;ratio=1\&amp;size=88679\&amp;status=done\&amp;style=none\&amp;taskId=u221f8cf2-4cde-4ef5-95e1-aea77d23d25\&amp;width=571&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630377307559-ed9d00a9-1c3b-45ac-97b8-576626deff6d.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=356\&amp;id=ud31d4f5e\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=712\&amp;originWidth=1145\&amp;originalType=binary\&amp;ratio=1\&amp;size=285739\&amp;status=done\&amp;style=none\&amp;taskId=ucd3ee072-932b-429c-9bf8-a9099a0a28f\&amp;width=572.5&gt;)
</code></pre>
<h1 id="六、MyBatis-缓存机制"><a href="#六、MyBatis-缓存机制" class="headerlink" title="六、MyBatis-缓存机制"></a>六、MyBatis-缓存机制</h1><ul>
<li><p>MyBatis包含了一个非常强大的查询缓存特性，他是可以非常方便地配置和定制。缓存可以极大的提升查询效率。</p>
</li>
<li><p>MyBatis系统中默认定义了两级缓存</p>
</li>
<li><p><strong>一级缓存和二级缓存</strong></p>
<ul>
<li><p><strong>默认情况下，只有一级缓存（SQLSession级别的缓存，也叫本地缓存）开启。</strong></p>
</li>
<li><p><strong>二级缓存需要手动开启和配置，它是基于namespace级别的缓存</strong></p>
</li>
<li><p><strong>为了提高扩展性，MyBatis定义了缓存接口Cache。我们可以通过实现cache接口来定义二级缓存。</strong></p>
</li>
</ul>
</li>
</ul>
<h2 id="6-1、一级缓存"><a href="#6-1、一级缓存" class="headerlink" title="6.1、一级缓存"></a>6.1、一级缓存</h2><ul>
<li><p>一级缓存，即本地缓存，作用域默认为sqlSession。当session flush或者close后，该session中的所有cache将被清空。</p>
</li>
<li><p>本地缓存不能被关闭，但是可以调用sqlSession的clearCache()方法清空本地缓存，或者改变缓存的作用域 （SqlSession关闭一级缓存进入二级缓存）</p>
</li>
<li><p>在mybatis3.1之后, 可以配置本地缓存的作用域. 在 mybatis.xml 中配置</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630378094871-93641e10-eef7-4eb9-8f7b-92294f3211c2.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=91\&amp;id=ua5831b5e\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=181\&amp;originWidth=1185\&amp;originalType=binary\&amp;ratio=1\&amp;size=109989\&amp;status=done\&amp;style=none\&amp;taskId=u54f47ad5-ce6d-42f8-ad38-e06e28e7fad\&amp;width=592.5&gt;)
</code></pre>
<ul>
<li><p><strong>一级缓存失效情况</strong></p>
<ul>
<li><p><strong>同一次会话期间之只要查询过的数据都会保存在当前SqlSession的一个Map中</strong></p>
<ul>
<li><strong>key：</strong> :hashCode+查询的SqlId+编写的sql查询语句+参数</li>
</ul>
</li>
<li><p>不同的sqlSession对应不同的一级缓存</p>
</li>
<li><p>同一个sqlSession但是查询条件不同</p>
</li>
<li><p>同一个sqlSession两次查询期间执行任何一次增删改操作（他们的flushCache&#x3D;true）</p>
</li>
<li><p>同一个sqlSession两次查询期间手动清空缓存。</p>
</li>
</ul>
</li>
</ul>
<h2 id="6-2、二级缓存"><a href="#6-2、二级缓存" class="headerlink" title="6.2、二级缓存"></a>6.2、二级缓存</h2><ul>
<li><p>二级缓存，全局作用域缓存</p>
</li>
<li><p>二级缓存默认不开启，需要手动配置</p>
</li>
<li><p>MyBatis提供二级缓存的解救一级实现，缓存实现要去POJO实现Serializable接口</p>
</li>
<li><p><strong>二级缓存在sqlSession关闭或者提交之后才会生效</strong></p>
</li>
<li><p><strong>使用步骤：</strong></p>
<ul>
<li><strong>全局配置文件中开启二级缓存</strong></li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>需要使用二级缓存的映射文件处使用cache标签配置缓存</p>
</li>
<li><p>注意：POJO需要实现Serializable接口</p>
</li>
<li><p><strong>缓存相关属性</strong></p>
<ul>
<li><p><strong>eviction：缓存回收策略：</strong></p>
<ul>
<li><p><strong>LRU：最近最少使用；移除最长时间不被使用的对象</strong></p>
</li>
<li><p><strong>FIFO：先进先出；按照对象进入缓存的顺序来移除他们</strong></p>
</li>
<li><p><strong>SOFT：软引用：移除基于垃圾回收器状态和软引用规则的对象</strong></p>
</li>
<li><p><strong>WEAK: 弱引用：</strong> 更积极地移除基于垃圾收集器状态和弱引用规则的对象。</p>
</li>
<li><p>默认是：LRU</p>
</li>
</ul>
</li>
<li><p>flushInterval：刷新间隔，单位毫秒</p>
<ul>
<li>默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句时刷新</li>
</ul>
</li>
<li><p>size：引用数目，正整数</p>
<ul>
<li>代表缓存最多可以存储多少对象，太大容易导致内存溢出</li>
</ul>
</li>
<li><p>readOnly：只读，true&#x2F;false</p>
<ul>
<li><p>true：只读缓存；会给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势</p>
</li>
<li><p>false；读写缓存：会返回缓存队形的拷贝（通过序列化）。这会慢一些，但是安全，因此默认是false；</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>缓存有关设置</strong></p>
<ul>
<li><p><strong>全局setting的cacheEnable</strong></p>
<ul>
<li><strong>配置二级缓存的开关，一级缓存一直是打开的</strong></li>
</ul>
</li>
<li><p>select标签的useCache属性</p>
<ul>
<li>配置这个select是否使用二级缓存。一级缓存一直是使用的</li>
</ul>
</li>
<li><p>sql标签的flushCache属性</p>
<ul>
<li>增删改默认flushCache&#x3D;true。sql执行以后，会同时清空一级和二级缓存。 查询默认flushCache&#x3D;false。</li>
</ul>
</li>
<li><p>sqlSession.clearCache();</p>
<ul>
<li>只是用来清空一级缓存。</li>
</ul>
</li>
<li><p>当在某一个作用域 (一级缓存Session&#x2F;二级缓存 Namespaces) 进行了 C&#x2F;U&#x2F;D 操作后，默认该作用域下所 有 select 中的缓存将被clear</p>
</li>
</ul>
</li>
<li><p><strong>第三方缓存整合</strong></p>
<ul>
<li><p>EhCache 是一个纯Java的进程内缓存框架，具有快速、精 干等特点，是Hibernate中默认的CacheProvider。</p>
</li>
<li><p>MyBatis定义了Cache接口方便我们进行自定义扩展。</p>
</li>
<li><p>步骤：</p>
<ul>
<li><p>导入ehcache依赖</p>
</li>
<li><p>编写ehcache.xml配置文件</p>
</li>
<li><p>配置cache标签</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>参照缓存</strong>：若想在命名空间中共享相同的缓存配置和实例可以使用cache-ref元素来引用另外一个缓存</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630380164174-f9ccfaf0-7735-42be-98de-3adaab59f242.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=20\&amp;id=ue0d43e07\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=39\&amp;originWidth=1089\&amp;originalType=binary\&amp;ratio=1\&amp;size=29751\&amp;status=done\&amp;style=none\&amp;taskId=ubc319fd3-26f0-466a-a7d7-2e36b751b43\&amp;width=544.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630380241264-3bc222a2-502c-4088-a833-f95c3d5573a4.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=381\&amp;id=ub8d0750f\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=762\&amp;originWidth=1154\&amp;originalType=binary\&amp;ratio=1\&amp;size=543987\&amp;status=done\&amp;style=none\&amp;taskId=ub600c68c-5c83-4cf8-bbce-5be3a51c05b\&amp;width=577&gt;)
</code></pre>
<h1 id="七、MyBatis-Spring整合"><a href="#七、MyBatis-Spring整合" class="headerlink" title="七、MyBatis-Spring整合"></a>七、MyBatis-Spring整合</h1><ul>
<li><a target="_blank" rel="noopener" href="http://mybatis.org/spring/zh/index.html" title="参考官方文档">参考官方文档</a></li>
</ul>
<h1 id="八、MyBatis-逆向工程"><a href="#八、MyBatis-逆向工程" class="headerlink" title="八、MyBatis-逆向工程"></a>八、MyBatis-逆向工程</h1><ul>
<li><a target="_blank" rel="noopener" href="http://mybatis.org/generator/" title="参考官方文档">参考官方文档</a></li>
</ul>
<h1 id="九、MyBatis-工作原理"><a href="#九、MyBatis-工作原理" class="headerlink" title="九、MyBatis-工作原理"></a>九、MyBatis-工作原理</h1><p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1630380937673-2f5a96bd-572e-4fb9-af94-af0746d4a4ca.png#clientId=u725fc5f1-2140-4&from=paste&height=487&id=u0e7fc775&margin=[object%20Object]&name=image.png&originHeight=974&originWidth=1724&originalType=binary&ratio=1&size=1051261&status=done&style=none&taskId=u3669d689-3cfc-4b46-9a33-da6e1435e45&width=862"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1630381085891-853aed15-5746-4497-a72e-3201d303fd57.png#clientId=u725fc5f1-2140-4&from=paste&height=364&id=u63eed7db&margin=[object%20Object]&name=image.png&originHeight=728&originWidth=1009&originalType=binary&ratio=1&size=177219&status=done&style=none&taskId=u5f52c695-4201-47d6-874d-8294a6909b8&width=504.5"></p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630381200518-4a8d05a2-ca99-4091-923d-36293ad23804.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=520\&amp;id=ucfb34f7f\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=1040\&amp;originWidth=1863\&amp;originalType=binary\&amp;ratio=1\&amp;size=563886\&amp;status=done\&amp;style=none\&amp;taskId=u32cf3ef0-2c14-4d64-91ca-ff50f0c0b5c\&amp;width=931.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630381405200-93b7dde4-9019-4bf3-a752-4ccc26056b99.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=503\&amp;id=u498bef8e\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=1006\&amp;originWidth=1737\&amp;originalType=binary\&amp;ratio=1\&amp;size=388993\&amp;status=done\&amp;style=none\&amp;taskId=uc45402b8-a6fb-45bb-98d2-3702246edd0\&amp;width=868.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630381429247-c6f2a107-caec-4b98-983c-220bbeb30a4a.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=508\&amp;id=u1c891392\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=1016\&amp;originWidth=1822\&amp;originalType=binary\&amp;ratio=1\&amp;size=440374\&amp;status=done\&amp;style=none\&amp;taskId=u49eb1473-ec8a-4f03-8301-02a98f7f55d\&amp;width=911&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630381440500-379e4052-c729-4a4a-beee-a57b387596c5.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;id=ubccd05eb\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=720\&amp;originWidth=855\&amp;originalType=binary\&amp;ratio=1\&amp;size=209268\&amp;status=done\&amp;style=none\&amp;taskId=ua593889a-2330-4f9b-93d5-a0ebf7cab1d&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630381461043-4c35e19c-f927-451a-a548-bddd4579ea4d.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=526\&amp;id=u2eb4ed5a\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=1051\&amp;originWidth=1782\&amp;originalType=binary\&amp;ratio=1\&amp;size=137133\&amp;status=done\&amp;style=none\&amp;taskId=u2b85f346-28e1-4fbb-9bc8-5788e02f962\&amp;width=891&gt;)
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 1、获取sqlSessionFactory对象:</span></span><br><span class="line"><span class="comment">   *     解析文件的每一个信息保存在Configuration中，返回包含Configuration的DefaultSqlSession；</span></span><br><span class="line"><span class="comment">   *     注意：【MappedStatement】：代表一个增删改查的详细信息</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * 2、获取sqlSession对象</span></span><br><span class="line"><span class="comment">   *     返回一个DefaultSQlSession对象，包含Executor和Configuration;</span></span><br><span class="line"><span class="comment">   *     这一步会创建Executor对象；</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * 3、获取接口的代理对象（MapperProxy）</span></span><br><span class="line"><span class="comment">   *     getMapper，使用MapperProxyFactory创建一个MapperProxy的代理对象</span></span><br><span class="line"><span class="comment">   *     代理对象里面包含了，DefaultSqlSession（Executor）</span></span><br><span class="line"><span class="comment">   * 4、执行增删改查方法</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * 总结：</span></span><br><span class="line"><span class="comment">   *   1、根据配置文件（全局，sql映射）初始化出Configuration对象</span></span><br><span class="line"><span class="comment">   *   2、创建一个DefaultSqlSession对象，</span></span><br><span class="line"><span class="comment">   *     他里面包含Configuration以及</span></span><br><span class="line"><span class="comment">   *     Executor（根据全局配置文件中的defaultExecutorType创建出对应的Executor）</span></span><br><span class="line"><span class="comment">   *  3、DefaultSqlSession.getMapper（）：拿到Mapper接口对应的MapperProxy；</span></span><br><span class="line"><span class="comment">   *  4、MapperProxy里面有（DefaultSqlSession）；</span></span><br><span class="line"><span class="comment">   *  5、执行增删改查方法：</span></span><br><span class="line"><span class="comment">   *      1）、调用DefaultSqlSession的增删改查（Executor）；</span></span><br><span class="line"><span class="comment">   *      2）、会创建一个StatementHandler对象。</span></span><br><span class="line"><span class="comment">   *        （同时也会创建出ParameterHandler和ResultSetHandler）</span></span><br><span class="line"><span class="comment">   *      3）、调用StatementHandler预编译参数以及设置参数值;</span></span><br><span class="line"><span class="comment">   *        使用ParameterHandler来给sql设置参数</span></span><br><span class="line"><span class="comment">   *      4）、调用StatementHandler的增删改查方法；</span></span><br><span class="line"><span class="comment">   *      5）、ResultSetHandler封装结果</span></span><br><span class="line"><span class="comment">   *  注意：</span></span><br><span class="line"><span class="comment">   *    四大对象每个创建的时候都有一个interceptorChain.pluginAll(parameterHandler);</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">     */</span></span><br></pre></td></tr></table></figure>

<h1 id="十、MyBatis插件开发"><a href="#十、MyBatis插件开发" class="headerlink" title="十、MyBatis插件开发"></a>十、MyBatis插件开发</h1><ul>
<li><p>MyBatis在四大对象的创建过程中，都会有插件进行介入。插件可以利用动态代理机制一层层的包装目标对象，而实现在目标对象执行目标方法之前拦截的效果。</p>
</li>
<li><p>MyBatis允许在已映射语句执行过程中的某一点进行拦截调用。</p>
</li>
<li><p>默认情况下，MyBatis 允许使用插件来拦截的方法调 用包括：</p>
<ul>
<li><p>**Executor **(update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</p>
</li>
<li><p>**ParameterHandler **(getParameterObject, setParameters)</p>
</li>
<li><p>**ResultSetHandler **(handleResultSets, handleOutputParameters)</p>
</li>
<li><p>**StatementHandler **(prepare, parameterize, batch, update, query</p>
</li>
</ul>
</li>
</ul>
<h2 id="1、插件开发"><a href="#1、插件开发" class="headerlink" title="1、插件开发"></a>1、插件开发</h2><ul>
<li><p>插件开发步骤</p>
<ul>
<li><p>编写插件实现Interceptor接口，并使用@Intercepts注解 完成插件签名</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630382810614-ccd55faf-b464-47fc-bd5e-910af1fff3d0.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=95\&amp;id=u91b2d843\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=190\&amp;originWidth=1044\&amp;originalType=binary\&amp;ratio=1\&amp;size=74581\&amp;status=done\&amp;style=none\&amp;taskId=u2d780dcc-9c05-4535-88b7-4b6834ad6cb\&amp;width=522&gt;)
</code></pre>
<ul>
<li><p>在全局配置文件中注册插件</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630382865350-b73aa24a-b8cb-4124-8341-8abb6a41abe1.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=85\&amp;id=u14e6d5e1\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=170\&amp;originWidth=1017\&amp;originalType=binary\&amp;ratio=1\&amp;size=68689\&amp;status=done\&amp;style=none\&amp;taskId=ua398d331-94bf-4d5f-bcb8-2669d182f22\&amp;width=508.5&gt;)
</code></pre>
</li>
</ul>
<h2 id="2、插件原理"><a href="#2、插件原理" class="headerlink" title="2、插件原理"></a>2、插件原理</h2><ul>
<li><p>按照插件注解声明，按照插件配置顺序调用插件plugin方 法，生成被拦截对象的动态代理</p>
</li>
<li><p>多个插件依次生成目标对象的代理对象，层层包裹，先声 明的先包裹；形成代理链</p>
</li>
<li><p>目标方法执行时依次从外到内执行插件的intercept方法。 &amp;#x20;</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1630383005900-1e99282d-d33d-499e-87fb-4df53c026cd5.png#clientId=u725fc5f1-2140-4&from=paste&height=270&id=u22972fc2&margin=[object%20Object]&name=image.png&originHeight=540&originWidth=1129&originalType=binary&ratio=1&size=264618&status=done&style=none&taskId=u351275a3-ae56-49f2-b082-c853775d97e&width=564.5"></p>
</li>
<li><p>多个插件情况下，我们往往需要在某个插件中分离出目标 对象。可以借助MyBatis提供的SystemMetaObject类来进行获 取最后一层的h以及target属性的值</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630383110209-feff384d-5200-467c-8807-fae16484fd19.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=512\&amp;id=udc91e4cb\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=1024\&amp;originWidth=1803\&amp;originalType=binary\&amp;ratio=1\&amp;size=283899\&amp;status=done\&amp;style=none\&amp;taskId=ue940c55c-467f-43b0-9fd0-462fc8c86c7\&amp;width=901.5&gt;)
</code></pre>
<ul>
<li><p><strong>interceptor接口</strong></p>
<ul>
<li><p><strong>intercept：拦截目标方法执行</strong></p>
</li>
<li><p><strong>plugin：生成动态代理对象，可以使用MyBatis提供的Plugin类的wrap方法</strong></p>
</li>
<li><p><strong>setProperties：注入插件配置时设置属性</strong></p>
</li>
</ul>
</li>
<li><p>常用代码：</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1630383405101-b899390e-4525-41a4-ab8a-11c54aeec6d6.png#clientId=u725fc5f1-2140-4&from=paste&height=333&id=u75df1e99&margin=[object%20Object]&name=image.png&originHeight=666&originWidth=1082&originalType=binary&ratio=1&size=219522&status=done&style=none&taskId=u2fd7b42e-53e4-4792-99ad-c8c369fe20e&width=541"></p>
<h1 id="十一、扩展：MyBatis实用场景"><a href="#十一、扩展：MyBatis实用场景" class="headerlink" title="十一、扩展：MyBatis实用场景"></a>十一、扩展：MyBatis实用场景</h1><ul>
<li><p>PageHelper插件进行分页</p>
</li>
<li><p>批量操作</p>
</li>
<li><p>存储过程</p>
</li>
<li><p>typeHandler处理枚举</p>
</li>
</ul>
<h2 id="1、pageHelper"><a href="#1、pageHelper" class="headerlink" title="1、pageHelper"></a>1、pageHelper</h2><ul>
<li>参考官网</li>
</ul>
<h2 id="2、批量操作"><a href="#2、批量操作" class="headerlink" title="2、批量操作"></a>2、批量操作</h2><ul>
<li><p>默认的openSession()方法没有参数，它会创建有如下特性的：</p>
<ul>
<li><p>会开启一个事务（不会自动提交）</p>
</li>
<li><p>连接对象会从由活动环境配置的数据源实例得到。</p>
</li>
<li><p>事务隔离级别将会使用驱动或数据源的默认设置。</p>
</li>
<li><p>预处理语句不会被复用,也不会批量处理更新。</p>
</li>
</ul>
</li>
<li><p>openSession方法的ExecutorType类型的参数，枚举类型：</p>
<ul>
<li><p>** ExecutorType.SIMPLE**: 这个执行器类型不做特殊的事情（这是默认装配 的）。它为每个语句的执行创建一个新的预处理语句。</p>
</li>
<li><p><strong>ExecutorType.REUSE:</strong> 这个执行器类型会复用预处理语句。</p>
</li>
<li><p><strong>ExecutorType.BATCH</strong>: 这个执行器会批量执行所有更新语句</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630383879161-4b465f92-919a-4c33-b617-98a5273d17d6.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=103\&amp;id=ua922d537\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=206\&amp;originWidth=1024\&amp;originalType=binary\&amp;ratio=1\&amp;size=124216\&amp;status=done\&amp;style=none\&amp;taskId=u6663a4b3-e0f4-48b5-a877-cf824a39811\&amp;width=512&gt;)
</code></pre>
</li>
<li><p>批量操作我们是使用MyBatis提供的BatchExecutor进行的， 他的底层就是通过jdbc攒sql的方式进行的。我们可以让他 攒够一定数量后发给数据库一次。</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630383976978-781e9cb2-98f9-4f23-aa19-c773eda54f69.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=297\&amp;id=u5ff77df4\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=593\&amp;originWidth=1053\&amp;originalType=binary\&amp;ratio=1\&amp;size=170757\&amp;status=done\&amp;style=none\&amp;taskId=u50406d39-25d8-48ca-a9d5-1894d37270f\&amp;width=526.5&gt;)
</code></pre>
<ul>
<li><p>与Spring整合中，我们推荐，额外的配置一个可以专 门用来执行批量操作的sqlSession</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630384016395-3cfe2005-ef7c-47a8-b52d-2adc273fb9df.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=58\&amp;id=uc44211ed\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=116\&amp;originWidth=1073\&amp;originalType=binary\&amp;ratio=1\&amp;size=57775\&amp;status=done\&amp;style=none\&amp;taskId=u284cef3f-2b85-42c4-a3ce-bd5d47043b8\&amp;width=536.5&gt;)
</code></pre>
<ul>
<li><p>需要用到批量操作的时候，我们可以注入配置的这个批量 SqlSession。通过他获取到mapper映射器进行操作。</p>
</li>
<li><p>注意：</p>
<ul>
<li><p>1、批量操作是在session.commit()以后才发送sql语句给数 据库进行执行的</p>
</li>
<li><p>2、如果我们想让其提前执行，以方便后续可能的查询操作 获取数据，我们可以使用sqlSession.flushStatements()方 法，让其直接冲刷到数据库进行执行</p>
</li>
</ul>
</li>
</ul>
<h2 id="3、存储过程"><a href="#3、存储过程" class="headerlink" title="3、存储过程"></a>3、存储过程</h2><ul>
<li><p>实际开发中，我们通常也会写一些存储过程， MyBatis也支持对存储过程的调用</p>
</li>
<li><p>存储过程的调用</p>
<ul>
<li><p>1、select标签中statementType&#x3D;“CALLABLE”</p>
</li>
<li><p>2、标签体中调用语法：</p>
<ul>
<li>{call procedure_name(#{param1_info},#{param2_info})}</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="4、-自定义TypeHandler处理枚举"><a href="#4、-自定义TypeHandler处理枚举" class="headerlink" title="4、 自定义TypeHandler处理枚举"></a>4、 自定义TypeHandler处理枚举</h2><ul>
<li><p>我们可以通过自定义TypeHandler的形式来在设置参数或 者取出结果集的时候自定义参数封装策略。</p>
</li>
<li><p>步骤：</p>
<ul>
<li><p>1、实现TypeHandler接口或者继承BaseTypeHandler</p>
</li>
<li><p>2、使用@MappedTypes定义处理的java类型 使用@MappedJdbcTypes定义jdbcType类型</p>
</li>
<li><p>3、在自定义结果集标签或者参数处理的时候声明使用自定义 TypeHandler进行处理 或者在全局配置TypeHandler要处理的javaType</p>
</li>
</ul>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1630384270656-241bd8ed-7540-4813-9817-6c1c0694c360.png#clientId=u725fc5f1-2140-4\&amp;from=paste\&amp;height=415\&amp;id=u76eabd0c\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=829\&amp;originWidth=1018\&amp;originalType=binary\&amp;ratio=1\&amp;size=270495\&amp;status=done\&amp;style=none\&amp;taskId=uf69ba5ad-41a9-43b4-9fb5-c05a550fb75\&amp;width=509&gt;)
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://chenjinsongcjs.github.io/2022/08/28/MySQL%E9%AB%98%E7%BA%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cjsstart">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technological learning">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/28/MySQL%E9%AB%98%E7%BA%A7/" class="post-title-link" itemprop="url">MySQL高级</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              

              <time title="Erstellt: 2022-08-28 19:21:53 / Geändert am: 19:22:39" itemprop="dateCreated datePublished" datetime="2022-08-28T19:21:53+08:00">2022-08-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL高级"><a href="#MySQL高级" class="headerlink" title="MySQL高级"></a>MySQL高级</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><ul>
<li>MySQL是一个关系型数据库管理系统，由瑞典MySQL AB公司开发，目前属于Oracle公司。</li>
</ul>
<h2 id="2-MySQL配置文件"><a href="#2-MySQL配置文件" class="headerlink" title="2.MySQL配置文件"></a>2.MySQL配置文件</h2><h2 id="3-MySQL逻辑架构介绍"><a href="#3-MySQL逻辑架构介绍" class="headerlink" title="3.MySQL逻辑架构介绍"></a>3.MySQL逻辑架构介绍</h2><ul>
<li><p>和其他数据库相比，MySQL有点与众不同，它的架构可以在多种不同场景中应用并发挥良好作用，主要体现在存储引擎的架构上。</p>
</li>
<li><p>插件式的存储引擎将查询处理和其他的系统任务以及数据的存储提取相分离。这种架构可以根据业务需求和实际需要选择合适的存储引擎。</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626422972138-d01b3807-bde4-42d1-92f6-81c3ae660edc.png#height=486\&amp;id=gQBj3\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=972\&amp;originWidth=1494\&amp;originalType=binary\&amp;ratio=1\&amp;size=1096522\&amp;status=done\&amp;style=none\&amp;width=747&gt;)
</code></pre>
<ul>
<li><p>1.连接层</p>
<ul>
<li>为客户端提供连接服务</li>
</ul>
</li>
<li><p>2.服务层</p>
<ul>
<li>完成大多数的核心服务功能，如：SQL接口，解析，优化，缓存。。。</li>
</ul>
</li>
<li><p>3.引擎层</p>
<ul>
<li>真正负责mysql中数据的存储和提取。</li>
</ul>
</li>
<li><p>4.存储层</p>
<ul>
<li>主要将数据存储在运行于裸设备的文件系统之上。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.Connectors</span><br><span class="line">指的是不同语言中与SQL的交互</span><br><span class="line">2 Management Serveices &amp; Utilities： </span><br><span class="line">系统管理和控制工具</span><br><span class="line">3 Connection Pool: 连接池</span><br><span class="line">管理缓冲用户连接，线程处理等需要缓存的需求。</span><br><span class="line">负责监听对 MySQL Server 的各种请求，接收连接请求，转发所有连接请求到线程管理模块。每一个连接上 MySQL Server 的客户端请求都会被分配（或创建）一个连接线程为其单独服务。而连接线程的主要工作就是负责 MySQL Server 与客户端的通信，</span><br><span class="line">接受客户端的命令请求，传递 Server 端的结果信息等。线程管理模块则负责管理维护这些连接线程。包括线程的创建，线程的 cache 等。</span><br><span class="line">4 SQL Interface: SQL接口。</span><br><span class="line">接受用户的SQL命令，并且返回用户需要查询的结果。比如select from就是调用SQL Interface</span><br><span class="line">5 Parser: 解析器。</span><br><span class="line">SQL命令传递到解析器的时候会被解析器验证和解析。解析器是由Lex和YACC实现的，是一个很长的脚本。</span><br><span class="line">在 MySQL中我们习惯将所有 Client 端发送给 Server 端的命令都称为 query ，在 MySQL Server 里面，连接线程接收到客户端的一个 Query 后，会直接将该 query 传递给专门负责将各种 Query 进行分类然后转发给各个对应的处理模块。</span><br><span class="line">主要功能：</span><br><span class="line">a . 将SQL语句进行语义和语法的分析，分解成数据结构，然后按照不同的操作类型进行分类，然后做出针对性的转发到后续步骤，以后SQL语句的传递和处理就是基于这个结构的。</span><br><span class="line">b.  如果在分解构成中遇到错误，那么就说明这个sql语句是不合理的</span><br><span class="line">6 Optimizer: 查询优化器。</span><br><span class="line">SQL语句在查询之前会使用查询优化器对查询进行优化。就是优化客户端请求的 query（sql语句） ，根据客户端请求的 query 语句，和数据库中的一些统计信息，在一系列算法的基础上进行分析，得出一个最优的策略，告诉后面的程序如何取得这个 query 语句的结果</span><br><span class="line">他使用的是“选取-投影-联接”策略进行查询。</span><br><span class="line">       用一个例子就可以理解： select uid,name from user where gender = 1;</span><br><span class="line">       这个select 查询先根据where 语句进行选取，而不是先将表全部查询出来以后再进行gender过滤</span><br><span class="line">       这个select查询先根据uid和name进行属性投影，而不是将属性全部取出以后再进行过滤</span><br><span class="line">       将这两个查询条件联接起来生成最终查询结果</span><br><span class="line">7 Cache和Buffer： 查询缓存。</span><br><span class="line">他的主要功能是将客户端提交 给MySQL 的 Select 类 query 请求的返回结果集 cache 到内存中，与该 query 的一个 hash 值 做一个对应。该 Query 所取数据的基表发生任何数据的变化之后， MySQL 会自动使该 query 的Cache 失效。在读写比例非常高的应用系统中， Query Cache 对性能的提高是非常显著的。当然它对内存的消耗也是非常大的。</span><br><span class="line">如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。这个缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key缓存，权限缓存等</span><br><span class="line">8 、存储引擎接口</span><br><span class="line">存储引擎接口模块可以说是 MySQL 数据库中最有特色的一点了。目前各种数据库产品中，基本上只有 MySQL 可以实现其底层数据存储引擎的插件式管理。这个模块实际上只是 一个抽象类，但正是因为它成功地将各种数据处理高度抽象化，才成就了今天 MySQL 可插拔存储引擎的特色。</span><br><span class="line">     从图2还可以看出，MySQL区别于其他数据库的最重要的特点就是其插件式的表存储引擎。MySQL插件式的存储引擎架构提供了一系列标准的管理和服务支持，这些标准与存储引擎本身无关，可能是每个数据库系统本身都必需的，如SQL分析器和优化器等，而存储引擎是底层物理结构的实现，每个存储引擎开发者都可以按照自己的意愿来进行开发。</span><br><span class="line">    注意：存储引擎是基于表的，而不是数据库。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-mysql存储引擎"><a href="#4-mysql存储引擎" class="headerlink" title="4.mysql存储引擎"></a>4.mysql存储引擎</h2><ul>
<li><p>查看命令：</p>
<ul>
<li><p>show engines; 查看mysql现在提供的存储引擎</p>
</li>
<li><p>show variables like ‘%storage_engine%’;查看当前默认引擎</p>
</li>
</ul>
</li>
<li><p>myisam和innoDB的区别</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626424312174-eccea742-9aa7-47de-8004-93ff38756f5a.png#height=294\&amp;id=AGdU0\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=588\&amp;originWidth=1353\&amp;originalType=binary\&amp;ratio=1\&amp;size=267337\&amp;status=done\&amp;style=none\&amp;width=676.5&gt;)
</code></pre>
<ul>
<li>InnoDB还支持回滚点的设置</li>
</ul>
</li>
</ul>
<h2 id="5-索引优化分析"><a href="#5-索引优化分析" class="headerlink" title="5.索引优化分析"></a>5.索引优化分析</h2><h3 id="5-1、性能下降SQL慢，执行时间长、等待时间长"><a href="#5-1、性能下降SQL慢，执行时间长、等待时间长" class="headerlink" title="5.1、性能下降SQL慢，执行时间长、等待时间长"></a>5.1、性能下降SQL慢，执行时间长、等待时间长</h3><ul>
<li><p>查询语句写的不好</p>
</li>
<li><p>索引失效</p>
</li>
<li><p>关联太多的join</p>
</li>
<li><p>服务器调优及各个参数设置(缓冲、线程数等待)</p>
</li>
</ul>
<h3 id="5-2、常见通用的join查询"><a href="#5-2、常见通用的join查询" class="headerlink" title="5.2、常见通用的join查询"></a>5.2、常见通用的join查询</h3><ul>
<li><p>SQL执行顺序</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626425424717-510168de-9561-4e21-9c28-47d93fb86d1c.png#height=163\&amp;id=avYsh\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=326\&amp;originWidth=373\&amp;originalType=binary\&amp;ratio=1\&amp;size=40150\&amp;status=done\&amp;style=none\&amp;width=186.5&gt;)
</code></pre>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626425438191-e527a309-4fa0-47c3-9175-0ef8a90b04e1.png#height=119\&amp;id=oRT9H\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=238\&amp;originWidth=278\&amp;originalType=binary\&amp;ratio=1\&amp;size=39685\&amp;status=done\&amp;style=none\&amp;width=139&gt;)
</code></pre>
<p>*</p>
<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626425446377-4b225cc9-aeb5-449e-b69e-05b7c1da089b.png#height=114\&amp;id=pkIr2\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=228\&amp;originWidth=799\&amp;originalType=binary\&amp;ratio=1\&amp;size=55974\&amp;status=done\&amp;style=none\&amp;width=399.5&gt;)
</code></pre>
</li>
<li><p>join图</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626425590590-a056073d-c6e0-48c1-b901-f5bf76b7102a.png#height=298\&amp;id=EEs2t\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=595\&amp;originWidth=783\&amp;originalType=binary\&amp;ratio=1\&amp;size=360399\&amp;status=done\&amp;style=none\&amp;width=391.5&gt;)
</code></pre>
</li>
</ul>
<h3 id="5-3、索引简介"><a href="#5-3、索引简介" class="headerlink" title="5.3、索引简介"></a>5.3、索引简介</h3><ul>
<li><p>索引是什么</p>
<ul>
<li><p>MySQL官方定义：索引是帮助MySQL高效获取数据的数据结构。</p>
</li>
<li><p>你可以理解为：排好序的快速查找的数据结构。</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626426210899-4935c780-5ad2-4b7e-a459-f84b90b0f7dc.png#height=155\&amp;id=MRwZ7\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=309\&amp;originWidth=751\&amp;originalType=binary\&amp;ratio=1\&amp;size=135575\&amp;status=done\&amp;style=none\&amp;width=375.5&gt;)
</code></pre>
<ul>
<li><p>一般来说索引本身很大，不可能全部存储在内存中，因此往往以文件形式存储在硬盘上</p>
</li>
<li><p>我们平时所说的索引，如果没有特别指明，都是指B树(多路搜索树，并不一定是二叉树)结构组织的索引。其中聚集索引，次要索引，覆盖索引，复合索引，前缀索引，唯一索引默认都是使用B+树索引，统称索引。当然,除了B+树这种类型的索引之外，还有哈希索引(hash index)等。</p>
</li>
</ul>
</li>
<li><p>索引优势</p>
<ul>
<li><p>类似于大学图书馆书目索引，提高数据检索效率，降低数据的IO成本</p>
</li>
<li><p>通过索引列对数据进行排序，降低数据排序成本，降低了CPU的消耗</p>
</li>
</ul>
</li>
<li><p>索引劣势</p>
<ul>
<li><p>实际上索引也是一张表，该表保存了主键和索引字段，并指向实体表的记录，所以索引列也是要占用空间的。</p>
</li>
<li><p>虽然索引大大提高了查询速度，同时却降低了更新表的速度。如果对表进行增删改，不仅要更新数据，同时还需要更新索引信息。</p>
</li>
<li><p>索引只是提高效率的一个因素，如果你的mysql中有大数据量的表，就需要花时间建立优秀的索引。</p>
</li>
</ul>
</li>
<li><p>索引分类</p>
<ul>
<li><p>单值索引：一个索引只包含单个列，一个表可以有多个单值索引。建议单值索引不超过5个，优先考虑复合索引。</p>
</li>
<li><p>唯一索引：索引列的值必须唯一，但允许空值</p>
</li>
<li><p>复合索引：一个索引包含多个列</p>
</li>
</ul>
</li>
<li><p>基本语法</p>
<ul>
<li><p>创建</p>
<ul>
<li><p>CREATE [UNIQUE] INDEX indexname ON tablename(columename(length));</p>
</li>
<li><p>ALTER TABLE tablename ADD [UNIQUE] INDEX [indexname]  (columename(length));</p>
</li>
<li><p>如果是char、varchar，length可以小于字段实际长度；如果是blob和text类型必须指定length。</p>
</li>
</ul>
</li>
<li><p>删除</p>
<ul>
<li>DROP INDEX indexname ON tablename;</li>
</ul>
</li>
<li><p>查看</p>
<ul>
<li>SHOW INDEX FROM tablename;</li>
</ul>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626428756513-43d48137-022d-4abf-bdc6-45a3fda7b783.png#height=153\&amp;id=pvsmF\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=306\&amp;originWidth=1225\&amp;originalType=binary\&amp;ratio=1\&amp;size=135095\&amp;status=done\&amp;style=none\&amp;width=612.5&gt;)
</code></pre>
</li>
<li><p>MySQL索引结构</p>
<ul>
<li><p>BTree索引</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626429031988-da805a92-f028-48bc-b743-d3e638e8f8d0.png#height=240\&amp;id=pa5Td\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=240\&amp;originWidth=500\&amp;originalType=binary\&amp;ratio=1\&amp;size=152906\&amp;status=done\&amp;style=none\&amp;width=500&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626429496365-bf85777b-f931-462d-9975-235c101ebfd4.png#height=268\&amp;id=dkW8Y\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=536\&amp;originWidth=1695\&amp;originalType=binary\&amp;ratio=1\&amp;size=206947\&amp;status=done\&amp;style=none\&amp;width=847.5&gt;)
</code></pre>
<ul>
<li><a target="_blank" rel="noopener" href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html" title="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">http://blog.codinglabs.org/articles/theory-of-mysql-index.html</a></li>
</ul>
</li>
<li><p>Hash索引</p>
</li>
<li><p>full-text全文索引</p>
</li>
<li><p>R-Tree索引</p>
</li>
</ul>
</li>
<li><p>那些情况需要建索引</p>
<ul>
<li><p>1.主键自动创建唯一索引</p>
</li>
<li><p>2.频繁作为查询条件的字段应该创建索引</p>
</li>
<li><p>3.查询中与其他表关联的字段，外键关系建立索引。</p>
</li>
<li><p>4.频繁更新的字段不适合创建索引，因为每次更新不仅仅是更新记录还会更新索引，增加IO负担</p>
</li>
<li><p>5.where条件里用不到的字段不创建索引</p>
</li>
<li><p>6.单值、组合索引的选择问题，（在高并发下倾向创建组合索引）</p>
</li>
<li><p>7.查询中排序的字段，排序字段若通过索引去访问将大大提高排序的速度。</p>
</li>
<li><p>8.排序中统计或者分组字段。</p>
</li>
</ul>
</li>
<li><p>那些情况不要创建索引</p>
<ul>
<li><p>表记录太少</p>
</li>
<li><p>经常增删改的表</p>
</li>
<li><p>数据重复且分布平均的表字段；如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</p>
</li>
</ul>
</li>
</ul>
<h3 id="5-4、性能分析"><a href="#5-4、性能分析" class="headerlink" title="5.4、性能分析"></a>5.4、性能分析</h3><ul>
<li><p>MySQL 查询优化</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626431524421-a44470ce-1d25-4ef4-ad85-64f2047ebebd.png#height=97\&amp;id=FmX5Y\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=194\&amp;originWidth=752\&amp;originalType=binary\&amp;ratio=1\&amp;size=170944\&amp;status=done\&amp;style=none\&amp;width=376&gt;)
</code></pre>
</li>
<li><p>MySQL常见瓶颈</p>
<ul>
<li><p>CPU：CPU饱和的时候一般发生在数据装入内存的时候</p>
</li>
<li><p>IO：磁盘IO瓶颈发生在装入数据远大于内存容量时</p>
</li>
<li><p>服务器硬件的性能瓶颈：top&#x2F;free&#x2F;iostat&#x2F;vmstat来查看系统的性能状态。</p>
</li>
</ul>
</li>
<li><p>Explain</p>
<ul>
<li><p>是什么：查看执行计划</p>
<ul>
<li>使用EXPLAIN关键字可以模拟优化器执行SQL语句，从而知道mysql是如何处理你的sql语句，分析你的查询语句或者结构的性能瓶颈。</li>
</ul>
</li>
<li><p>能干嘛</p>
<ul>
<li><p>表的读取顺序</p>
</li>
<li><p>数据读取操作的操作类型</p>
</li>
<li><p>那些索引可以使用</p>
</li>
<li><p>那些索引被实际使用</p>
</li>
<li><p>表之间的引用</p>
</li>
<li><p>每张表有多少行被优化器查询</p>
</li>
</ul>
</li>
<li><p>怎么用</p>
<ul>
<li><p>Explain+SQL语句</p>
</li>
<li><p>执行计划包含的信息</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626433096842-97147233-26ee-4774-8ec9-f391b8d1a6f9.png#height=20\&amp;id=i2QCg\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=40\&amp;originWidth=1919\&amp;originalType=binary\&amp;ratio=1\&amp;size=7697\&amp;status=done\&amp;style=none\&amp;width=959.5&gt;)
</code></pre>
</li>
</ul>
</li>
<li><p>各个字段解释</p>
<ul>
<li><p>id</p>
<ul>
<li><p>select查询的序列号，包含一组数字，表示查询中执行select子句或操作表的顺序。</p>
</li>
<li><p>id相同，执行顺序由上至下</p>
</li>
<li><p>id不同，如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行。</p>
</li>
<li><p>id相同和不同，同时存在。id如果相同可以认为是同一组，从上之下执行，在所有组中id值越大优先级越高，越先执行。</p>
</li>
</ul>
</li>
<li><p>select_type</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626435720171-9330e7df-3ac1-4719-bcb1-7f9dd4aa6863.png#height=133\&amp;id=ZUmEz\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=265\&amp;originWidth=305\&amp;originalType=binary\&amp;ratio=1\&amp;size=91438\&amp;status=done\&amp;style=none\&amp;width=152.5&gt;)
</code></pre>
<ul>
<li><p>SIMPLE：简单的select查询，查询中不包含子查询或者UNION</p>
</li>
<li><p>PRIMARY：查询中若包含任何复杂的子查询，最外层查询则被标记为primary</p>
</li>
<li><p>SUBQUERY：在select或者where中包含了子查询</p>
</li>
<li><p>DERIVED：在from列表中的子查询被标记为derived(衍生)，mysql会递归执行这些子查询，把结果放在临时表中。</p>
</li>
<li><p>UNION：若第二个SELECT出现在UNION之后，则被标记为UNION;若UNION包含在FROM子句的子查询中，外层SELECT将被标记为：DERIVED</p>
</li>
<li><p>UNION RESULT：从union表中获取结果的select</p>
</li>
</ul>
</li>
<li><p>table</p>
<ul>
<li>显示这一行数据时关于那张表的。</li>
</ul>
</li>
<li><p>type</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626437121766-c758cacf-3c99-408f-a18b-b8ef1d138f5e.png#height=37\&amp;id=RIiSm\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=74\&amp;originWidth=793\&amp;originalType=binary\&amp;ratio=1\&amp;size=43322\&amp;status=done\&amp;style=none\&amp;width=396.5&gt;)
</code></pre>
<ul>
<li><p>访问类型排列</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626437216902-ff166bb8-b7ab-4109-a801-7bcbdb85adac.png#height=122\&amp;id=a5D1W\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=244\&amp;originWidth=735\&amp;originalType=binary\&amp;ratio=1\&amp;size=52267\&amp;status=done\&amp;style=none\&amp;width=367.5&gt;)
</code></pre>
<ul>
<li><p>显示查询使用了何种类型：最好到最差依次为：system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;all</p>
<ul>
<li><p>system：表只有一行记录（等于系统表），这是const的特例，平时不会出现，这个也可以忽略。</p>
</li>
<li><p>const：表示通过一次索引就找到了，const用于比较primary key或者unique索引，因为只匹配一行数据，所以很快，如果将主键置于where中，就能将查询转换为常量。</p>
</li>
<li><p>eq_ref：唯一性索引，对于每个索引键，表中只有一条记录与之匹配，常见于主键或唯一索引扫描。</p>
</li>
<li><p>ref：非唯一索引扫描，返回匹配某个单独值的所有行。</p>
</li>
<li><p>range：只检索指定范围的行，使用一个索引来选择行，key列显示使用了那个索引，一般就是在你的where语句中出现了between、&lt;、&gt;、in等的查询这种范围扫描索引扫描比全表扫描要好，因为他只需要开始索引的某一点，而结束于另一点，不用扫描全部索引</p>
</li>
<li><p>index：Full index Scan,index与all的区别为index值遍历索引树。因为索引文件通常比数据文件小，，也就是说虽然all和index都是全表扫描，但是index是从索引中读，而all是从硬盘中读。</p>
</li>
<li><p>all：Fulltable Scan 遍历全表找到匹配的行。</p>
</li>
<li><p>备注：一般来说，得保证查询只是达到range级别，最好达到ref。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>possible_keys</p>
<ul>
<li>显示可能应用到这张表中的索引，一个或多个。查询涉及到的字段若存在索引，则该索引被列出，但不一定被查询实际使用。</li>
</ul>
</li>
<li><p>key</p>
<ul>
<li><p>实际使用的索引，如果为null则没有使用索引。</p>
</li>
<li><p>查询中若使用了覆盖索引，则索引和查询的select字段重叠</p>
</li>
</ul>
</li>
<li><p>key_len</p>
<ul>
<li><p>表示索引中使用的字节数，可以通过该列计算查询中使用的索引的长度。在不损失精度的情况下，越短越好。</p>
</li>
<li><p>key_len显示的值为索引最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的</p>
</li>
</ul>
</li>
<li><p>ref</p>
<ul>
<li>显示索引那一列被使用了，如果可能的话，是一个常数，那些列或常量被用于查找索引列上的值。</li>
</ul>
</li>
<li><p>rows</p>
<ul>
<li>根据表统计信息及索引 选用情况，大致估算出找到所需的记录所需要读取的行数。越少越好。</li>
</ul>
</li>
<li><p>Extra：包含不适合在其他列中显示但十分重要的额外信息</p>
<ul>
<li><p>Using filesort：</p>
<ul>
<li>说明mysql会对数据使用一个外部的索引排序，而不是按照表内的索引排序进行读取。mysql中无法利用索引完成排序操作称为文件排序。</li>
</ul>
</li>
<li><p>Using temporary：</p>
<ul>
<li>使用临时表保存中间结果，mysql在对查询结果排序时使用临时表。常用于order by和group by</li>
</ul>
</li>
<li><p>Using index：</p>
<ul>
<li><p>覆盖索引</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626441126156-2bfef365-b70c-4745-800b-fbc907394c6b.png#height=166\&amp;id=YwxbT\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=332\&amp;originWidth=910\&amp;originalType=binary\&amp;ratio=1\&amp;size=179086\&amp;status=done\&amp;style=none\&amp;width=455&gt;)
</code></pre>
<ul>
<li><p>表示相应的select操作中使用了覆盖索引（Coveing Index）,避免访问了表的数据行，效率不错！如果同时出现using where，表明索引被用来执行索引键值的查找；如果没有同时出现using where，表明索引用来读取数据而非执行查找动作。</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626441482228-2459c41e-ddea-43a9-92b6-853d599817f0.png#height=172\&amp;id=Dc68w\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=344\&amp;originWidth=682\&amp;originalType=binary\&amp;ratio=1\&amp;size=83524\&amp;status=done\&amp;style=none\&amp;width=341&gt;)
</code></pre>
</li>
<li><p>Using where：表明使用where过滤</p>
</li>
<li><p>Using join buffer：使用连接缓存</p>
</li>
<li><p>impossible where：where子句的值总是false，不能获取任何数据</p>
</li>
<li><p>.select tables optimized away：</p>
<ul>
<li>在没有GROUPBY子句的情况下，基于索引优化MIN&#x2F;MAX操作或者对于MyISAM存储引擎优化COUNT( *)操作，不必等到执行阶段再进行计算，查询执行计划生成的阶段即完成优化。</li>
</ul>
</li>
<li><p>distinct：优化distinct ，在找到第一匹配的元素后就停止找同样值的操作。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>热身case</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626442006302-ff760918-ec6b-4616-b99c-79fcb17dcf20.png#height=115\&amp;id=AKlUq\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=230\&amp;originWidth=694\&amp;originalType=binary\&amp;ratio=1\&amp;size=44378\&amp;status=done\&amp;style=none\&amp;width=347&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626442012616-9569edc1-a2b2-4694-b2e5-673eb5427043.png#height=118\&amp;id=l1IFS\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=236\&amp;originWidth=905\&amp;originalType=binary\&amp;ratio=1\&amp;size=184068\&amp;status=done\&amp;style=none\&amp;width=452.5&gt;)
</code></pre>
</li>
</ul>
</li>
<li><p>索引优化</p>
<ul>
<li><p>索引分析</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626443189859-a36187db-42e9-4ee7-aca2-cfd941de7e2c.png#height=185\&amp;id=veQw9\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=370\&amp;originWidth=598\&amp;originalType=binary\&amp;ratio=1\&amp;size=114035\&amp;status=done\&amp;style=none\&amp;width=299&gt;)
</code></pre>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626443196038-3327d741-cebe-4998-86ac-565571c3020b.png#height=131\&amp;id=wphte\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=261\&amp;originWidth=845\&amp;originalType=binary\&amp;ratio=1\&amp;size=106131\&amp;status=done\&amp;style=none\&amp;width=422.5&gt;)
</code></pre>
<p>*</p>
<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626443210619-fb918842-0cb2-4787-936d-5a85f1383d46.png#height=147\&amp;id=fsiZn\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=293\&amp;originWidth=745\&amp;originalType=binary\&amp;ratio=1\&amp;size=81073\&amp;status=done\&amp;style=none\&amp;width=372.5&gt;)

![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626443214712-4d0eeaf9-24b9-4e8c-b689-4c1923c1106b.png#height=44\&amp;id=fejIJ\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=88\&amp;originWidth=616\&amp;originalType=binary\&amp;ratio=1\&amp;size=33259\&amp;status=done\&amp;style=none\&amp;width=308&gt;)
</code></pre>
</li>
<li><p>避免索引失效</p>
<ul>
<li><p>全值匹配</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626443400248-d58658a5-4f64-4c1d-9e4a-556a2da4ce6e.png#height=284\&amp;id=DHHB0\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=567\&amp;originWidth=1136\&amp;originalType=binary\&amp;ratio=1\&amp;size=195424\&amp;status=done\&amp;style=none\&amp;width=568&gt;)
</code></pre>
</li>
<li><p>最佳左前缀法则</p>
<ul>
<li><p>如果索引了多列，要遵守最佳左前缀法则，指的是查询从索引的最左前列开始并且不跳过索引中的列。</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626443721813-90edde69-0dda-4288-acb3-bb4199fd3f85.png#height=160\&amp;id=Rwv0p\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=319\&amp;originWidth=590\&amp;originalType=binary\&amp;ratio=1\&amp;size=59050\&amp;status=done\&amp;style=none\&amp;width=295&gt;)
</code></pre>
</li>
<li><p>不要在索引列上做任何操作(计算、函数、自动或手动的类型转换)，会导致索引失效而转为全表扫描。</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626443858732-a985b3ca-653f-451c-9eda-b3d5a4ec5622.png#height=160\&amp;id=PJQRX\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=319\&amp;originWidth=590\&amp;originalType=binary\&amp;ratio=1\&amp;size=59050\&amp;status=done\&amp;style=none\&amp;width=295&gt;)
</code></pre>
</li>
<li><p>存储引擎不能使用索引中范围条件右边的列</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626444126287-99aa9711-d6e6-4dd7-8495-bcad00dafa55.png#height=258\&amp;id=zz3hY\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=516\&amp;originWidth=1280\&amp;originalType=binary\&amp;ratio=1\&amp;size=338150\&amp;status=done\&amp;style=none\&amp;width=640&gt;)
</code></pre>
</li>
<li><p>尽量使用覆盖索引（只访问索引的查询（索引列和查询列一致）），减少select*</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626444452523-d706b2b5-9233-4fdd-acf7-a32a0a50da4e.png#height=262\&amp;id=cVhUt\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=524\&amp;originWidth=1368\&amp;originalType=binary\&amp;ratio=1\&amp;size=356462\&amp;status=done\&amp;style=none\&amp;width=684&gt;)
</code></pre>
</li>
<li><p>mysql在使用不等于（！&#x3D;或者&lt;&gt;）的时候无法使用索引会导致全表扫描</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626444541601-e92b0742-58ec-4a39-b387-fda174dd20d5.png#height=196\&amp;id=mV4k9\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=391\&amp;originWidth=1167\&amp;originalType=binary\&amp;ratio=1\&amp;size=223453\&amp;status=done\&amp;style=none\&amp;width=583.5&gt;)
</code></pre>
</li>
<li><p>is null,is not null 也无法使用索引</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626444655547-689a0661-7b46-41ab-9ddb-648e992f4efa.png#height=67\&amp;id=QPH1E\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=133\&amp;originWidth=539\&amp;originalType=binary\&amp;ratio=1\&amp;size=43421\&amp;status=done\&amp;style=none\&amp;width=269.5&gt;)
</code></pre>
</li>
<li><p>like以通配符开头（’$abc…’）mysql索引失效会变成全表扫描操作</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626444742754-8483ca12-65cd-4eca-8705-44c82cb2ddfd.png#height=260\&amp;id=UKSwp\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=519\&amp;originWidth=1169\&amp;originalType=binary\&amp;ratio=1\&amp;size=283354\&amp;status=done\&amp;style=none\&amp;width=584.5&gt;)
</code></pre>
</li>
<li><p>字符串不加单引号索引失效</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626444854802-b34d715a-62c9-4bf9-a22c-e391eceb2263.png#height=179\&amp;id=msrm3\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=357\&amp;originWidth=806\&amp;originalType=binary\&amp;ratio=1\&amp;size=65336\&amp;status=done\&amp;style=none\&amp;width=403&gt;)
</code></pre>
</li>
<li><p>少用or,用它连接时会索引失效</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626444897550-116a5c49-e652-49e6-9b1c-e7524022febb.png#height=86\&amp;id=hdjhw\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=171\&amp;originWidth=618\&amp;originalType=binary\&amp;ratio=1\&amp;size=54223\&amp;status=done\&amp;style=none\&amp;width=309&gt;)
</code></pre>
</li>
<li><p>总结</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626445011866-e343fa3a-b4cb-407b-886f-fb6b18e7e8f4.png#height=164\&amp;id=XJriI\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=327\&amp;originWidth=805\&amp;originalType=binary\&amp;ratio=1\&amp;size=100058\&amp;status=done\&amp;style=none\&amp;width=402.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626445017791-b326c757-b09c-4f18-b98f-e9ac8e70a7f7.png#height=86\&amp;id=RGIdf\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=172\&amp;originWidth=239\&amp;originalType=binary\&amp;ratio=1\&amp;size=43766\&amp;status=done\&amp;style=none\&amp;width=119.5&gt;)
</code></pre>
<ul>
<li>like KK%相当于&#x3D;常量     %KK和%KK% 相当于范围</li>
</ul>
</li>
<li><p>一般性建议</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626445344718-c82f97d7-deed-4873-a435-e08496c59c72.png#height=108\&amp;id=IXLAh\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=216\&amp;originWidth=1110\&amp;originalType=binary\&amp;ratio=1\&amp;size=47064\&amp;status=done\&amp;style=none\&amp;width=555&gt;)
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="6-查询截取分析"><a href="#6-查询截取分析" class="headerlink" title="6.查询截取分析"></a>6.查询截取分析</h2><h3 id="6-1、查询优化"><a href="#6-1、查询优化" class="headerlink" title="6.1、查询优化"></a>6.1、查询优化</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1626510263107-026536e4-db9a-455c-bbb6-ca07e9788930.png#height=162&id=Ylmhy&margin=[object%20Object]&name=image.png&originHeight=324&originWidth=606&originalType=binary&ratio=1&size=100299&status=done&style=none&width=303"></p>
<ul>
<li><p>永远小表驱动大表，类似嵌套循环Nested Loop</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626510587952-396378ee-66f4-4a26-8575-bb1745de3022.png#height=213\&amp;id=DPsfJ\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=425\&amp;originWidth=683\&amp;originalType=binary\&amp;ratio=1\&amp;size=124733\&amp;status=done\&amp;style=none\&amp;width=341.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626510827546-aa15b8aa-06ab-4311-abe1-356972e30a9c.png#height=35\&amp;id=omY8L\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=70\&amp;originWidth=736\&amp;originalType=binary\&amp;ratio=1\&amp;size=26152\&amp;status=done\&amp;style=none\&amp;width=368&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626510832651-578b58c8-9ce4-4ab1-b245-237b38406e9a.png#height=51\&amp;id=xSJqZ\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=101\&amp;originWidth=842\&amp;originalType=binary\&amp;ratio=1\&amp;size=37714\&amp;status=done\&amp;style=none\&amp;width=421&gt;)
</code></pre>
</li>
<li><p>order by 关键字优化</p>
<ul>
<li><p>order by子句，尽量使用index方式排序，避免使用filesort方式排序</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626511394487-9a3a7299-cfc9-4515-b2d7-0b527f766053.png#height=263\&amp;id=g1CIN\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=525\&amp;originWidth=1297\&amp;originalType=binary\&amp;ratio=1\&amp;size=329315\&amp;status=done\&amp;style=none\&amp;width=648.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626511406726-4fc3f6f7-ab16-40d9-9f94-948d734aeb5f.png#height=258\&amp;id=DVSMi\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=516\&amp;originWidth=1282\&amp;originalType=binary\&amp;ratio=1\&amp;size=320999\&amp;status=done\&amp;style=none\&amp;width=641&gt;)
</code></pre>
<ul>
<li><p>MySQL支持二种方式的排序，FileSort和Index,Index效率高。它指MySQL扫描索引本身完成排序。FileSort方式效率较低。</p>
</li>
<li><p>order by满足两种情况，会使用index方式排序</p>
<ul>
<li><p>order by语句使用索引最左前列</p>
</li>
<li><p>使用where字句与order by字句条件组合满足索引最左前列。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>尽可能在索引列上完成排序操作，遵照索引键的最佳左前缀</p>
</li>
<li><p>如果不在索引列上，filesort有两种算法：mysql就要启动双路排序和单路排序。</p>
<ul>
<li><p>双路排序：mysql在4.1之前使用双路排序，字面意思就是两次扫描磁盘，最终得到数据，读取行指针和orderby列，对他们进行排序，然后扫描已经排序好的列表，按照列表总的值从列表中读取相应的数据传输。（从磁盘中取排序字段，在buffer中进行排序，在从磁盘取得其他字段）</p>
</li>
<li><p>取一批数据，要对磁盘进行两次扫描，众所周知，I\O是很耗时的，所以在mysql4.1之后，出现了第二张改进的算法，就是单路排序。</p>
</li>
<li><p>单路排序算法：从磁盘读取查询需要的所有列，按照orderby列在buffer对它们进行排序，然后扫描排序后的列表进行输出，它的效率更快一些，避免了第二次读取数据，并且把随机IO变成顺序IO，但是它会使用更多的空间，因为它把每一行都保存在内存中了。</p>
</li>
<li><p>结论及问题</p>
<ul>
<li><p>由于单路排序是后面出来的，总体而言好于双路排序</p>
</li>
<li><p>但是用单路有问题</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626512683920-087f3d63-79be-47a2-817b-998764aef738.png#height=57\&amp;id=wBO2M\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=113\&amp;originWidth=830\&amp;originalType=binary\&amp;ratio=1\&amp;size=75147\&amp;status=done\&amp;style=none\&amp;width=415&gt;)
</code></pre>
</li>
<li><p>优化策略：</p>
<ul>
<li><p>增大sort_buffer_size参数设置</p>
</li>
<li><p>增大max_length_for_sort_data参数设置</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626513018501-7a28b66d-1b81-4221-8aad-1d5853fa395c.png#height=181\&amp;id=LQrrH\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=362\&amp;originWidth=934\&amp;originalType=binary\&amp;ratio=1\&amp;size=211299\&amp;status=done\&amp;style=none\&amp;width=467&gt;)
</code></pre>
</li>
<li><p>总结</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626513222968-c5cfc38a-dffb-445d-907e-5ff692d2a074.png#height=194\&amp;id=tMepA\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=388\&amp;originWidth=568\&amp;originalType=binary\&amp;ratio=1\&amp;size=155982\&amp;status=done\&amp;style=none\&amp;width=284&gt;)
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>group by 关键字优化</p>
<ul>
<li><p>group by实质是先排序后分组，遵照索引键的最佳左前缀</p>
</li>
<li><p>当无法使用索引列，增大max_length_for_sort_data参数的设置+增大sort_buffer_size参数的设置</p>
</li>
<li><p>where高于having,能写在where限定的条件就不要去having限定了。</p>
</li>
</ul>
</li>
</ul>
<h3 id="6-2、慢查询日志"><a href="#6-2、慢查询日志" class="headerlink" title="6.2、慢查询日志"></a>6.2、慢查询日志</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kerrycode/p/5593204.html">https://www.cnblogs.com/kerrycode/p/5593204.html</a></p>
<ul>
<li>是什么</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/21698573/1626513955559-afaa8b02-db45-45cc-886d-1b0a97953701.png#height=161&id=L18gZ&margin=[object%20Object]&name=image.png&originHeight=321&originWidth=955&originalType=binary&ratio=1&size=154358&status=done&style=none&width=477.5"></p>
<ul>
<li><p>怎么玩</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626514164322-5b8e593e-5e09-4004-bd27-8c2a13d75909.png#height=68\&amp;id=qKcd8\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=135\&amp;originWidth=950\&amp;originalType=binary\&amp;ratio=1\&amp;size=74107\&amp;status=done\&amp;style=none\&amp;width=475&gt;)
</code></pre>
<ul>
<li><p>查看是否开启及如何开启</p>
<ul>
<li><p>show variables like ‘%slow_query_log%’;</p>
</li>
<li><p>set global slow_query_log &#x3D; 1;</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626514431617-ef8d65d0-249d-4b21-be32-bc8eaebee890.png#height=186\&amp;id=PJrmD\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=371\&amp;originWidth=725\&amp;originalType=binary\&amp;ratio=1\&amp;size=78578\&amp;status=done\&amp;style=none\&amp;width=362.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626514437083-09e001a4-f2b3-414b-8207-440e2fe69920.png#height=127\&amp;id=XHUXf\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=254\&amp;originWidth=956\&amp;originalType=binary\&amp;ratio=1\&amp;size=124455\&amp;status=done\&amp;style=none\&amp;width=478&gt;)
</code></pre>
</li>
<li><p>那么开启慢查询日志后，什么样的SQL参会记录到慢查询里面？</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626514754424-25868ec2-39c8-47ab-9719-6983118fecce.png#height=163\&amp;id=qG7gi\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=325\&amp;originWidth=731\&amp;originalType=binary\&amp;ratio=1\&amp;size=113035\&amp;status=done\&amp;style=none\&amp;width=365.5&gt;)
</code></pre>
</li>
<li><p>查看当前多少秒算慢：SHOW VARIABLES LIKE ‘%long_query_time%’;</p>
</li>
<li><p>设置慢的阙值时间：SET GLOBAL long_query_time &#x3D; 5;</p>
</li>
<li><p>为什么设置后看不出变化？：需要重新连接或者新开一个回话才能看到修改值。SHOW VARIABLES LIKE ‘long_query_time%’;</p>
</li>
<li><p>记录慢SQL并后续分析：</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626515266448-8428f374-8641-4982-91a6-61abc3520265.png#height=203\&amp;id=y6piz\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=405\&amp;originWidth=884\&amp;originalType=binary\&amp;ratio=1\&amp;size=105849\&amp;status=done\&amp;style=none\&amp;width=442&gt;)
</code></pre>
</li>
<li><p>查询当前系统中有多少条慢查询记录</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626515402728-81985c75-1488-4623-83de-8841375814d3.png#height=114\&amp;id=VPyt6\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=227\&amp;originWidth=407\&amp;originalType=binary\&amp;ratio=1\&amp;size=28522\&amp;status=done\&amp;style=none\&amp;width=203.5&gt;)
</code></pre>
</li>
<li><p>配置</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626515573272-a99a2a93-3c33-43c7-9c04-03ed6368fa92.png#height=83\&amp;id=wTcGL\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=165\&amp;originWidth=450\&amp;originalType=binary\&amp;ratio=1\&amp;size=35601\&amp;status=done\&amp;style=none\&amp;width=225&gt;)
</code></pre>
</li>
</ul>
</li>
<li><p>日志分析工具mysqldumpshow</p>
<ul>
<li><p>查看mysqldumpshow的帮助信息</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626515814862-123296bc-7fe7-44b0-b4bf-d0ac6d72cd97.png#height=196\&amp;id=nIbP7\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=392\&amp;originWidth=581\&amp;originalType=binary\&amp;ratio=1\&amp;size=52113\&amp;status=done\&amp;style=none\&amp;width=290.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626515830072-66f4bdaa-775b-4ca1-a596-c2bea795e19a.png#height=333\&amp;id=C6uPQ\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=665\&amp;originWidth=1118\&amp;originalType=binary\&amp;ratio=1\&amp;size=58639\&amp;status=done\&amp;style=none\&amp;width=559&gt;)
</code></pre>
</li>
<li><p>工作常用参考</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626515989943-c4b47d85-1598-4e4a-b32e-a8c11bb483eb.png#height=153\&amp;id=Ccz7J\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=306\&amp;originWidth=639\&amp;originalType=binary\&amp;ratio=1\&amp;size=132618\&amp;status=done\&amp;style=none\&amp;width=319.5&gt;)
</code></pre>
</li>
</ul>
<h3 id="6-3、show-profiles"><a href="#6-3、show-profiles" class="headerlink" title="6.3、show profiles"></a>6.3、show profiles</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sxdcgaq8080/p/11844079.html">https://www.cnblogs.com/sxdcgaq8080/p/11844079.html</a></p>
<ul>
<li><p>是什么：是mysql提供可以用来分析当前会话中语句执行的资源消耗情况，可以用于SQL调优测量。</p>
</li>
<li><p>官网：<a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.5/en/show-profile.html" title="http://dev.mysql.com/doc/refman/5.5/en/show-profile.html">http://dev.mysql.com/doc/refman/5.5/en/show-profile.html</a></p>
</li>
<li><p>默认情况下，参数处于关闭状态，并保存最近15次运行结果。</p>
</li>
<li><p>分析步骤：</p>
<ul>
<li><p>1.是否支持，查看当前的SQL版本是否支持</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626516685206-6144be19-b158-4d2a-b38e-af60be31a09c.png#height=163\&amp;id=hXWkf\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=325\&amp;originWidth=361\&amp;originalType=binary\&amp;ratio=1\&amp;size=44555\&amp;status=done\&amp;style=none\&amp;width=180.5&gt;)
</code></pre>
</li>
<li><p>2.开启功能，默认是关闭，使用前需要开启</p>
<ul>
<li>SET profiling &#x3D; 1；</li>
</ul>
</li>
<li><p>3.运行SQL</p>
</li>
<li><p>4.查看结果，show profiles;</p>
</li>
<li><p>5.诊断SQL，show profile cpu,block io for query 上一步前面的问题SQL 数字号码；</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626517400555-86f61352-933b-4f85-9da3-b54f869ad106.png#height=161\&amp;id=UJUQz\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=322\&amp;originWidth=756\&amp;originalType=binary\&amp;ratio=1\&amp;size=114255\&amp;status=done\&amp;style=none\&amp;width=378&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626517416545-64a69f7f-78cf-40eb-ad1a-11ce85359cc4.png#height=328\&amp;id=vcrqo\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=655\&amp;originWidth=1481\&amp;originalType=binary\&amp;ratio=1\&amp;size=78631\&amp;status=done\&amp;style=none\&amp;width=740.5&gt;)
</code></pre>
</li>
<li><p>6.日常开发需要注意的结论</p>
<ul>
<li><p>converting HEAP to MyISAM 查询结果太大，内存都不够用了往磁盘上搬了。</p>
</li>
<li><p>Creating tmp table 创建临时表</p>
<ul>
<li><p>拷贝数据到临时表</p>
</li>
<li><p>用完删除</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626517772613-d542a50c-8c97-407f-9995-0a6203c69ba3.png#height=192\&amp;id=YQuQQ\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=383\&amp;originWidth=253\&amp;originalType=binary\&amp;ratio=1\&amp;size=51882\&amp;status=done\&amp;style=none\&amp;width=126.5&gt;)
</code></pre>
</li>
<li><p>Copying to tmp table on disk 把内存中临时表复制到磁盘，危险！！！</p>
</li>
<li><p>locked</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="6-4、全局查询日志"><a href="#6-4、全局查询日志" class="headerlink" title="6.4、全局查询日志"></a>6.4、全局查询日志</h3><ul>
<li><p>配置启用</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626517954293-592ff997-8fa8-4dca-a315-b33dd587116b.png#height=107\&amp;id=LnZV8\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=213\&amp;originWidth=277\&amp;originalType=binary\&amp;ratio=1\&amp;size=38861\&amp;status=done\&amp;style=none\&amp;width=138.5&gt;)
</code></pre>
</li>
<li><p>编码启用</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626518007801-c97715d8-177b-400e-9908-825af8ab16d3.png#height=181\&amp;id=G7QWQ\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=361\&amp;originWidth=803\&amp;originalType=binary\&amp;ratio=1\&amp;size=73056\&amp;status=done\&amp;style=none\&amp;width=401.5&gt;)
</code></pre>
</li>
<li><p>永远不要在生产环境开启这个功能。</p>
</li>
</ul>
<h2 id="7-MySQL锁机制"><a href="#7-MySQL锁机制" class="headerlink" title="7.MySQL锁机制"></a>7.MySQL锁机制</h2><h3 id="7-1、概述"><a href="#7-1、概述" class="headerlink" title="7.1、概述"></a>7.1、概述</h3><ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626518160648-7061739a-ae65-4014-979b-15cd2b7e2981.png#height=68\&amp;id=sbm4l\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=135\&amp;originWidth=938\&amp;originalType=binary\&amp;ratio=1\&amp;size=97657\&amp;status=done\&amp;style=none\&amp;width=469&gt;)
</code></pre>
<ul>
<li><p>锁分类</p>
<ul>
<li><p>从数据操作的类型(读、写)分</p>
<ul>
<li><p>读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会互相影响</p>
</li>
<li><p>写锁（排它锁）：当前写操作没有完成前，它会阻断其他写锁和读锁。</p>
</li>
</ul>
</li>
<li><p>从数据操作的颗粒度</p>
<ul>
<li><p>表锁</p>
</li>
<li><p>行锁</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="7-2、三锁"><a href="#7-2、三锁" class="headerlink" title="7.2、三锁"></a>7.2、三锁</h3><ul>
<li><p>表锁(偏读)</p>
<ul>
<li><p>特点：偏向myisam存储引擎，开销小，加锁块，无死锁，锁定粒度大，发生锁冲突的概率高，并发最低。</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626519592250-606ecf3f-42d2-403c-9712-3880efb9dd82.png#height=83\&amp;id=FtJDa\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=166\&amp;originWidth=438\&amp;originalType=binary\&amp;ratio=1\&amp;size=38173\&amp;status=done\&amp;style=none\&amp;width=219&gt;)
</code></pre>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626519596323-75c9c4b5-bf0f-4ed6-87c5-2701eea9c142.png#height=29\&amp;id=SLUUB\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=57\&amp;originWidth=129\&amp;originalType=binary\&amp;ratio=1\&amp;size=7123\&amp;status=done\&amp;style=none\&amp;width=64.5&gt;)
</code></pre>
<ul>
<li><p>加读锁</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626519689355-8e507957-0d8c-40bf-a578-74ec174b9ba6.png#height=187\&amp;id=rF5vy\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=373\&amp;originWidth=936\&amp;originalType=binary\&amp;ratio=1\&amp;size=83226\&amp;status=done\&amp;style=none\&amp;width=468&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626519695332-9106558a-b4dd-4e92-be2c-226ec2094141.png#height=149\&amp;id=XNoAr\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=298\&amp;originWidth=944\&amp;originalType=binary\&amp;ratio=1\&amp;size=81512\&amp;status=done\&amp;style=none\&amp;width=472&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626519703662-7806416b-8eff-44aa-9438-bacb49ed7bef.png#height=93\&amp;id=FqNKH\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=186\&amp;originWidth=931\&amp;originalType=binary\&amp;ratio=1\&amp;size=59677\&amp;status=done\&amp;style=none\&amp;width=465.5&gt;)
</code></pre>
</li>
<li><p>加写锁</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626520187124-1319c673-299b-4ec5-aab5-761a612904eb.png#height=199\&amp;id=B24zx\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=398\&amp;originWidth=832\&amp;originalType=binary\&amp;ratio=1\&amp;size=125178\&amp;status=done\&amp;style=none\&amp;width=416&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626520193738-e4d3c64a-8785-4246-a028-a2aba15989ad.png#height=171\&amp;id=ZNngu\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=342\&amp;originWidth=711\&amp;originalType=binary\&amp;ratio=1\&amp;size=47725\&amp;status=done\&amp;style=none\&amp;width=355.5&gt;)
</code></pre>
</li>
<li><p>结论</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626520459086-a180b92e-1959-41ec-b73a-a7133cc28131.png#height=182\&amp;id=dU7TD\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=363\&amp;originWidth=932\&amp;originalType=binary\&amp;ratio=1\&amp;size=166494\&amp;status=done\&amp;style=none\&amp;width=466&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626520480215-36c86127-89d8-4512-b349-be46d4e2b2f5.png#height=24\&amp;id=ED61F\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=48\&amp;originWidth=941\&amp;originalType=binary\&amp;ratio=1\&amp;size=20441\&amp;status=done\&amp;style=none\&amp;width=470.5&gt;)
</code></pre>
</li>
<li><p>表锁分析</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626520647537-e242cfff-25ca-417b-aaf2-b7a896cd1ac8.png#height=172\&amp;id=me8LK\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=343\&amp;originWidth=660\&amp;originalType=binary\&amp;ratio=1\&amp;size=73152\&amp;status=done\&amp;style=none\&amp;width=330&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626520652220-af5df0b6-8b7d-49e7-9fca-8f0171e96e04.png#height=51\&amp;id=w3joI\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=101\&amp;originWidth=933\&amp;originalType=binary\&amp;ratio=1\&amp;size=82519\&amp;status=done\&amp;style=none\&amp;width=466.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626520658439-6737eb59-a977-4da7-ac4c-c19647c63881.png#height=22\&amp;id=hy7HQ\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=44\&amp;originWidth=932\&amp;originalType=binary\&amp;ratio=1\&amp;size=42920\&amp;status=done\&amp;style=none\&amp;width=466&gt;)
</code></pre>
</li>
</ul>
</li>
<li><p>行锁(偏写)</p>
<ul>
<li><p>特点：偏向innoDB存储引擎，开销大，加锁满，锁颗粒度小，发生锁冲突的概率最低，并发度最高。</p>
</li>
<li><p>InnoDB与MyISAM的最大不同有两点：一是支持事务（TRANSACTION）;二是采用了行级锁</p>
</li>
<li><p>行锁支持事务</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626521496295-241fdb15-b10e-43e5-bf65-174194a9d94d.png#height=100\&amp;id=nnwi7\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=199\&amp;originWidth=941\&amp;originalType=binary\&amp;ratio=1\&amp;size=186683\&amp;status=done\&amp;style=none\&amp;width=470.5&gt;)
</code></pre>
<ul>
<li><p>并发事务带来的问题</p>
<ul>
<li><p>更新丢失</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626521599392-d614bae9-8b76-4e1c-8ccf-7c301475e2bb.png#height=103\&amp;id=KYpGd\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=206\&amp;originWidth=940\&amp;originalType=binary\&amp;ratio=1\&amp;size=119975\&amp;status=done\&amp;style=none\&amp;width=470&gt;)
</code></pre>
</li>
<li><p>脏读</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626521691722-a1eb39f0-cdd4-4d1b-a106-82bdb8f11734.png#height=88\&amp;id=m6FyW\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=175\&amp;originWidth=943\&amp;originalType=binary\&amp;ratio=1\&amp;size=112806\&amp;status=done\&amp;style=none\&amp;width=471.5&gt;)
</code></pre>
</li>
<li><p>不可重复读</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626521708959-834f1eae-ecad-4a9e-b39b-e2adf7e37141.png#height=68\&amp;id=tt1fS\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=135\&amp;originWidth=948\&amp;originalType=binary\&amp;ratio=1\&amp;size=64018\&amp;status=done\&amp;style=none\&amp;width=474&gt;)
</code></pre>
</li>
<li><p>幻读</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626521836468-f7f69787-e944-423d-a9af-6e3f1b79a6f5.png#height=126\&amp;id=Jsh3J\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=252\&amp;originWidth=937\&amp;originalType=binary\&amp;ratio=1\&amp;size=84568\&amp;status=done\&amp;style=none\&amp;width=468.5&gt;)
</code></pre>
</li>
<li><p>事务隔离级别</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626521918808-4fc11734-6143-4f67-a001-85736e671161.png#height=184\&amp;id=m1fF0\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=367\&amp;originWidth=942\&amp;originalType=binary\&amp;ratio=1\&amp;size=193995\&amp;status=done\&amp;style=none\&amp;width=471&gt;)
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>行锁基本演示</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626522159916-d47a55c4-467e-4a64-8942-278f000d8ea4.png#height=185\&amp;id=s3Pxg\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=370\&amp;originWidth=896\&amp;originalType=binary\&amp;ratio=1\&amp;size=100394\&amp;status=done\&amp;style=none\&amp;width=448&gt;)
</code></pre>
</li>
<li><p>无索引行锁升级为表锁</p>
<ul>
<li>varchar  不用 ‘ ‘  导致系统自动转换类型, 行锁变表锁</li>
</ul>
</li>
<li><p>间隙锁的危害</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626522344444-a8587501-ce9c-49dc-88df-9ebbfd8b90ca.png#height=304\&amp;id=ADIlM\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=608\&amp;originWidth=1421\&amp;originalType=binary\&amp;ratio=1\&amp;size=376172\&amp;status=done\&amp;style=none\&amp;width=710.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626522349503-ca9bf68a-337b-40bb-ad37-bd413e48aafd.png#height=25\&amp;id=fsod3\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=49\&amp;originWidth=939\&amp;originalType=binary\&amp;ratio=1\&amp;size=57308\&amp;status=done\&amp;style=none\&amp;width=469.5&gt;)
</code></pre>
</li>
<li><p>如何锁定一行</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626522621222-65b2fb48-e9c4-4621-856f-58100b0c3d8d.png#height=146\&amp;id=aMkVF\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=291\&amp;originWidth=927\&amp;originalType=binary\&amp;ratio=1\&amp;size=55847\&amp;status=done\&amp;style=none\&amp;width=463.5&gt;)
</code></pre>
</li>
<li><p>结论</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626523163239-996b526e-9b78-46f7-b3cd-678997311eea.png#height=71\&amp;id=cc4jM\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=142\&amp;originWidth=949\&amp;originalType=binary\&amp;ratio=1\&amp;size=112587\&amp;status=done\&amp;style=none\&amp;width=474.5&gt;)
</code></pre>
</li>
<li><p>行锁分析</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626523246236-25275ea8-6f3a-4a6d-8d0f-e1807b2c1bda.png#height=176\&amp;id=udI99\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=352\&amp;originWidth=633\&amp;originalType=binary\&amp;ratio=1\&amp;size=102940\&amp;status=done\&amp;style=none\&amp;width=316.5&gt;)
</code></pre>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626523250305-b78bff40-cc24-4a73-8de2-a4b00a1e494a.png#height=124\&amp;id=iLfz9\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=248\&amp;originWidth=936\&amp;originalType=binary\&amp;ratio=1\&amp;size=129091\&amp;status=done\&amp;style=none\&amp;width=468&gt;)
</code></pre>
</li>
<li><p>优化建议</p>
<ul>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626523605379-97ba53a8-362f-4ed6-8a4d-f036dce5bc07.png#height=155\&amp;id=qyfnD\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=309\&amp;originWidth=879\&amp;originalType=binary\&amp;ratio=1\&amp;size=38748\&amp;status=done\&amp;style=none\&amp;width=439.5&gt;)
</code></pre>
</li>
</ul>
</li>
<li><p>页锁</p>
<ul>
<li>开销和加锁时间界于表锁和行锁之间：会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。</li>
</ul>
</li>
</ul>
<h2 id="8-主从复制"><a href="#8-主从复制" class="headerlink" title="8.主从复制"></a>8.主从复制</h2><h3 id="8-1、复制的基本原理"><a href="#8-1、复制的基本原理" class="headerlink" title="8.1、复制的基本原理"></a>8.1、复制的基本原理</h3><ul>
<li><p>slave会从master中读取bin-log来进行数据同步</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626524167934-4940fd96-98d2-4835-baa5-dd27ece3f510.png#height=185\&amp;id=FjkdX\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=369\&amp;originWidth=760\&amp;originalType=binary\&amp;ratio=1\&amp;size=150389\&amp;status=done\&amp;style=none\&amp;width=380&gt;)
</code></pre>
<h3 id="8-2、复制的基本原则"><a href="#8-2、复制的基本原则" class="headerlink" title="8.2、复制的基本原则"></a>8.2、复制的基本原则</h3><ul>
<li><p>每个slave只有一个master</p>
</li>
<li><p>每个slave只能有一个唯一的服务器id</p>
</li>
<li><p>每个master可以有多个slave</p>
</li>
<li><p>复制最大的问题就是延时。</p>
</li>
</ul>
<h3 id="8-3、一主一从常见配置"><a href="#8-3、一主一从常见配置" class="headerlink" title="8.3、一主一从常见配置"></a>8.3、一主一从常见配置</h3><ul>
<li><p>mysql版本一致且后台以服务运行</p>
</li>
<li><p>主从都配置在【mysqld】节点下，都是小写</p>
</li>
<li><p>主机修改my.ini配置文件</p>
<ul>
<li><p>主服务器唯一id：server-id &#x3D; 1</p>
</li>
<li><p>启用二进制日志：log-bin&#x3D;自己本地的路径&#x2F;mysqlbin</p>
</li>
<li><p>启动错误日志：log-err&#x3D;自己本地路径&#x2F;mysqlerr</p>
</li>
<li><p>根目录：basedir&#x3D;”自己本地路径”  如：basedir&#x3D;”D：&#x2F;devSoft&#x2F;MySQLService5.5&#x2F;“</p>
</li>
<li><p>临时目录：tmpdir&#x3D;”自己的本地路径” 如：tmpdir&#x3D;”D：&#x2F;devSoft&#x2F;MySQLService5.5&#x2F;“</p>
</li>
<li><p>数据目录：datadir&#x3D;”自己本地路径&#x2F;Data&#x2F;“</p>
</li>
<li><p>read-only&#x3D;0:主机可以进行读写</p>
</li>
<li><p>设置不要复制的数据库：binlog-ignore-db&#x3D;mysql;</p>
</li>
<li><p>设置需要复制的数据：binlog-do-db&#x3D;需要复制的数据库名称。</p>
</li>
</ul>
</li>
<li><p>修改从机my.cnf配置文件</p>
<ul>
<li><p>从服务器唯一id</p>
</li>
<li><p>启用二进制文件</p>
</li>
</ul>
</li>
<li><p>因修改过配置文件，请主机+从机都启动后台mysql服务</p>
</li>
<li><p>主机从机都关闭防火墙</p>
<ul>
<li><p>windows手动关闭</p>
</li>
<li><p>关闭虚拟机linux防火墙service iptables stop</p>
</li>
</ul>
</li>
<li><p>在windows主机上建立用户并授权slave</p>
<ul>
<li><p>GRANT REPLICATION SLAVE  ON <em>.</em> TO ‘zhangsan‘@’从机器数据库IP‘ IDENTIFIED BY ‘123456’;</p>
</li>
<li><p>flush privileges; 刷新权限</p>
</li>
<li><p>查询master的状态</p>
<ul>
<li><p>show master status；</p>
</li>
<li><p>记录下File和Position的值</p>
</li>
</ul>
</li>
<li><p>执行完此步骤后不再执行主服务器MySQL，防止主服务器状态值变化</p>
</li>
</ul>
</li>
<li><p>在linux从机上配置需要复制的主机</p>
<ul>
<li><p>CHANGE MASTER TO MASTER_HOST&#x3D;’主机IP’,MASTER_USER&#x3D;’zhangsan’，MASTER_PASSWORD&#x3D;’123456’,MASTER_LOG_FILE&#x3D;’File名字’，MASTER_LOG_POS&#x3D;Position数字；</p>
</li>
<li></li>
</ul>
<!---->

<pre><code>![](&lt;https://cdn.nlark.com/yuque/0/2021/png/21698573/1626535402927-3a737586-5287-4213-b10b-dc59ad250330.png#height=240\&amp;id=fEMFl\&amp;margin=\[object Object]\&amp;name=image.png\&amp;originHeight=479\&amp;originWidth=968\&amp;originalType=binary\&amp;ratio=1\&amp;size=151719\&amp;status=done\&amp;style=none\&amp;width=484&gt;)
</code></pre>
<ul>
<li><p>启动从服务器复制功能：start salve；</p>
</li>
<li><p>show slave status\G</p>
<ul>
<li><p>下面两个参数都是YES，则说明主从配置成功！</p>
<ul>
<li><p>Slave_IO_Running:Yes</p>
</li>
<li><p>Slave_SQL_Running:Yes</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>主机新建库、新建表、insert记录，从机复制</p>
</li>
<li><p>如何停止从服务复制功能</p>
<ul>
<li>stop slave；</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://chenjinsongcjs.github.io/2022/08/28/MySQL%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cjsstart">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technological learning">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/28/MySQL%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">MySQL基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              

              <time title="Erstellt: 2022-08-28 19:20:28 / Geändert am: 19:21:29" itemprop="dateCreated datePublished" datetime="2022-08-28T19:20:28+08:00">2022-08-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MYSQL基础"><a href="#MYSQL基础" class="headerlink" title="MYSQL基础"></a>MYSQL基础</h1><h1 id="一、数据库的相关概念"><a href="#一、数据库的相关概念" class="headerlink" title="一、数据库的相关概念"></a>一、数据库的相关概念</h1><ol>
<li><p>DB：数据库，存储数据的容器</p>
</li>
<li><p>DBMS：数据库管理系统，又称数据库软件或数据库产品，用于创建和管理DB。</p>
</li>
<li><p>SQL：结构化查询语言，用于和数据库通信的语言，不是某个数据库所特有的，而是几乎所有主流数据库软件通用的语言。</p>
</li>
</ol>
<p>**数据库存储数据的特点： **</p>
<ol>
<li><p>数据存储到表中，然后表再放到库中</p>
</li>
<li><p>一个库中可以有多张表，每张表具有与唯一的表明用来标识自己</p>
</li>
<li><p>表中有一个或多个列，列又称为字段，相当于java中属性</p>
</li>
<li><p>表中的每一行数据，相当于java中对象</p>
</li>
</ol>
<p><strong>常见的数据库管理系统：</strong><br>mysql、oracle、db2、sqlServer<br>**MySQL服务的登录和退出: **<br>登录：mysql 【-h 主机名 -P 端口号】 -u 用户名 -p密码<br>退出：exit或ctrl+C</p>
<h1 id="二、基础查询（DQL语言）"><a href="#二、基础查询（DQL语言）" class="headerlink" title="二、基础查询（DQL语言）"></a>二、基础查询（DQL语言）</h1><h2 id="1、语法"><a href="#1、语法" class="headerlink" title="1、语法"></a>1、语法</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"> `:着重号用于区分关键字和字段名。</span><br></pre></td></tr></table></figure>

<h2 id="2、特点"><a href="#2、特点" class="headerlink" title="2、特点"></a>2、特点</h2><ol>
<li><p>查询列表可以是字段、常量、表达式、函数、也可以是多个</p>
</li>
<li><p>查询结果是一个虚拟表</p>
</li>
</ol>
<h2 id="3、示例"><a href="#3、示例" class="headerlink" title="3、示例"></a>3、示例</h2><ol>
<li>查询单个字段</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名</span><br><span class="line"><span class="keyword">from</span> 表名</span><br></pre></td></tr></table></figure>

<ol>
<li>查询多个字段</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名、字段名</span><br><span class="line"><span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>

<ol>
<li>查询所有字段</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> 表名；</span><br></pre></td></tr></table></figure>

<ol>
<li>查询常量值</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 常量；</span><br></pre></td></tr></table></figure>

<p>注：字符型和日期型的常量值必须用单引号引起来，数值型不需要</p>
<ol>
<li>查询函数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 函数名（实参列表）;</span><br></pre></td></tr></table></figure>

<ol>
<li>查询表达式</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">100</span><span class="operator">/</span><span class="number">1234</span> # 相当于执行函数</span><br></pre></td></tr></table></figure>

<ol>
<li><p>起别名</p>
<ol>
<li><p>在字段后面使用as关键字</p>
</li>
<li><p>在字段后面使用空格，隔开字段和别名</p>
</li>
</ol>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> &quot;out put&quot; <span class="keyword">FROM</span> employees;  <span class="comment">-- 有特殊符号时用引号包围</span></span><br></pre></td></tr></table></figure>

<ol>
<li>去重</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段名</span><br><span class="line"><span class="keyword">from</span> 表名；</span><br></pre></td></tr></table></figure>

<ol>
<li></li>
</ol>
<!---->

<pre><code>*   做加法运算
</code></pre>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 数值<span class="operator">+</span>数值；直接运算</span><br><span class="line"><span class="keyword">select</span> 字符<span class="operator">+</span>数值；先试图将字符转换为数值，如果转换成功，则继续运算；否则转换为<span class="number">0</span>继续运算</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">null</span><span class="operator">+</span>数值；结果都为<span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<ol>
<li>concat函数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 拼接字符串</span><br><span class="line"><span class="keyword">select</span> concat(字符<span class="number">1</span>，字符<span class="number">2</span>，。。。)</span><br></pre></td></tr></table></figure>

<ol>
<li>ifnull函数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#判断某字段或表达式是否为<span class="keyword">null</span>，如果为<span class="keyword">null</span>，返回指定的值，否则返回原来的值。</span><br><span class="line"><span class="keyword">select</span> ifnull(commission_pct,<span class="number">0</span>) <span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>

<ol>
<li>isnull函数</li>
</ol>
<p>判断某字段或表达式是否为null，如果是，则返回1，否则返回0</p>
<h1 id="三、条件查询"><a href="#三、条件查询" class="headerlink" title="三、条件查询"></a>三、条件查询</h1><h2 id="1、语法-1"><a href="#1、语法-1" class="headerlink" title="1、语法"></a>1、语法</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表     ③</span><br><span class="line"><span class="keyword">from</span> 表名       ①</span><br><span class="line"><span class="keyword">where</span> 筛选条件     ②</span><br></pre></td></tr></table></figure>

<h2 id="2、筛选条件的分类"><a href="#2、筛选条件的分类" class="headerlink" title="2、筛选条件的分类"></a>2、筛选条件的分类</h2><ol>
<li>简单条件运算符</li>
</ol>
<blockquote>
<p>&lt; &#x3D;  &lt;&gt; !&#x3D; &gt;&#x3D;   &lt;&#x3D;    &lt;&#x3D;&gt;安全等于</p>
</blockquote>
<ol>
<li>逻辑运算符</li>
</ol>
<table>
<thead>
<tr>
<th>&amp;&amp;</th>
<th>and</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>||</td>
<td>or</td>
<td></td>
</tr>
<tr>
<td>!</td>
<td>not</td>
<td></td>
</tr>
</tbody></table>
<ol>
<li>模糊查询</li>
</ol>
<p><code>like</code>：一般搭配通配符使用，可以判断字符型或数值型<br>通配符：<code>% </code>匹配任意多个字符，<code>_</code> 匹配任意单个字符<br>当通配符作为一个普通字符的时候要进行转义：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#转义字符的使用，当通配符 作为一个普通的字符使用时要进行转义</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  employees</span><br><span class="line"><span class="keyword">WHERE</span>  </span><br><span class="line">  last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_$_%&#x27;</span> <span class="keyword">ESCAPE</span> <span class="string">&#x27;$&#x27;</span>;#表示转义的字符可以自己指定</span><br></pre></td></tr></table></figure>

<ol>
<li><p>between..and  匹配左闭右闭的区间</p>
</li>
<li><p>in : 在什么范围内</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>提高语言简洁度</span><br><span class="line"><span class="number">2.</span><span class="keyword">in</span> 里面不能使用通配符</span><br><span class="line"><span class="number">3.</span><span class="keyword">in</span>里面必须是同一种类型才行</span><br></pre></td></tr></table></figure>

<ol>
<li>is null&#x2F;is not null:用于判断空值</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">is</span> <span class="keyword">null</span> PK <span class="operator">&lt;=&gt;</span></span><br><span class="line">        普通类型的数值  <span class="keyword">null</span>值    可读性</span><br><span class="line"><span class="keyword">is</span> <span class="keyword">null</span>    ×            √          √</span><br><span class="line"><span class="operator">&lt;=&gt;</span>        √            √          ×</span><br><span class="line"></span><br><span class="line"><span class="operator">=</span>  <span class="operator">!=</span> 不能用于判断<span class="keyword">null</span></span><br><span class="line"></span><br><span class="line">#安全等于 ： <span class="operator">&lt;=&gt;</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  employees</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">  commission_pct <span class="operator">&lt;=&gt;</span> <span class="keyword">null</span>;</span><br><span class="line">#安全等于可以替换<span class="keyword">is</span> <span class="keyword">null</span>中的<span class="keyword">is</span>，但是普通的等于不行。</span><br></pre></td></tr></table></figure>

<h1 id="四、排序查询"><a href="#四、排序查询" class="headerlink" title="四、排序查询"></a>四、排序查询</h1><h2 id="1、语法-2"><a href="#1、语法-2" class="headerlink" title="1、语法"></a>1、语法</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表名</span><br><span class="line"><span class="keyword">where</span> 筛选条件</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序列表 【<span class="keyword">asc</span><span class="operator">/</span><span class="keyword">desc</span>】</span><br></pre></td></tr></table></figure>

<h2 id="2、特点-1"><a href="#2、特点-1" class="headerlink" title="2、特点"></a>2、特点</h2><ol>
<li>asc：升序排序，默认值</li>
</ol>
<p>desc：降序</p>
<ol>
<li><p>排序列表支持单个字段、多个字段、函数、表达式、别名</p>
</li>
<li><p>order by的位置一般放在查询语句的最后（limit之前）</p>
</li>
</ol>
<h1 id="五、常见函数"><a href="#五、常见函数" class="headerlink" title="五、常见函数"></a>五、常见函数</h1><p>函数调用使用：select 函数名(实参)</p>
<h2 id="1、单行函数"><a href="#1、单行函数" class="headerlink" title="1、单行函数"></a>1、单行函数</h2><h3 id="1-1、字符函数"><a href="#1-1、字符函数" class="headerlink" title="1.1、字符函数"></a>1.1、字符函数</h3><p>concat：连接<br>substr：截取子串<br>upper：变大写<br>lower：变小写<br>replace：替换<br>length：获取字节长度<br>trim：去前后空格<br>lpad：左填充<br>rpad：右填充<br>instr：获取字符串第一次出现的索引</p>
<h3 id="1-2、数学函数"><a href="#1-2、数学函数" class="headerlink" title="1.2、数学函数"></a>1.2、数学函数</h3><p>ceil：向上取整<br>round：四舍五入<br>mod：取余<br>floor：向下取整<br>truncate：截断（此函数用于返回X的截断到小数位D号的值。 如果D为0，则小数点被除去。如果D是负的，那么D的值的整数部分值的数量被截断。）<br>rand：获取随机整数，返回0-1之间的小数。</p>
<h3 id="1-3、日期函数"><a href="#1-3、日期函数" class="headerlink" title="1.3、日期函数"></a>1.3、日期函数</h3><p>now：返回当前日期+时间<br>year：返回年<br>month：返回月<br>day：返回日<br>date_format：将日期转换为字符<br>curdate：返回当前日期<br>str_to_date：将字符转换为日期<br>curtime：返回当前时间<br>hour：小时<br>minutes：分钟<br>second：秒<br>datediff：返回两个日期相差的天数<br>monthname：以英文形式返回月</p>
<h3 id="1-4、其他函数"><a href="#1-4、其他函数" class="headerlink" title="1.4、其他函数"></a>1.4、其他函数</h3><p>version：当前数据库服务器的版本<br>database：当前打开的数据库<br>user：当前用户<br>password(‘字符’)：返回该字符的密码形式（MySQL8.0移除，换成SHA1）<br>md5(‘字符’)：返回该字符的MD5加密形式</p>
<h3 id="1-5、流程控制函数"><a href="#1-5、流程控制函数" class="headerlink" title="1.5、流程控制函数"></a>1.5、流程控制函数</h3><ol>
<li><p>if(条件表达式，表达式1，表达式2)：如果条件表达式成立，返回表达式1，否则返回表达式2</p>
</li>
<li><p>case情况1</p>
</li>
</ol>
<p>case 变量或表达式或字段<br>when 常量1 then 值1<br>when 常量2 then 值2<br>。。。<br>else 值n<br>end</p>
<ol>
<li>case情况2</li>
</ol>
<p>case<br>when 条件1 then 值1<br>when 条件2 then 值2<br>。。。<br>else 值n<br>end</p>
<h2 id="2、分组函数"><a href="#2、分组函数" class="headerlink" title="2、分组函数"></a>2、分组函数</h2><ol>
<li>分类</li>
</ol>
<p>max：最大值<br>min：最小值<br>sum：和<br>avg：平均值<br>count：计数</p>
<ol>
<li>特点：</li>
</ol>
<ul>
<li><p>语法：</p>
<ul>
<li>select max(字段) from 表名；</li>
</ul>
</li>
<li><p>支持的类型：</p>
<ul>
<li><p>sum和avg一般用于处理数值型</p>
</li>
<li><p>max、min、count可以处理任何数据类型</p>
</li>
</ul>
</li>
<li><p>以上分组函数都忽略null</p>
</li>
<li><p>都可以搭配distinct使用，实现去重统计</p>
<ul>
<li>select sum(distinct  字段) from 表；</li>
</ul>
</li>
<li><p>count函数</p>
<ul>
<li><p>count(字段)：统计字段非空的个数</p>
</li>
<li><p>count( *)：统计结果集的行数</p>
</li>
<li><p>count(1):统计结果集的行数</p>
</li>
<li><p>效率：</p>
<ul>
<li><p>myIsam存储引擎：count( *)最高</p>
</li>
<li><p>innoDB存储引擎：count( *)和count(1)效率 》 count(字段)</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>和分组函数一同查询的字段，要求是group by后出现的字段</strong></p>
</li>
</ul>
<h1 id="六、分组查询"><a href="#六、分组查询" class="headerlink" title="六、分组查询"></a>六、分组查询</h1><h2 id="1、语法-3"><a href="#1、语法-3" class="headerlink" title="1、语法"></a>1、语法</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 分组函数 ，分组函数后的字段</span><br><span class="line">form 表</span><br><span class="line"><span class="keyword">where</span> 筛选条件</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组字段</span><br><span class="line"><span class="keyword">having</span> 分组后筛选</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序列表</span><br></pre></td></tr></table></figure>

<h2 id="2、特点-2"><a href="#2、特点-2" class="headerlink" title="2、特点"></a>2、特点</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">          使用关键字    筛选的表    位置</span><br><span class="line">分组前筛选  <span class="keyword">where</span>        原始表        <span class="keyword">group</span> <span class="keyword">by</span>的前面</span><br><span class="line">分组后筛选  <span class="keyword">having</span>      分组后的结果  <span class="keyword">group</span> <span class="keyword">by</span> 的后面</span><br></pre></td></tr></table></figure>

<h1 id="七、连接查询"><a href="#七、连接查询" class="headerlink" title="七、连接查询"></a>七、连接查询</h1><h2 id="1、含义"><a href="#1、含义" class="headerlink" title="1、含义"></a>1、含义</h2><p>当查询中涉及到了到了多个表的字段，需要使用多表连接<br>select 字段1，字段2<br>from 表1，表2，。。。。<br>笛卡尔乘积：当查询多个表时，没有添加有效的连接条件导致多个表所有行实现完全连接<br>如何解决：添加有效的连接条件</p>
<h2 id="2、分类"><a href="#2、分类" class="headerlink" title="2、分类"></a>2、分类</h2><p>按年代分：<br>SQL92：</p>
<ul>
<li><p>等值连接</p>
</li>
<li><p>非等值连接</p>
</li>
<li><p>自连接</p>
</li>
<li><p>也支持一部分外连接（用于oracle、sqlserver，mysql不支持）</p>
</li>
</ul>
<p>SQL99</p>
<ul>
<li><p>内连接</p>
<ul>
<li><p>等值连接</p>
</li>
<li><p>非等值连接</p>
</li>
<li><p>自连接</p>
</li>
</ul>
</li>
<li><p>外连接</p>
<ul>
<li><p>左外连接</p>
</li>
<li><p>右外连接</p>
</li>
<li><p>全外连接（mysql不支持）</p>
</li>
</ul>
</li>
<li><p>交叉连接用来实现笛卡尔积</p>
</li>
</ul>
<h2 id="3、SQL92语法（只支持内连接）"><a href="#3、SQL92语法（只支持内连接）" class="headerlink" title="3、SQL92语法（只支持内连接）"></a>3、SQL92语法（只支持内连接）</h2><h3 id="1、等值连接"><a href="#1、等值连接" class="headerlink" title="1、等值连接"></a>1、等值连接</h3><ul>
<li><p>select 查询列表</p>
</li>
<li><p>from  表1 别名，表2 别名</p>
</li>
<li><p>where 表1,.key &#x3D; 表2.key</p>
</li>
<li><p>and 筛选条件</p>
</li>
<li><p>group by 分组字段</p>
</li>
<li><p>having 分组后的筛选</p>
</li>
<li><p>order by排序字段</p>
</li>
<li><p>特点：</p>
<ul>
<li><p>一般为表起别名</p>
</li>
<li><p>多表的顺序可以调换</p>
</li>
<li><p>n表连接至少需要n-1个连接条件</p>
</li>
<li><p>等值连接的结果是多表的交际部分</p>
</li>
</ul>
</li>
</ul>
<h3 id="2、非等值连接"><a href="#2、非等值连接" class="headerlink" title="2、非等值连接"></a>2、非等值连接</h3><ul>
<li><p>select 查询列表</p>
</li>
<li><p>from表1 别名，表2 别名</p>
</li>
<li><p>where 非等值连接条件</p>
</li>
<li><p>and 筛选条件</p>
</li>
<li><p>group by 分组字段</p>
</li>
<li><p>having 分组后的筛选条件</p>
</li>
<li><p>order by 排序字段</p>
</li>
</ul>
<h3 id="3、自连接"><a href="#3、自连接" class="headerlink" title="3、自连接"></a>3、自连接</h3><ul>
<li><p>select 查询列表</p>
</li>
<li><p>from表  别名1，表 别名2  # 这是同一个表</p>
</li>
<li><p>where 等值的连接条件</p>
</li>
<li><p>and 筛选条件</p>
</li>
<li><p>group by分组字段</p>
</li>
<li><p>having 分组后的筛选</p>
</li>
<li><p>order by排序字段</p>
</li>
</ul>
<h2 id="4、SQL99语法"><a href="#4、SQL99语法" class="headerlink" title="4、SQL99语法"></a>4、SQL99语法</h2><h3 id="1、内连接"><a href="#1、内连接" class="headerlink" title="1、内连接"></a>1、内连接</h3><ul>
<li><p>select 查询列表</p>
</li>
<li><p>from 表1 别名</p>
</li>
<li><p>inner join 表2 别名</p>
</li>
<li><p>on 连接条件</p>
</li>
<li><p>where 筛选条件</p>
</li>
<li><p>group by 分组列表</p>
</li>
<li><p>having 分组后筛选</p>
</li>
<li><p>order by排序列表</p>
</li>
<li><p>limit 字句</p>
</li>
</ul>
<p>特点：</p>
<ul>
<li><p>表的顺序可以调换</p>
</li>
<li><p>内连接的结果&#x3D;多表的交集</p>
</li>
<li><p>n表相连至少需要n-1个连接条件</p>
</li>
</ul>
<p>分类：<br>等值连接<br>非等值连接<br>自连接</p>
<h3 id="2、外连接"><a href="#2、外连接" class="headerlink" title="2、外连接"></a>2、外连接</h3><ul>
<li><p>select 查询列表</p>
</li>
<li><p>from 表1 别名</p>
</li>
<li><p>left | right | full 【outer】join 表2 别名</p>
</li>
<li><p>on 连接条件</p>
</li>
<li><p>where 筛选条件</p>
</li>
<li><p>group by 分组列表</p>
</li>
<li><p>having 分组后的筛选</p>
</li>
<li><p>order by 排序列表</p>
</li>
<li><p>limit 字句</p>
</li>
</ul>
<p>特点：</p>
<ul>
<li><p>查询的结果&#x3D;主表中的所有行，如果从表和他匹配的将显示匹配，没有匹配的就显示为null</p>
</li>
<li><p>left join 左边的是主表，right join 右边的是主表  full join两边都是主表</p>
</li>
<li><p>一般用于查询处理交集部分的剩余的不匹配的行。</p>
</li>
</ul>
<h3 id="3、交叉连接"><a href="#3、交叉连接" class="headerlink" title="3、交叉连接"></a>3、交叉连接</h3><ul>
<li><p>select 查询列表</p>
</li>
<li><p>from 表1 别名</p>
</li>
<li><p>cross join 表2 别名</p>
</li>
</ul>
<p>特点：产生笛卡尔积</p>
<h1 id="八、子查询"><a href="#八、子查询" class="headerlink" title="八、子查询"></a>八、子查询</h1><h2 id="1、含义-1"><a href="#1、含义-1" class="headerlink" title="1、含义"></a>1、含义</h2><p>嵌套在其他语句内部的select语句称为子查询或内查询，<br>外面的语句可以是insert、update、delete、select等一般使用select较多。<br>外面如果为select 语句，则此语句称为外查询或主查询</p>
<h2 id="2、分类-1"><a href="#2、分类-1" class="headerlink" title="2、分类"></a>2、分类</h2><h3 id="1、按出现的位置"><a href="#1、按出现的位置" class="headerlink" title="1、按出现的位置"></a>1、按出现的位置</h3><p>select后面：仅仅支持标量子查询<br>from后面：表子查询<br>where或having后面：标量子查询、列子查询、行子查询<br>exists后面：标量子查询、列子查询、行子查询、表子查询</p>
<h3 id="2、按结果集的行列"><a href="#2、按结果集的行列" class="headerlink" title="2、按结果集的行列"></a>2、按结果集的行列</h3><ul>
<li><p>标量子查询（单行子查询）：结果集为一行一列</p>
</li>
<li><p>列子查询（多行子查询）：结果集为多行一列</p>
</li>
<li><p>行子查询：结果集为多行多列</p>
</li>
<li><p>表子查询：结果集为多行多列</p>
</li>
</ul>
<p>相关子查询：是否有值返回<br>exists(完整的子查询)<br>结果：0或者1</p>
<h2 id="3、示例-1"><a href="#3、示例-1" class="headerlink" title="3、示例"></a>3、示例</h2><p>where或having后面<br>1、标量子查询<br>案例：查询最低工资的员工姓名和工资<br>①最低工资<br>select min(salary) from employees</p>
<p>②查询员工的姓名和工资，要求工资&#x3D;①<br>select last_name,salary<br>from employees<br>where salary&#x3D;(<br>select min(salary) from employees<br>);</p>
<p>2、列子查询<br>案例：查询所有是领导的员工姓名<br>①查询所有员工的 manager_id<br>select manager_id<br>from employees</p>
<p>②查询姓名，employee_id属于①列表的一个<br>select last_name<br>from employees<br>where employee_id in(<br>select manager_id<br>from employees<br>);</p>
<h1 id="九、分页查询"><a href="#九、分页查询" class="headerlink" title="九、分页查询"></a>九、分页查询</h1><h2 id="1、应用场景"><a href="#1、应用场景" class="headerlink" title="1、应用场景"></a>1、应用场景</h2><ul>
<li>当查询的条目太多，一页显示不全</li>
</ul>
<h2 id="2、语法"><a href="#2、语法" class="headerlink" title="2、语法"></a>2、语法</h2><ul>
<li><p>select  查询列表</p>
</li>
<li><p>from 表</p>
</li>
<li><p>limit 【offset，】size</p>
</li>
</ul>
<p>注意：<br>offset代表的是其实的条目索引，默认从0开始<br>size代表的是显示的条目数<br>公式：<br>假如要显示的页数为page，每一页条目数为size<br>select 查询列表<br>from 表<br>limit （page-1）*size，size；</p>
<h1 id="十、联合查询"><a href="#十、联合查询" class="headerlink" title="十、联合查询"></a>十、联合查询</h1><h2 id="1、含义-2"><a href="#1、含义-2" class="headerlink" title="1、含义"></a>1、含义</h2><p>union：合并、联合，将多次查询结果合并成一个结果</p>
<h2 id="2、语法-1"><a href="#2、语法-1" class="headerlink" title="2、语法"></a>2、语法</h2><p>查询语句1<br>union 【all】<br>查询语句2<br>union 【all】<br>。。。。</p>
<h2 id="3、意义"><a href="#3、意义" class="headerlink" title="3、意义"></a>3、意义</h2><ol>
<li><p>将一条比较复杂的查询语句拆分成多条语句</p>
</li>
<li><p>适用于查询多个表的时候，查询的列基本是一致。</p>
</li>
</ol>
<h2 id="4、特点"><a href="#4、特点" class="headerlink" title="4、特点"></a>4、特点</h2><ol>
<li><p>要求多条查询语句的查询列数必须一致</p>
</li>
<li><p>要求多条查询语句的查询的各列类型，顺序最好一致</p>
</li>
<li><p>union去重，union  all包含重复项</p>
</li>
</ol>
<h1 id="十一、查询顺序"><a href="#十一、查询顺序" class="headerlink" title="十一、查询顺序"></a>十一、查询顺序</h1><p>语法：<br>select 查询列表    ⑦<br>from 表1 别名       ①<br>连接类型 join 表2   ②<br>on 连接条件         ③<br>where 筛选          ④<br>group by 分组列表   ⑤<br>having 筛选         ⑥<br>order by排序列表    ⑧<br>limit 起始条目索引，条目数;  ⑨</p>
<h1 id="十二、DML语言"><a href="#十二、DML语言" class="headerlink" title="十二、DML语言"></a>十二、DML语言</h1><h2 id="1、插入"><a href="#1、插入" class="headerlink" title="1、插入"></a>1、插入</h2><h3 id="1、方式一："><a href="#1、方式一：" class="headerlink" title="1、方式一："></a>1、方式一：</h3><ul>
<li>语法：</li>
</ul>
<p>insert into 表名（字段名） values（值。。。。）；</p>
<ul>
<li><p>特点</p>
<ul>
<li><p>要求值的类型和字段的类型要一致或兼容。</p>
</li>
<li><p>字段的个数和顺序不一定与原始表中的字段个数和顺序一致但必须保证值和字段一一对应</p>
</li>
<li><p>加入表中有可以为null的字段，注意可以通过一下两种方式插入null。</p>
<ul>
<li><p>字段和值都省略</p>
</li>
<li><p>字段写上使用null</p>
</li>
</ul>
</li>
<li><p>字段和值的个数必须一致</p>
</li>
<li><p>字段名可以省略，默认所有列。</p>
</li>
</ul>
</li>
</ul>
<h2 id="2-方式二："><a href="#2-方式二：" class="headerlink" title="2.方式二："></a>2.方式二：</h2><ul>
<li>语法：</li>
</ul>
<p>insert into 表名 set 字段&#x3D;值， 字段&#x3D;值，。。。</p>
<ul>
<li><p>两种方式的区别：</p>
<ul>
<li><p>方式一支持一次插入多行，语法如下：</p>
<ul>
<li>insert into 表名【（字段名，。。。）】values （值，。。），（值，。。）。。。</li>
</ul>
</li>
<li><p>方式一支持子查询：</p>
<ul>
<li>insert into 表名  查询语句</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2、修改"><a href="#2、修改" class="headerlink" title="2、修改"></a>2、修改</h2><h3 id="1、修改单表的记录"><a href="#1、修改单表的记录" class="headerlink" title="1、修改单表的记录"></a>1、修改单表的记录</h3><p>语法：update  表名 set  字段&#x3D;值，字段&#x3D;值 【where 筛选条件】</p>
<h3 id="2、修改多表的记录"><a href="#2、修改多表的记录" class="headerlink" title="2、修改多表的记录"></a>2、修改多表的记录</h3><p>语法：<br>update 表1 别名<br>left|right|inner join 表2 别名<br>on 连接条件<br>set 字段&#x3D;值，字段&#x3D;值<br>where 筛选条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> beauty b</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.`boyfriend_id` <span class="operator">=</span> bo.`id`</span><br><span class="line"><span class="keyword">SET</span> phone <span class="operator">=</span> <span class="string">&#x27;110&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.`boyName` <span class="operator">=</span> <span class="string">&#x27;张无忌&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="3、删除"><a href="#3、删除" class="headerlink" title="3、删除"></a>3、删除</h2><h3 id="1、使用delete"><a href="#1、使用delete" class="headerlink" title="1、使用delete"></a>1、使用delete</h3><ul>
<li>删除表的记录</li>
</ul>
<p>delete from 表名 【where 筛选条件】【limit 条目数】</p>
<ul>
<li>级联删除</li>
</ul>
<p>delete from 别名1，别名2 from表1 别名<br>inner|left|right join 表2 别名<br>on 连接条件<br>【where 筛选条件】</p>
<h3 id="2、使用truncate"><a href="#2、使用truncate" class="headerlink" title="2、使用truncate"></a>2、使用truncate</h3><p>truncate table 表名</p>
<h3 id="3、两种方式的区别"><a href="#3、两种方式的区别" class="headerlink" title="3、两种方式的区别"></a>3、两种方式的区别</h3><ol>
<li><p>truncate 删除后，如果在插入数据，标识从1开始，delete删除后，如果在插入，标识从断点开始。</p>
</li>
<li><p>delete可以添加筛选条件，truncate不可以添加筛选条件</p>
</li>
<li><p>truncate效率高</p>
</li>
<li><p>truncate没有返回值，delete可以返回受影响的行数</p>
</li>
<li><p>truncate 不可以回滚，delete可以回滚</p>
</li>
</ol>
<h1 id="十三、DDL语言"><a href="#十三、DDL语言" class="headerlink" title="十三、DDL语言"></a>十三、DDL语言</h1><h2 id="1、数据库的管理"><a href="#1、数据库的管理" class="headerlink" title="1、数据库的管理"></a>1、数据库的管理</h2><h3 id="1、创建数据库"><a href="#1、创建数据库" class="headerlink" title="1、创建数据库"></a>1、创建数据库</h3><p>create database 【if not exists】 库名【character set 字符集名】</p>
<h3 id="2、修改数据库"><a href="#2、修改数据库" class="headerlink" title="2、修改数据库"></a>2、修改数据库</h3><p>alter database 库名 character set 字符集名</p>
<h3 id="3、删除库"><a href="#3、删除库" class="headerlink" title="3、删除库"></a>3、删除库</h3><p>drop database 【if exists】 库名；</p>
<h2 id="2、表的管理"><a href="#2、表的管理" class="headerlink" title="2、表的管理"></a>2、表的管理</h2><h3 id="1、创建表"><a href="#1、创建表" class="headerlink" title="1、创建表"></a>1、创建表</h3><p>create table 【if not exists】 表名(<br>字段名  字段类型 【约束】，<br>字段名  字段类型 【约束】，<br>。。。<br>字段名  字段类型 【约束】<br>)</p>
<h3 id="2、修改表"><a href="#2、修改表" class="headerlink" title="2、修改表"></a>2、修改表</h3><ol>
<li>添加列</li>
</ol>
<p>alter table 表名 add column 列名 类型 【first|after 字段名    （这是指定位置）】</p>
<ol>
<li>修改列的类型或约束</li>
</ol>
<p>alter table 表名 modify column 列名 新类型 【新的约束】；</p>
<ol>
<li>修改列名</li>
</ol>
<p>alter table 表名 change column 旧列名  新列名 类型；</p>
<ol>
<li>删除列</li>
</ol>
<p>alter table 表名 drop column 列名</p>
<ol>
<li>修改表名</li>
</ol>
<p>alter  table 表名 rename 【to】 新表名；</p>
<h3 id="3、删除表"><a href="#3、删除表" class="headerlink" title="3、删除表"></a>3、删除表</h3><p>drop table 【if exists】 表名；</p>
<h3 id="4、复制表"><a href="#4、复制表" class="headerlink" title="4、复制表"></a>4、复制表</h3><ul>
<li><p>复制表的结构</p>
<ul>
<li>create table 表名 like 旧表；</li>
</ul>
</li>
<li><p>复制表的结构加数据</p>
<ul>
<li>create table 表名 select 查询列表 from 旧表 【where 筛选】</li>
</ul>
</li>
</ul>
<h2 id="3、数据类型"><a href="#3、数据类型" class="headerlink" title="3、数据类型"></a>3、数据类型</h2><h3 id="1、数值型"><a href="#1、数值型" class="headerlink" title="1、数值型"></a>1、数值型</h3><ul>
<li>整型</li>
</ul>
<p>tinyint(1byte)、 smallint(2byte)、 mediumint(3byte)  、int&#x2F;integer(4byte)、bigint(8byte)<br>特点：</p>
<ol>
<li><p>都可以设置无符号和有符号，默认有符号，通过unsigned设置无符号</p>
</li>
<li><p>如果超出了范围，会报out of range异常，插入临界值</p>
</li>
<li><p>长度可以不指定，默认会有一个长度</p>
</li>
<li><p>长度代表显示的最大宽度，如果不够则左边用0填充，但需要搭配zerofill，并且默认变为无符号整型。</p>
</li>
</ol>
<ul>
<li><p>浮点型</p>
<ul>
<li><p>定点数：decimal(M,D);</p>
</li>
<li><p>浮点数：</p>
<ul>
<li><p>float(M,D)  4byte</p>
</li>
<li><p>double(M,D) 8byte</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>特点：</p>
</li>
</ul>
<ol>
<li><p>M代表整数部位+小数部位的个数，D代表小数部位</p>
</li>
<li><p>如果超出范围，则报out of range异常，并且插入临界值</p>
</li>
<li><p>M和D都可以省略，但对于定点数，M默认为10，D默认为0</p>
</li>
<li><p>如果精度要求较高，则优先考虑使用定点数。</p>
</li>
</ol>
<h3 id="2、字符型"><a href="#2、字符型" class="headerlink" title="2、字符型"></a>2、字符型</h3><p>char、varchar、binary、varbinary、enum、set、text、blob<br>char：固定长度的字符，写法为char(M),最大长度不能超过M，其中M<br>可以省略，默认为1<br>varchar：可变长度字符，写法为varchar（M），最大长度不能超过M，其中M不能省略的。</p>
<h3 id="3、日期型"><a href="#3、日期型" class="headerlink" title="3、日期型"></a>3、日期型</h3><p>year 、date、time、datetime、timestamp</p>
<h1 id="十四、常见的约束"><a href="#十四、常见的约束" class="headerlink" title="十四、常见的约束"></a>十四、常见的约束</h1><ul>
<li><p>NOT NULL：非空约束，该字段的值必填</p>
</li>
<li><p>UNIQUE:唯一约束，该字段的值不能重复</p>
</li>
<li><p>DEFAULT：默认约束，该字段的值不用手动插入就有默认值</p>
</li>
<li><p>CHECK:检查约束，mysql不支持</p>
</li>
<li><p>PRIMARY KEY：主键约束，该字段的值不可重复不能为空</p>
</li>
<li><p>FOREIGN KEY：外键约束，该字段的值引用另外的表的字段</p>
</li>
</ul>
<h2 id="1、主键和唯一"><a href="#1、主键和唯一" class="headerlink" title="1、主键和唯一"></a>1、主键和唯一</h2><p>区别：</p>
<ul>
<li><p>一个表中最多一个主键，但可以有多个唯一</p>
</li>
<li><p>主键不能为空，唯一可以为空，但只能一个为空</p>
</li>
</ul>
<p>相同点：</p>
<ul>
<li><p>都具有唯一性</p>
</li>
<li><p>都支持组合键，但不推荐</p>
</li>
</ul>
<h2 id="2、外键"><a href="#2、外键" class="headerlink" title="2、外键"></a>2、外键</h2><ol>
<li><p>用于限制两个表的关系，从表的字段值引用了主表的某个字段值。</p>
</li>
<li><p>外键列和主表的被引用列要去类型一致，意义一样，名称无要求。</p>
</li>
<li><p>主表的被引用列要求是一个key（一般就是主键）</p>
</li>
<li><p>插入数据，先插入主表</p>
</li>
<li><p>删除数据，先删除从表</p>
</li>
<li><p>可以通过一下两种方式删除主表的记录</p>
<ol>
<li>级联删除</li>
</ol>
</li>
</ol>
<p>ALTER TABLE stuinfo ADD CONSTRAINT fk_stu_major FOREIGN KEY(majorid) REFERENCES major(id) ON DELETE CASCADE;</p>
<ol>
<li>级联置空</li>
</ol>
<p>ALTER TABLE stuinfo ADD CONSTRAINT fk_stu_major FOREIGN KEY(majorid) REFERENCES major(id) ON DELETE SET NULL;</p>
<h2 id="3、创建表时添加约束"><a href="#3、创建表时添加约束" class="headerlink" title="3、创建表时添加约束"></a>3、创建表时添加约束</h2><p>create table 表名{<br>字段名 字段类型 not null,#非空<br>字段名 字段类型 primary key,#主键<br>字段名 字段类型 unique,#唯一<br>字段名 字段类型 default 值,#默认<br>constraint 约束名 foreign key(字段名) references 主表（被引用列）<br>}<br>注意：<br>支持类型			可以起约束名<br>列级约束		除了外键			不可以<br>表级约束		除了非空和默认	可以，但对主键无效</p>
<p>列级约束可以在一个字段上追加多个，中间用空格隔开，没有顺序要求</p>
<h2 id="4、修改表时添加或删除约束"><a href="#4、修改表时添加或删除约束" class="headerlink" title="4、修改表时添加或删除约束"></a>4、修改表时添加或删除约束</h2><p>1、非空<br>添加非空<br>alter table 表名 modify column 字段名 字段类型 not null;<br>删除非空<br>alter table 表名 modify column 字段名 字段类型 ;</p>
<p>2、默认<br>添加默认<br>alter table 表名 modify column 字段名 字段类型 default 值;<br>删除默认<br>alter table 表名 modify column 字段名 字段类型 ;<br>3、主键<br>添加主键<br>alter table 表名 add【 constraint 约束名】 primary key(字段名);<br>删除主键<br>alter table 表名 drop primary key;</p>
<p>4、唯一<br>添加唯一<br>alter table 表名 add【 constraint 约束名】 unique(字段名);<br>删除唯一<br>alter table 表名 drop index 索引名;<br>5、外键<br>添加外键<br>alter table 表名 add【 constraint 约束名】 foreign key(字段名) references 主表（被引用列）;<br>删除外键<br>alter table 表名 drop foreign key 约束名;</p>
<h2 id="5、自增长列"><a href="#5、自增长列" class="headerlink" title="5、自增长列"></a>5、自增长列</h2><p>特点：</p>
<ol>
<li>不用手动插入值，可以自动提供序列值，默认从1开始，步长为1</li>
</ol>
<p>auto_increment_increment<br>如果要更改起始值：手动插入值<br>如果要更改步长：更改系统变量<br>set auto_increment_increment &#x3D; 值</p>
<ol>
<li><p>一个表最多有一个自增长列</p>
</li>
<li><p>自增长列只能支持数值型</p>
</li>
<li><p>自增长列必须为key</p>
</li>
</ol>
<ul>
<li>创建表时设置自增长列</li>
</ul>
<p>create table 表(<br>字段名 字段类型 约束 auto_increment<br>)</p>
<ul>
<li>修改表时设置自增长列</li>
</ul>
<p>alter table 表 modify column 字段名 字段类型 约束 auto_increment</p>
<ul>
<li>删除自增长列</li>
</ul>
<p>alter table 表 modify column 字段名 字段类型 约束</p>
<h1 id="十五、事务"><a href="#十五、事务" class="headerlink" title="十五、事务"></a>十五、事务</h1><h2 id="1、含义-3"><a href="#1、含义-3" class="headerlink" title="1、含义"></a>1、含义</h2><p>事务：一条或多条sql语句组成一个执行单位，要么都执行，要么都不执行</p>
<h2 id="2、特点（ACID属性）"><a href="#2、特点（ACID属性）" class="headerlink" title="2、特点（ACID属性）"></a>2、特点（ACID属性）</h2><ul>
<li><p>原子性：一个事务是不可分割的整体，要么都执行要么都不执行</p>
</li>
<li><p>一致性：一个事务可以使数据从一种一致状态切换到另一种一致状态</p>
</li>
<li><p>隔离性：一个事务不受其他事务的干扰，多个事务互相隔离的</p>
</li>
<li><p>持久性：一个事务一旦提交了，则永久的持久化到本地</p>
</li>
</ul>
<h2 id="3、事务的使用步骤"><a href="#3、事务的使用步骤" class="headerlink" title="3、事务的使用步骤"></a>3、事务的使用步骤</h2><p>隐式事务：没有显示的开启和关闭，本身就是一个事务：insert、update、delete<br>显示事务：具有明显的开启和结束<br>使用显示事务：</p>
<ol>
<li><p>开启事务</p>
<ol>
<li><p>set autocommit &#x3D; 0;</p>
</li>
<li><p>start transaction #可以省略</p>
</li>
</ol>
</li>
<li><p>编写一组逻辑SQL语句</p>
<ol>
<li><p>注意：SQL语句支持 insert、update、delete</p>
</li>
<li><p>设置回滚点：</p>
<ol>
<li>savepoint 回滚点名；</li>
</ol>
</li>
</ol>
</li>
<li><p>结束事务</p>
<ol>
<li><p>提交：commit</p>
</li>
<li><p>回滚：rollback</p>
</li>
<li><p>回滚到指定的地方：rollback to 回滚点名；</p>
</li>
</ol>
</li>
</ol>
<h2 id="4、并发事务"><a href="#4、并发事务" class="headerlink" title="4、并发事务"></a>4、并发事务</h2><ol>
<li><p>事务的并发问题是如何发生的？</p>
<ol>
<li>多个事务同时操作同一个数据库的相同数据时</li>
</ol>
</li>
<li><p>并发问题都有哪些？</p>
<ol>
<li><p>脏读：一个事务读取了其他事务还没有提交的数据，读到的是其他事务更新的数据</p>
</li>
<li><p>不可重复读：一个事务多次读取，结果不一样</p>
</li>
<li><p>幻读：一个事务读取了其他事务还没有提交的数据，只是读到的是其他事务插入的数据。</p>
</li>
</ol>
</li>
<li><p>如何解决并发问题</p>
<ol>
<li>通过设置隔离级别来解决并发问题</li>
</ol>
</li>
<li><p>隔离级别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">脏读    不可重复读    幻读</span><br></pre></td></tr></table></figure></li>
</ol>
<p>read uncommitted:读未提交   	     ×                ×              	 ×<br>read committed：读已提交     	      √                ×              	×<br>repeatable read：可重复读     	      √                √              	×<br>serializable：串行化          		      √                √              	√</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Inhaltsverzeichnis
        </li>
        <li class="sidebar-nav-overview">
          Übersicht
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="cjsstart"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">cjsstart</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">Artikel</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">schlagwörter</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cjsstart</span>
</div>
  <div class="powered-by">Erstellt mit  <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Alle Besucher">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Alle Aufrufe">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : '[object Object]',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

</body>
</html>
